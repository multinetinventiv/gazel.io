<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Gazel Docs</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/gazel.io/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/gazel.io/favicon.png"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="/gazel.io/assets/css/stylesheet.css"><script data-n-head="ssr" src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script><script data-n-head="ssr" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script><script data-n-head="ssr" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script><link rel="preload" href="/gazel.io/_nuxt/12413c2.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/1464aa5.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/da26cd5.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/8dd2546.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/7b10f97.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/713adc0.js" as="script"><style data-vue-ssr-id="5764bbd8:0 62108049:0 fa7ff0ca:0 56b15182:0 625bf64c:0 257af960:0 3b8d156a:0">:host,:root{--fa-font-solid:normal 900 1em/1 "Font Awesome 6 Solid";--fa-font-regular:normal 400 1em/1 "Font Awesome 6 Regular";--fa-font-light:normal 300 1em/1 "Font Awesome 6 Light";--fa-font-thin:normal 100 1em/1 "Font Awesome 6 Thin";--fa-font-duotone:normal 900 1em/1 "Font Awesome 6 Duotone";--fa-font-brands:normal 400 1em/1 "Font Awesome 6 Brands"}svg:not(:host).svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible;box-sizing:content-box}.svg-inline--fa{display:inline-block;display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-2xs{vertical-align:.1em}.svg-inline--fa.fa-xs{vertical-align:0}.svg-inline--fa.fa-sm{vertical-align:-.07143em}.svg-inline--fa.fa-lg{vertical-align:-.2em}.svg-inline--fa.fa-xl{vertical-align:-.25em}.svg-inline--fa.fa-2xl{vertical-align:-.3125em}.svg-inline--fa.fa-pull-left{margin-right:.3em;margin-right:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;margin-left:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-li{width:2em;width:var(--fa-li-width,2em);top:.25em}.svg-inline--fa.fa-fw{width:1.25em;width:var(--fa-fw-width,1.25em)}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{transform-origin:center center}.fa-layers-text{left:50%;top:50%;transform:translate(-50%,-50%);transform-origin:center center}.fa-layers-counter{background-color:#ff253a;background-color:var(--fa-counter-background-color,#ff253a);border-radius:1em;border-radius:var(--fa-counter-border-radius,1em);box-sizing:border-box;color:#fff;color:var(--fa-inverse,#fff);line-height:1;line-height:var(--fa-counter-line-height,1);max-width:5em;max-width:var(--fa-counter-max-width,5em);min-width:1.5em;min-width:var(--fa-counter-min-width,1.5em);overflow:hidden;padding:.25em .5em;padding:var(--fa-counter-padding,.25em .5em);right:0;right:var(--fa-right,0);text-overflow:ellipsis;top:0;top:var(--fa-top,0);transform:scale(.25);transform:scale(var(--fa-counter-scale,.25));transform-origin:top right}.fa-layers-bottom-right{bottom:0;bottom:var(--fa-bottom,0);right:0;right:var(--fa-right,0);top:auto;transform:scale(.25);transform:scale(var(--fa-layers-scale,.25));transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;bottom:var(--fa-bottom,0);left:0;left:var(--fa-left,0);right:auto;top:auto;transform:scale(.25);transform:scale(var(--fa-layers-scale,.25));transform-origin:bottom left}.fa-layers-top-right{top:0;top:var(--fa-top,0);right:0;right:var(--fa-right,0);transform:scale(.25);transform:scale(var(--fa-layers-scale,.25));transform-origin:top right}.fa-layers-top-left{left:0;left:var(--fa-left,0);right:auto;top:0;top:var(--fa-top,0);transform:scale(.25);transform:scale(var(--fa-layers-scale,.25));transform-origin:top left}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-2xs{font-size:.625em;line-height:.1em;vertical-align:.225em}.fa-xs{font-size:.75em;line-height:.08333em;vertical-align:.125em}.fa-sm{font-size:.875em;line-height:.07143em;vertical-align:.05357em}.fa-lg{font-size:1.25em;line-height:.05em;vertical-align:-.075em}.fa-xl{font-size:1.5em;line-height:.04167em;vertical-align:-.125em}.fa-2xl{font-size:2em;line-height:.03125em;vertical-align:-.1875em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;margin-left:var(--fa-li-margin,2.5em);padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;left:calc(var(--fa-li-width,2em)*-1);position:absolute;text-align:center;width:2em;width:var(--fa-li-width,2em);line-height:inherit}.fa-border{border-radius:.1em;border-radius:var(--fa-border-radius,.1em);border:.08em solid #eee;border:var(--fa-border-width,.08em) var(--fa-border-style,solid) var(--fa-border-color,#eee);padding:.2em .25em .15em;padding:var(--fa-border-padding,.2em .25em .15em)}.fa-pull-left{float:left;margin-right:.3em;margin-right:var(--fa-pull-margin,.3em)}.fa-pull-right{float:right;margin-left:.3em;margin-left:var(--fa-pull-margin,.3em)}.fa-beat{-webkit-animation-name:fa-beat;animation-name:fa-beat;-webkit-animation-delay:0;-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:0;animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:ease-in-out;-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:ease-in-out;animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-bounce{-webkit-animation-name:fa-bounce;animation-name:fa-bounce;-webkit-animation-delay:0;-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:0;animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:cubic-bezier(.28,.84,.42,1);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1));animation-timing-function:cubic-bezier(.28,.84,.42,1);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1))}.fa-fade{-webkit-animation-name:fa-fade;animation-name:fa-fade;-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:cubic-bezier(.4,0,.6,1);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:cubic-bezier(.4,0,.6,1);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-beat-fade,.fa-fade{-webkit-animation-delay:0;-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:0;animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s)}.fa-beat-fade{-webkit-animation-name:fa-beat-fade;animation-name:fa-beat-fade;-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:cubic-bezier(.4,0,.6,1);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:cubic-bezier(.4,0,.6,1);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-flip{-webkit-animation-name:fa-flip;animation-name:fa-flip;-webkit-animation-delay:0;-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:0;animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:ease-in-out;-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:ease-in-out;animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-shake{-webkit-animation-name:fa-shake;animation-name:fa-shake;-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:linear;-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:linear;animation-timing-function:var(--fa-animation-timing,linear)}.fa-shake,.fa-spin{-webkit-animation-delay:0;-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:0;animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal)}.fa-spin{-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-duration:2s;-webkit-animation-duration:var(--fa-animation-duration,2s);animation-duration:2s;animation-duration:var(--fa-animation-duration,2s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:linear;-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:linear;animation-timing-function:var(--fa-animation-timing,linear)}.fa-spin-reverse{--fa-animation-direction:reverse}.fa-pulse,.fa-spin-pulse{-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-direction:normal;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:normal;animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:1s;-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:1s;animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:infinite;-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:infinite;animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:steps(8);-webkit-animation-timing-function:var(--fa-animation-timing,steps(8));animation-timing-function:steps(8);animation-timing-function:var(--fa-animation-timing,steps(8))}@media (prefers-reduced-motion:reduce){.fa-beat,.fa-beat-fade,.fa-bounce,.fa-fade,.fa-flip,.fa-pulse,.fa-shake,.fa-spin,.fa-spin-pulse{-webkit-animation-delay:-1ms;animation-delay:-1ms;-webkit-animation-duration:1ms;animation-duration:1ms;-webkit-animation-iteration-count:1;animation-iteration-count:1;transition-delay:0s;transition-duration:0s}}@-webkit-keyframes fa-beat{0%,90%{transform:scale(1)}45%{transform:scale(1.25);transform:scale(var(--fa-beat-scale,1.25))}}@keyframes fa-beat{0%,90%{transform:scale(1)}45%{transform:scale(1.25);transform:scale(var(--fa-beat-scale,1.25))}}@-webkit-keyframes fa-bounce{0%{transform:scale(1) translateY(0)}10%{transform:scale(1.1,.9) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{transform:scale(.9,1.1) translateY(-.5em);transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{transform:scale(1.05,.95) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{transform:scale(1) translateY(-.125em);transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em))}64%{transform:scale(1) translateY(0)}to{transform:scale(1) translateY(0)}}@keyframes fa-bounce{0%{transform:scale(1) translateY(0)}10%{transform:scale(1.1,.9) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{transform:scale(.9,1.1) translateY(-.5em);transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{transform:scale(1.05,.95) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{transform:scale(1) translateY(-.125em);transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em))}64%{transform:scale(1) translateY(0)}to{transform:scale(1) translateY(0)}}@-webkit-keyframes fa-fade{50%{opacity:.4;opacity:var(--fa-fade-opacity,.4)}}@keyframes fa-fade{50%{opacity:.4;opacity:var(--fa-fade-opacity,.4)}}@-webkit-keyframes fa-beat-fade{0%,to{opacity:.4;opacity:var(--fa-beat-fade-opacity,.4);transform:scale(1)}50%{opacity:1;transform:scale(1.125);transform:scale(var(--fa-beat-fade-scale,1.125))}}@keyframes fa-beat-fade{0%,to{opacity:.4;opacity:var(--fa-beat-fade-opacity,.4);transform:scale(1)}50%{opacity:1;transform:scale(1.125);transform:scale(var(--fa-beat-fade-scale,1.125))}}@-webkit-keyframes fa-flip{50%{transform:rotateY(-180deg);transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@keyframes fa-flip{50%{transform:rotateY(-180deg);transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@-webkit-keyframes fa-shake{0%{transform:rotate(-15deg)}4%{transform:rotate(15deg)}24%,8%{transform:rotate(-18deg)}12%,28%{transform:rotate(18deg)}16%{transform:rotate(-22deg)}20%{transform:rotate(22deg)}32%{transform:rotate(-12deg)}36%{transform:rotate(12deg)}40%,to{transform:rotate(0)}}@keyframes fa-shake{0%{transform:rotate(-15deg)}4%{transform:rotate(15deg)}24%,8%{transform:rotate(-18deg)}12%,28%{transform:rotate(18deg)}16%{transform:rotate(-22deg)}20%{transform:rotate(22deg)}32%{transform:rotate(-12deg)}36%{transform:rotate(12deg)}40%,to{transform:rotate(0)}}@-webkit-keyframes fa-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}@keyframes fa-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.fa-rotate-90{transform:rotate(90deg)}.fa-rotate-180{transform:rotate(180deg)}.fa-rotate-270{transform:rotate(270deg)}.fa-flip-horizontal{transform:scaleX(-1)}.fa-flip-vertical{transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{transform:scale(-1)}.fa-rotate-by{transform:rotate(none);transform:rotate(var(--fa-rotate-angle,none))}.fa-stack{display:inline-block;vertical-align:middle;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;z-index:auto;z-index:var(--fa-stack-z-index,auto)}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff;color:var(--fa-inverse,#fff)}.fa-sr-only,.fa-sr-only-focusable:not(:focus),.sr-only,.sr-only-focusable:not(:focus){position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.svg-inline--fa .fa-primary{fill:currentColor;fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:currentColor;fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fa-duotone.fa-inverse,.fad.fa-inverse{color:#fff;color:var(--fa-inverse,#fff)}code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#264f78}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#264f78}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;color:#db4c69;background:#1e1e1e}.namespace{opacity:.7}.token.doctype .token.doctype-tag{color:#569cd6}.token.doctype .token.name{color:#9cdcfe}.token.comment,.token.prolog{color:#6a9955}.language-html .language-css .token.punctuation,.language-html .language-javascript .token.punctuation,.token.punctuation{color:#d4d4d4}.token.boolean,.token.constant,.token.inserted,.token.number,.token.property,.token.symbol,.token.tag,.token.unit{color:#b5cea8}.token.attr-name,.token.builtin,.token.char,.token.deleted,.token.selector,.token.string{color:#ce9178}.language-css .token.string.url{text-decoration:underline}.token.entity,.token.operator{color:#d4d4d4}.token.operator.arrow{color:#569cd6}.token.atrule{color:#ce9178}.token.atrule .token.rule{color:#c586c0}.token.atrule .token.url{color:#9cdcfe}.token.atrule .token.url .token.function{color:#dcdcaa}.token.atrule .token.url .token.punctuation{color:#d4d4d4}.token.keyword{color:#569cd6}.token.keyword.control-flow,.token.keyword.module{color:#c586c0}.token.function,.token.function .token.maybe-class-name{color:#dcdcaa}.token.regex{color:#d16969}.token.important{color:#569cd6}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name,.token.maybe-class-name{color:#4ec9b0}.token.console,.token.interpolation,.token.parameter{color:#9cdcfe}.token.boolean,.token.punctuation.interpolation-punctuation{color:#569cd6}.token.exports .token.maybe-class-name,.token.imports .token.maybe-class-name,.token.property,.token.variable{color:#9cdcfe}.token.escape,.token.selector{color:#d7ba7d}.token.tag{color:#569cd6}.token.cdata,.token.tag .token.punctuation{color:grey}.token.attr-name{color:#9cdcfe}.token.attr-value,.token.attr-value .token.punctuation{color:#ce9178}.token.attr-value .token.punctuation.attr-equals{color:#d4d4d4}.token.entity{color:#569cd6}.token.namespace{color:#4ec9b0}code[class*=language-javascript],code[class*=language-jsx],code[class*=language-tsx],code[class*=language-typescript],pre[class*=language-javascript],pre[class*=language-jsx],pre[class*=language-tsx],pre[class*=language-typescript]{color:#9cdcfe}code[class*=language-css],pre[class*=language-css]{color:#ce9178}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-regex .token.anchor{color:#dcdcaa}.language-html .token.punctuation{color:grey}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight.line-highlight{background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.bg-light{background-color:#fff!important}code[class*=language-],pre[class*=language-]{background-color:#1a1b26;text-shadow:none;font-size:.9em;margin-bottom:1rem;border-radius:5px}#header-logo{max-width:150px}.topmenu-options{font-weight:700}.alert-message{max-width:20px;display:contents}.alert{border-bottom-width:7px;margin:1px 1px 1rem;border-radius:5px;padding:.9rem}.alert p{margin-bottom:0}.alert .col{padding-left:.9rem;padding-right:.9rem}.fa-solid{position:relative;top:5px}</style><link rel="preload" href="/gazel.io/_nuxt/static/1655290242/conventions/state.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/static/1655290242/conventions/payload.js" as="script"><link rel="preload" href="/gazel.io/_nuxt/static/1655290242/manifest.js" as="script">
  </head>
  <body data-spy="scroll" data-target=".idocs-navigation" data-offset="125" data-n-head="%7B%22data-spy%22:%7B%22ssr%22:%22scroll%22%7D,%22data-target%22:%7B%22ssr%22:%22.idocs-navigation%22%7D,%22data-offset%22:%7B%22ssr%22:%22125%22%7D%7D">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="main-wrapper"><div><header id="header" class="sticky-top"><nav class="primary-menu navbar navbar-expand-lg bg-light navbar-text-dark navbar-dropdown-light border-0"><div class="container-fluid"><button id="sidebarCollapse" type="button" class="navbar-toggler d-block d-md-none show"><span></span> <span class="w-75"></span> <span></span></button> <a href="/gazel.io" title="Gazel documentation" class="logo ml-md-2"><img id="header-logo" src="/gazel.io/main_logo_1x.png" alt="Gazel documentation"></a> <button type="button" data-toggle="collapse" data-target="#header-nav" class="navbar-toggler ml-auto"><span></span><span></span><span></span></button> <div id="header-nav" class="collapse navbar-collapse justify-content-end"><ul class="navbar-nav"><li><a href="/gazel.io/tutorial" class="topmenu-options">
              Tutorial
            </a></li><li><a href="/gazel.io/conventions" aria-current="page" class="topmenu-options nuxt-link-exact-active nuxt-link-active">
              Conventions
            </a></li><li><a href="/gazel.io/setup" class="topmenu-options">
              Setup
            </a></li><li><a href="/gazel.io/architecture" class="topmenu-options">
              Architecture
            </a></li><li><a href="/gazel.io/features" class="topmenu-options">
              Features
            </a></li><li><a href="/gazel.io/release-notes" class="topmenu-options">
              Release Notes
            </a></li></ul></div> <ul class="social-icons social-icons-sm ml-lg-2 mr-2"><li class="social-icons-github"><a data-toggle="tooltip" href="https://github.com/multinetinventiv/Gazel" target="_blank" data-original-title="Github"><i class="fab fa-github"></i></a></li></ul></div></nav></header> <div id="content" role="main"><div class="idocs-navigation bg-light active"><ul class="nav flex-column"><li class="nav-item"><a href="#index" class="nav-link">Conventions</a> <ul class="nav flex-column"></ul></li><li class="nav-item"><a href="#dependency-injection" class="nav-link">Dependency Injection</a> <ul class="nav flex-column"><li class="nav-item"><a href="#scopes" class="nav-link">Scopes</a></li><li class="nav-item"><a href="#manager-classes" class="nav-link">Manager classes</a></li><li class="nav-item"><a href="#injecting-a-dependency" class="nav-link">Injecting a Dependency</a></li><!----><!----><li class="nav-item"><a href="#imodulecontext-interface" class="nav-link">IModuleContext interface</a></li><li class="nav-item"><a href="#injecting-interfaces" class="nav-link">Injecting Interfaces</a></li><li class="nav-item"><a href="#injecting-multiple-implementations" class="nav-link">Injecting Multiple Implementations</a></li></ul></li><li class="nav-item"><a href="#business-services" class="nav-link">Business Services</a> <ul class="nav flex-column"><li class="nav-item"><a href="#public-methods" class="nav-link">Public Methods</a></li><li class="nav-item"><a href="#persistent-objects-as-parameters" class="nav-link">Persistent Objects as Parameters</a></li><li class="nav-item"><a href="#method-overloads" class="nav-link">Method Overloads</a></li><li class="nav-item"><a href="#optional-parameters" class="nav-link">Optional parameters</a></li><li class="nav-item"><a href="#list-and-array-parameters-and-return-types" class="nav-link">List and array parameters and return types</a></li><li class="nav-item"><a href="#no-dictionary-parameters-and-return-types" class="nav-link">No Dictionary parameters and return types</a></li><li class="nav-item"><a href="#data-transfer-objects-dtos" class="nav-link">Data Transfer Objects (DTOs)</a></li><!----><!----><li class="nav-item"><a href="#hiding-public-methods-and-properties" class="nav-link">Hiding Public Methods and Properties</a></li></ul></li><li class="nav-item"><a href="#data-persistence" class="nav-link">Data Persistence</a> <ul class="nav flex-column"><li class="nav-item"><a href="#persistent-class-conventions" class="nav-link">Persistent Class Conventions</a></li><!----><!----><!----><!----><li class="nav-item"><a href="#inserting-a-new-record" class="nav-link">Inserting a New Record</a></li><li class="nav-item"><a href="#updating-a-record" class="nav-link">Updating a Record</a></li><!----><!----><li class="nav-item"><a href="#deleting-a-record" class="nav-link">Deleting a Record</a></li><!----></ul></li><li class="nav-item"><a href="#relations" class="nav-link">Relations</a> <ul class="nav flex-column"><li class="nav-item"><a href="#many-to-one-relation" class="nav-link">Many-to-One Relation</a></li><li class="nav-item"><a href="#one-to-many-relations" class="nav-link">One-to-Many Relations</a></li><li class="nav-item"><a href="#eager-fetching-and-lazy-loading" class="nav-link">Eager-Fetching and Lazy-Loading</a></li><!----><li class="nav-item"><a href="#one-to-any-relation" class="nav-link">One-to-Any Relation</a></li></ul></li><li class="nav-item"><a href="#queries" class="nav-link">Queries</a> <ul class="nav flex-column"><li class="nav-item"><a href="#query-class-conventions" class="nav-link">Query Class Conventions</a></li><li class="nav-item"><a href="#by-methods" class="nav-link">By Methods</a></li><!----><!----><!----><li class="nav-item"><a href="#firstby-and-singleby" class="nav-link">FirstBy and SingleBy</a></li><li class="nav-item"><a href="#countby" class="nav-link">CountBy</a></li><li class="nav-item"><a href="#anyby" class="nav-link">AnyBy</a></li><li class="nav-item"><a href="#minby-and-maxby" class="nav-link">MinBy and MaxBy</a></li><li class="nav-item"><a href="#optional-where-clauses" class="nav-link">Optional Where Clauses</a></li><!----><!----><li class="nav-item"><a href="#query-base-class" class="nav-link">Query Base Class</a></li><!----><!----></ul></li><li class="nav-item"><a href="#transaction-management" class="nav-link">Transaction Management</a> <ul class="nav flex-column"><li class="nav-item"><a href="#using-main-transaction" class="nav-link">Using Main Transaction</a></li><li class="nav-item"><a href="#creating-new-transactions" class="nav-link">Creating New Transactions</a></li><!----><li class="nav-item"><a href="#nested-transactions" class="nav-link">Nested Transactions</a></li><li class="nav-item"><a href="#example-update-balance-of-an-account" class="nav-link">Example: Update Balance of an Account</a></li></ul></li></ul></div> <div class="idocs-content"><div class="container"><div><div><section id="index"><h1 class="article-title">Conventions</h1></section> <div class="nuxt-content"><p>Gazel heavily relies on Convention over Configuration design paradigm. In this
section you will learn about the conventions in Gazel.</p>
<ul>
<li><a href="/gazel.io/conventions#dependency-injection"><strong>Dependency Injection</strong></a>: Learn to use
how to make use of dependency injection in Gazel</li>
<li><a href="/gazel.io/conventions#business-services"><strong>Business Services</strong></a>: Find out how a
public method turns into a business service</li>
<li><a href="/gazel.io/conventions#data-persistence"><strong>Data Persistence</strong></a>: Understand conventions
for data persistence</li>
<li><a href="/gazel.io/conventions#relations"><strong>Relations</strong></a>: Explore different ways to create
relations between persistent classes</li>
<li><a href="/gazel.io/conventions#queries"><strong>Queries</strong></a>: Learn how to create query services</li>
<li><a href="/gazel.io/conventions#transaction-management"><strong>Transaction Management</strong></a>: Learn
about how Gazel manages transactions</li>
</ul></div></div><div><section id="dependency-injection"><h1 class="article-title">Dependency Injection</h1></section> <div class="nuxt-content"><p>Gazel uses <a href="http://www.castleproject.org/projects/windsor" rel="nofollow noopener noreferrer" target="_blank">Castle.Windsor</a> for Dependency Injection. Using Convention over
Configuration capabilities of Castle.Windsor, you don't have to register your
classes one by one. Every public class in module projects are automatically
registered to the kernel. In this document you will find ways on how to make
use of this feature.</p>
<h2 id="scopes"><a href="#scopes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Scopes</h2>
<p>There are 3 types of scope;</p>
<ol>
<li>Transient: For every resolution, Windsor creates a new instance.</li>
<li>Request: For every request there is only one instance. After the request
ends, object is disposed.</li>
<li>Singleton: There is only one instance until application is shut down.</li>
</ol>
<p><code>Manager</code> and <code>Query</code> classes are singleton by convention and the rest are
transient.</p>
<h2 id="manager-classes"><a href="#manager-classes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Manager classes</h2>
<p>For a class to be a manager class, it should have <code>Manager</code> suffix.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Manager classes are singleton by convention. You can make use of <code>Manager</code>
classes to provide general domain logic of a module, batch operations or
complex query services.</p>
<h2 id="injecting-a-dependency"><a href="#injecting-a-dependency" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Injecting a Dependency</h2>
<p>Every public class is registered to Castle.Windsor by their own type so that
they can be injected to other classes.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">UserManager</span> userManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token class-name">UserManager</span> userManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userManager <span class="token operator">=</span> userManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div>
<h3 id="public-constructors"><a href="#public-constructors" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Public Constructors</h3>
<p>Every public class should contain a <code>public</code> constructor, in order for
Castle.Windsor to register and configure them.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="circular-dependencies"><a href="#circular-dependencies" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Circular Dependencies</h3>
<p>Avoid creating circular dependencies as shown below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token class-name">UserManager</span> userManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token function">UserManager</span><span class="token punctuation">(</span><span class="token class-name">ProductManager</span> userManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre></div>
<p>For such cases;</p>
<ol>
<li>Consider refactoring your code. Two classes shouldn't depend on each other.</li>
<li>If you think you have no other choice, then you can refactor code as shown
below;</li>
</ol>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">UserManager</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">ProductManager</span> ProductManager
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ProductManager</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Scope<span class="token punctuation">.</span>Any<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="imodulecontext-interface"><a href="#imodulecontext-interface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>IModuleContext</code> interface</h2>
<p><code>IModuleContext</code> is basically an abstraction for your domain objects to be
isolated from the 3rd party libraries.</p>
<p>For singleton objects, mainly <code>Manager</code> objects, we encourage you to inject
them through constructor. On the other hand, if you want to create a transient
object, you can make use of <code>IModuleContext.New&lt;T>()</code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomethingHeavy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BatchUserOperation<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DoSomethingHeavy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchUserOperation</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">UserManager</span> userManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">BatchUserOperation</span><span class="token punctuation">(</span><span class="token class-name">UserManager</span> userManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userManager <span class="token operator">=</span> userManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">internal</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomethingHeavy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="injecting-interfaces"><a href="#injecting-interfaces" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Injecting Interfaces</h2>
<p>Public classes can also be injected using their interfaces</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IUserManager</span> userManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token class-name">IUserManager</span> userManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userManager <span class="token operator">=</span> userManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserManager</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IUserManager</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div>
<h2 id="injecting-multiple-implementations"><a href="#injecting-multiple-implementations" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Injecting Multiple Implementations</h2>
<p>If an interface has more than one implementations then you can inject all of
them at once by using <code>IList&lt;T></code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">IList<span class="token punctuation">&lt;</span>INotifier<span class="token punctuation">></span></span> notifiers<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ProductManager</span><span class="token punctuation">(</span><span class="token class-name">IList<span class="token punctuation">&lt;</span>INotifier<span class="token punctuation">></span></span> notifiers<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>notifiers <span class="token operator">=</span> notifiers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">INotifier</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsNotifier</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifier</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailNotifier</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifier</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PushNotifier</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifier</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div></div></div><div><section id="business-services"><h1 class="article-title">Business Services</h1></section> <div class="nuxt-content"><p>Gazel configures <a href="https://github.com/multinetinventiv/routine" rel="nofollow noopener noreferrer" target="_blank">Routine</a> to expose every public method to be a business
service. A business service is a public method that you can call using HTTP.</p>
<h2 id="public-methods"><a href="#public-methods" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Public Methods</h2>
<p><code>public</code> methods are directly exposed as business services.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Branch<span class="token punctuation">></span></span> <span class="token function">GetBranches</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Branches<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByCompany</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="persistent-objects-as-parameters"><a href="#persistent-objects-as-parameters" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Persistent Objects as Parameters</h2>
<p>You can use a persistent object directly in your business methods. Gazel will
automatically lookup for a record with given id. If record is not found, it
will automatically throw <code>ObjectNotFoundException</code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Branch</span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Branch<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> district<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Therefore, with the above code, you ensured that district is either null or an
existing record in database.</p>
<h2 id="method-overloads"><a href="#method-overloads" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Method Overloads</h2>
<p>Method overloads are considered as one business service in service layer. If
you create method overloads like below, then you will see only one business
service with all of parameters.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Branch</span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">AddBranch</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> district<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Branch</span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">,</span> <span class="token class-name">Company</span> ownerCompany<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If you don't send an <code>ownerCompany</code> then the first overload will be called, if
you fulfill all parameters, then the second overload will be called.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Overload selection is automatic, and Gazel will try to pass as many
parameters as it can. Assume that you send <code>name</code> and <code>ownerCompany</code> to above
<code>AddBranch</code> service. Then first overload matches only <code>name</code> parameter, but
second overload matches both of them. So invocation will be on the second one
and <code>district</code> parameter will be <code>null</code>.</p>
</div></div></div>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>If return type of overloads are not the same, the first overload will be a
business service, but the second one will be ignored.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">// First overload returns void</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token comment">// Second overload returns Branch, this will not be a business service.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Branch</span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">,</span> <span class="token class-name">Company</span> ownerCompany<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div></div></div>
<h2 id="optional-parameters"><a href="#optional-parameters" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Optional parameters</h2>
<p>Gazel supports optional parameters in business services. You can use
optional parameters instead of overloads.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Branch</span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">District</span> district<span class="token punctuation">,</span>
        <span class="token class-name">Company</span> ownerCompany <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="list-and-array-parameters-and-return-types"><a href="#list-and-array-parameters-and-return-types" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>List</code> and <code>array</code> parameters and return types</h2>
<p>You can use <code>List</code> class for both parameters and return types as long as type
parameter <code>T</code> for lists is a supported type.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Branch<span class="token punctuation">></span></span> <span class="token function">GetBranches</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Employee<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="no-dictionary-parameters-and-return-types"><a href="#no-dictionary-parameters-and-return-types" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>No <code>Dictionary</code> parameters and return types</h2>
<p>Gazel does not support <code>Dictionary</code> in business services by design. So any
service with Dictionary parameter or return type will not be exposed as a
business service. The reason behind this design decision is to favor
strongly-typed classes over generic dictionaries.</p>
<h2 id="data-transfer-objects-dtos"><a href="#data-transfer-objects-dtos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Data Transfer Objects (DTOs)</h2>
<p>If you need a class that is not a persistent class for input or output, then
you can make use of DTO structs.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">// This will not be a business service</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Data transfer objects are supported in two different usages in mind;</p>
<ol>
<li>DTOs for parameters: Input DTOs</li>
<li>DTOs for results: Output DTOs</li>
</ol>
<p>As their names imply,</p>
<ol>
<li>You create an input DTO only to use in parameters of your business services</li>
<li>You create an output DTO only to return custom data as a result of a
business service</li>
</ol>
<p>And DTOs exist only to transfer data. Because of this reason, Gazel uses
<code>struct</code>s for DTOs.</p>
<h3 id="input-dtos"><a href="#input-dtos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Input DTOs</h3>
<p>To accept a complex data in service parameters you can make use of input DTOs.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">NewBranch</span>
<span class="token punctuation">{</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name">City</span> City <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name">Country</span> Country <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">NewBranch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name">Country</span> country<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Address <span class="token operator">=</span> address<span class="token punctuation">;</span>
        City <span class="token operator">=</span> city<span class="token punctuation">;</span>
        Country <span class="token operator">=</span> country<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Properties of input DTOs should be <code>internal</code> and constructor of input DTOs
should be <code>public</code>. This convention implies that;</p>
<ul>
<li>This struct <strong>should not</strong> be used for results because no-one from outside
will see its properties,</li>
<li>This struct <strong>should</strong> be used for parameters because constructor is public
and everyone can create an instance of this struct.</li>
</ul>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Constructor parameters of input DTOs are just like parameters of business
services. You can use</p>
<ul>
<li>primitives and other value types,</li>
<li>persistent classes,</li>
<li>other input DTOs</li>
</ul>
<p>as parameters of constructor.</p>
</div></div></div>
<p>Example usage of an input DTO in a business service would be as follows;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddBranches</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>NewBranch<span class="token punctuation">></span></span> newBranches<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>If you need to get a list of name/value pairs you can simply create an input
DTO with <code>Name</code> and <code>Value</code> properties. And use list of this DTO in a
business service.</p>
</div></div></div>
<h3 id="output-dtos"><a href="#output-dtos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Output DTOs</h3>
<p>To return custom data from business services you can make use of output DTOs.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">BranchInfo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">City</span> City <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Country</span> Country <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">internal</span> <span class="token function">BranchInfo</span><span class="token punctuation">(</span><span class="token class-name">Branch</span> branch<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> brnach<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
        Address <span class="token operator">=</span> branch<span class="token punctuation">.</span>Address<span class="token punctuation">;</span>
        City <span class="token operator">=</span> branch<span class="token punctuation">.</span>City<span class="token punctuation">;</span>
        Country <span class="token operator">=</span> branch<span class="token punctuation">.</span>City<span class="token punctuation">.</span>Country<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Properties of output DTOs should be <code>public</code> and constructor of output DTOs
should be <code>internal</code>. This convention implies that;</p>
<ul>
<li>This struct <strong>should</strong> be used for results because its properties are public
and everyone can see them,</li>
<li>This struct <strong>should not</strong> be used for parameters because its constructor is
internal and only internal classes create instances of this struct.</li>
</ul>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>Notice that above constructor gets an instance of <code>Branch</code> class and assigns
values by using this <code>Branch</code> instance. This will help you to create an
instance of this struct whenever you have an instance of a <code>Branch</code> class.</p>
</div></div></div>
<p>Example usage of this output DTO in a business service would be as follows;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>BranchInfo<span class="token punctuation">></span></span> <span class="token function">GetBranches</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Branches<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ByCompany</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>b <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BranchInfo</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="hiding-public-methods-and-properties"><a href="#hiding-public-methods-and-properties" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Hiding Public Methods and Properties</h2>
<p>In some cases you might need to have a public method, but you might not want it
to be exposed as a business service. In this kind of cases, you can mark a
business service by adding an <code>Internal</code> attribute on top of a <code>class</code>,
<code>constructor</code>, <code>method</code> or <code>property</code> like below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Internal</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InternalManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">PublicData</span> <span class="token function">ShouldNotBeRegisteredAsAService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PublicData</span><span class="token punctuation">(</span><span class="token string">"public internal"</span><span class="token punctuation">,</span> <span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublicManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">InternalManager</span> internalManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">PublicManager</span><span class="token punctuation">(</span><span class="token class-name">InternalManager</span> internalManager<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>internalManager <span class="token operator">=</span> internalManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">PublicData</span> <span class="token function">PublicService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> internalManager<span class="token punctuation">.</span><span class="token function">ShouldNotBeRegisteredAsAService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Internal</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InternalService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">PublicData</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Internal</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> InternalProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PublicProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Internal</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token function">PublicData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> internalProperty<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> publicProperty<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        InternalProperty <span class="token operator">=</span> internalProperty<span class="token punctuation">;</span>
        PublicProperty <span class="token operator">=</span> publicProperty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>For the above example;</p>
<ul>
<li><code>InternalManager</code> class and all of its members will be hidden in service
layer.</li>
<li><code>PublicManager.InternalService</code> method will be hidden in service layer.</li>
<li>For <code>PublicData</code> class;
<ul>
<li>The constructor will be hidden,</li>
<li><code>InternalProperty</code> will be hidden,</li>
<li>But <code>PublicProperty</code> will be available in service layer</li>
</ul>
</li>
</ul>
<p>You can think of this attribute as an additional access modifier to <code>public</code>,
<code>private</code>, <code>internal</code>, <code>protected</code> and <code>protected internal</code> access modifier
which we sometimes refer as <code>public internal</code>.</p></div></div><div><section id="data-persistence"><h1 class="article-title">Data Persistence</h1></section> <div class="nuxt-content"><p>Gazel configures <a href="https://nhibernate.info" rel="nofollow noopener noreferrer" target="_blank">NHibernate</a> with the help of <a href="https://github.com/nhibernate/fluent-nhibernate" rel="nofollow noopener noreferrer" target="_blank">Fluent NHibernate</a> to
provide a data persistence layer.</p>
<h2 id="persistent-class-conventions"><a href="#persistent-class-conventions" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Persistent Class Conventions</h2>
<p>An object is <code>Persistent</code> if its class injects its own repository. This
convention ensures that there is only one class to deal with one table in the
database.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> repository<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token function">Company</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Company</span><span class="token punctuation">(</span><span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> repository<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This injection tells Gazel to configure this class to be a persistent class
which means that there will be an ORM configuration for this class.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p><code>protected Task() { }</code> constructor is there for NHibernate to be able to
create proxies on persistent classes for lazy loading.</p>
</div></div></div>
<h3 id="query-classes"><a href="#query-classes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Query classes</h3>
<p>When you have a persistent class, this means that you will need to read
persistent objects from corresponding database table. That's why Gazel requires
you to create a query class for every persistent class.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>It's better to put persistent and query classes of a table into one source
file.</p>
</div></div></div>
<p>In this document we will explain persistent classes rather than query classes.
You can find detailed explanation for queries in <a href="/gazel.io/features#queries">this
page</a>.</p>
<h3 id="id-property"><a href="#id-property" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Id property</h3>
<p>Every persistent class should have an identifier property of type <code>int</code> and of
name <code>Id</code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This property will be used by NHibernate to be the primary key and first level
caching.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Id properties are automatically configured to be an identity column which
means that database is responsible for assigning Id values.</p>
</div></div></div>
<h3 id="virtual-keyword"><a href="#virtual-keyword" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>virtual</code> keyword</h3>
<p>Every member in persistent classes (methods and properties) should be <code>virtual</code>
in order NHibernate to be able to create proxies for lazy loading.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-danger row"><div class="alert-message col"><i class="fa-solid fa-circle-xmark"></i></div> <div class="col">

<p>In persistent classes <code>private</code> access modifier causes null reference
exceptions. Use <code>protected virtual</code> instead of <code>private</code> to workaround this
problem.</p>
</div></div></div>
<h3 id="protected-setters"><a href="#protected-setters" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>protected</code> setters</h3>
<p>We encourage you to use protected setters so that you can make sure that no
other class than the class itself is able to modify the values of its
properties.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>It could be <code>private</code> setters but NHibernate wouldn't be able to create
proxies for lazy loading.</p>
</div></div></div>
<p>For a more detailed explanation please have a look at <a href="/gazel.io/tutorial#database-transactions">this tutorial
page</a>.</p>
<h2 id="inserting-a-new-record"><a href="#inserting-a-new-record" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Inserting a New Record</h2>
<p>There is an <code>Insert</code> method in <code>IRepository&lt;T></code> which does what it says. The
convention for insert operations is as follows;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Company</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Address <span class="token operator">=</span> address<span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><code>With</code> methods are part of the creation of a persistent object. We use builder
pattern for this operation. For a more detailed explanation about <code>With</code>
methods please have a look at <a href="/gazel.io/tutorial#persistent-classes">this tutorial
page</a>.</p>
<p><code>With</code> methods are;</p>
<ul>
<li><code>protected</code> and <code>virtual</code> because of NHibernate's lazy loading requirements,</li>
<li><code>internal</code> to be able to use from other classes in its module.</li>
</ul>
<p>Below you can see an example of an insert operation;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateCompany</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="updating-a-record"><a href="#updating-a-record" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Updating a Record</h2>
<p>When a persistent object is loaded, its state is managed by NHibernate. This
feature of NHibernate enables services to  automatically update a record upon
commit.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Above method is enough for the <code>Company</code> object to update itself. At this point
object is marked as dirty by NHibernate. Whenever NHibernate session is
flushed, an update statement will be executed in the database. There are 3
reasons for NHibernate session to be flushed;</p>
<ol>
<li>When current transaction is committed NHibernate flushes current session,
hence record gets updated.</li>
<li>When a select query is sent to <code>Company</code> table, either directly or via table
joins.</li>
<li>You make an explicit call to <code>IRepository&lt;T>.Flush()</code> which calls
NHibernate's session flush directly.</li>
</ol>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p><code>IRepository&lt;T>.Flush()</code> causes all dirty objects to be flushed, not just the
persistent object it is called, nor instances of <code>&lt;T></code>. This is how
NHibernate implements session flush.</p>
</div></div></div>
<h3 id="batch-updates"><a href="#batch-updates" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Batch Updates</h3>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Active <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeactivateCompanies</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> company <span class="token keyword">in</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Companies<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            company<span class="token punctuation">.</span><span class="token function">Deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><code>DeactivateCompanies</code> method iterates through a list of <code>Company</code> objects.
Changing a property value does not cause an immediate update. Upon NHibernate
session flush, above updates will be executed as batch.</p>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>If you execute a query to <code>Company</code> table inside <code>Deactivate</code> method, this
will cause NHibernate to flush on every iteration and cause an update
execution one by one. This can create a performance flaw in your code. If you
need to check something before such an update (e.g. checking if new username
exists before updating it), and if you want the operation to be a batch
update, then you need to optimize your query accordingly. For "unique
username" example, you might consider checking uniqueness at once.</p>
</div></div></div>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangeUsername</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">ChangeUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangeUsername</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> batch<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>batch<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Users<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CountByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        Username <span class="token operator">=</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangeUsernames</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span>UsernameChange<span class="token punctuation">></span></span> changes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Users<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CountByUsernames</span><span class="token punctuation">(</span>changes<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>To<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">"changes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">var</span></span> users <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Users<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByUsernames</span><span class="token punctuation">(</span>changes<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>From<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> user <span class="token keyword">in</span> users<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            users<span class="token punctuation">.</span><span class="token function">ChangeUsername</span><span class="token punctuation">(</span>change<span class="token punctuation">.</span>To<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="force-update"><a href="#force-update" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Force Update</h3>
<p>If a persistent class implements <code>IAuditable</code>, this means that with every
update to objects of that class, Gazel will automatically update values of
<code>AuditInfo</code> properties. A force update is handy when you only want to update
<code>AuditInfo</code> properties (e.g. <code>ModifyDate</code>). You can force an object to be
updated using <code>ForceUpdate</code> method of <code>IRepository&lt;T></code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAuditable</span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">AuditInfo</span> AuditInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">ForceUpdate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div>
<p>In the above example, we want a company record to be updated whenever an
employee is added to it. Since adding an employee does not cause an update to a
company record, we force company objects to be updated upon adding an employee.
This <code>ForceUpdate</code> call will cause a company object's <code>AuditInfo.ModifyDate</code>
column to be refreshed with <code>AddEmployee</code> operation.</p>
<div><div class="alert alert-danger row"><div class="alert-message col"><i class="fa-solid fa-circle-xmark"></i></div> <div class="col">

<p>If given persistent class does not implement <code>IAuditable</code> interface, an
<code>InvalidOperationException</code> will be thrown.</p>
</div></div></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>If a persistent object is already dirty and forced to be updated, there will
be only one <code>UPDATE</code> statement to update changes to database.</p>
</div></div></div>
<h2 id="deleting-a-record"><a href="#deleting-a-record" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Deleting a Record</h2>
<p>Deleting is done by <code>Delete</code> method in <code>IRepository&lt;T></code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="batch-deletes"><a href="#batch-deletes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Batch Deletes</h3>
<p>Behaviour of delete operations are similar to update operations. If you do it
like above, delete statements will be executed when NHibernate session is
flushed. If you execute a query before deleting, this would prevent NHibernate
from performing a batch operation. For detailed explanation have a look at
<em>Batch Updates</em> section above in this document.</p></div></div><div><section id="relations"><h1 class="article-title">Relations</h1></section> <div class="nuxt-content"><p>Gazel configures NHibernate so that you can define relations intiutively.</p>
<h2 id="many-to-one-relation"><a aria-hidden="true" href="#many-to-one-relation" tabindex="-1"><span class="icon icon-link"></span></a>Many-to-One Relation</h2>
<p>This relation is the most used type among all and the simplest one.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Company</span> Company <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Above code is enough to set a many-to-one relation between <code>Employee</code> and
<code>Company</code> classes. In this example, <code>Employee</code> table will require a column
named <code>CompanyId</code> that is mapped to <code>Company</code> property as a many to one
relation.</p>
<h2 id="one-to-many-relations"><a aria-hidden="true" href="#one-to-many-relations" tabindex="-1"><span class="icon icon-link"></span></a>One-to-Many Relations</h2>
<p>Creating <code>List&lt;T></code> properties on persistent classes will NOT cause a
one-to-many relation. To have this relation, simply create a method that
queries child records from the parent record;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span> <span class="token function">GetEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employees<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByCompany</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employees</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span> <span class="token function">ByCompany</span><span class="token punctuation">(</span><span class="token class-name">Company</span> company<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>e <span class="token operator">=></span> e<span class="token punctuation">.</span>Company <span class="token operator">==</span> company<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="eager-fetching-and-lazy-loading"><a aria-hidden="true" href="#eager-fetching-and-lazy-loading" tabindex="-1"><span class="icon icon-link"></span></a>Eager-Fetching and Lazy-Loading</h2>
<p>Gazel configures NHibernate to eager fetch persistent object with one level.
This means that when you query a list of persistent objects, their parents will
be fetched eagerly using an inner join. But their grandparents will be
lazy-loaded.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Company</span> Company <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Department</span> Department <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>When you query employees with something like
<code>context.Query&lt;Employees>().ByName("mike")</code>, the resulting <code>Employee</code> objects
will have <code>Department</code> objects eagerly fetched. However, when you try to access
a property of their <code>Company</code> object (other than Id property), a query will be
executed using that <code>Company</code> object's primary key.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SomeEmployeeOperation</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> employees <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employees<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> employee <span class="token keyword">in</span> employees<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> departmentName <span class="token operator">=</span> employee<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Name<span class="token punctuation">;</span> <span class="token comment">//No query is executed, department is already loaded</span>
            <span class="token class-name"><span class="token keyword">var</span></span> companyName <span class="token operator">=</span> employee<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Company<span class="token punctuation">.</span>Name<span class="token punctuation">;</span> <span class="token comment">//A query is executed to load company object from database</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="about-n--1-select-problem"><a aria-hidden="true" href="#about-n--1-select-problem" tabindex="-1"><span class="icon icon-link"></span></a>About N + 1 select problem</h3>
<p>Above code causes N+1 select problem, which can be a performance issue. If you
encounter this problem, you need to consider selecting all grandparents
(<code>Company</code>) of the children (<code>Employee</code>) with an additional query so that there
will be only 2 queries in total.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SomeEmployeeOperation</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> employees <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employees<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> companies <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Companies<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByIds</span><span class="token punctuation">(</span>employees<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>e <span class="token operator">=></span> e<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Company<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> employee <span class="token keyword">in</span> employees<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> departmentName <span class="token operator">=</span> employee<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Name<span class="token punctuation">;</span> <span class="token comment">//No query is executed, department is already loaded</span>
            <span class="token class-name"><span class="token keyword">var</span></span> companyName <span class="token operator">=</span> employee<span class="token punctuation">.</span>Department<span class="token punctuation">.</span>Company<span class="token punctuation">.</span>Name<span class="token punctuation">;</span> <span class="token comment">//No query is executed, company is already loaded with the second query.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="one-to-any-relation"><a aria-hidden="true" href="#one-to-any-relation" tabindex="-1"><span class="icon icon-link"></span></a>One-to-Any Relation</h2>
<p>This relation type enables you to map your properties to interfaces, which we
refer to as <em>Interface Mapping</em> or <em>Polymorphic Mapping</em>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">ICustomer</span> Customer <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>For NHibernate to map this property to a table it needs two columns;</p>
<ol>
<li><code>CustomerId</code>: The id value of related record, like in a Many-to-One relation,</li>
<li><code>CustomerType</code>: Type of related record.</li>
</ol>
<p>NHibernate uses type column to know which table to select. This type
information is retrieved from an enum that corresponds to <code>IOrderProcessor</code>
interface.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomer</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CustomerType</span>
<span class="token punctuation">{</span>
    RealPerson <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    LegalEntity <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealPerson</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomer</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LegalEntity</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomer</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div>
<p>Conventions for one-to-any mapping are;</p>
<ul>
<li>For an interface named <code>I[Name]</code> (e.g. <code>ICustomer</code>)</li>
<li>There should be an enum named <code>[Name]Type</code> (e.g. <code>CustomerType</code>)</li>
<li>Each enum member must be a persistent class and implement <code>I[Name]</code> interface
(e.g. <code>RealPerson</code> and <code>LegalEntity</code>).</li>
<li>When <code>I[Name]</code> is mapped to a persistent class with a property named
<code>[Property]</code>,
<ul>
<li><code>[Property]Id</code> (<code>CustomerId</code>) column stores the id value of the related
record</li>
<li><code>[Property]Type</code> (<code>CustomerType</code>) column store enum member values (<code>1</code> or
<code>2</code>), not member names (<code>RealPerson</code> or <code>LegalEntity</code>)</li>
</ul>
</li>
</ul>
<p>In a query method, you can filter by object like this;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Orders</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Order<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Order<span class="token punctuation">></span></span> <span class="token function">ByCustomer</span><span class="token punctuation">(</span><span class="token class-name">ICustomer</span> customer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>wa <span class="token operator">=></span> wa<span class="token punctuation">.</span>Customer <span class="token operator">==</span> customer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//uses both CustomerId and CustomerType columns</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Or you can filter by type like this;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Orders</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Order<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">internal</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Order<span class="token punctuation">></span></span> <span class="token generic-method"><span class="token function">ByCustomerType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICustomer</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>wa <span class="token operator">=></span> wa<span class="token punctuation">.</span>Customer <span class="token keyword">is</span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//uses only Customer column</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>Unfortunately interface mappings cannot be fetched eagerly. So beware of N+1
select problems if you use this feature.</p>
</div></div></div></div></div><div><section id="queries"><h1 class="article-title">Queries</h1></section> <div class="nuxt-content"><p>For persistence classes, there needs to be corresponding query class to read
records from database. This section focuses on how you can organize your
queries in your projects.</p>
<h2 id="query-class-conventions"><a aria-hidden="true" href="#query-class-conventions" tabindex="-1"><span class="icon icon-link"></span></a>Query Class Conventions</h2>
<p>The main purpose of query classes is to organize all of the queries of a table
together into one place. Query classes are named after their corresponding
persistent class. They are in plural form like below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You can access pluralization service through <code>IModuleContext.Pluralizer</code>
property.</p>
</div></div></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>If pluralization service does not provide what you want, you can make use of
<code>[Name]s</code> convention. For instance, there is a persistent class named <code>Xyz</code>,
when you name its query class as <code>Xyzs</code>, it will work as well.</p>
</div></div></div>
<p>Query classes are singleton by convention and its usage is as follows;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeactivateCompanies</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> company <span class="token keyword">in</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Companies<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            company<span class="token punctuation">.</span><span class="token function">Deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Query classes are singleton by convention, so you can inject query classes as
well;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Companies</span> companies<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CompanyManager</span><span class="token punctuation">(</span><span class="token class-name">Companies</span> companies<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>companies <span class="token operator">=</span> companies<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeactivateCompanies</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> company <span class="token keyword">in</span> companies<span class="token punctuation">.</span><span class="token function">ByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            company<span class="token punctuation">.</span><span class="token function">Deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Query classes should extend <code>Query&lt;T></code> which is an abstract class with helper
functionalities to make it simple to implement query methods. To provide these
functionalities it requires <code>IModuleContext</code> to be injected.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">Companies</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If you want to inject other dependencies, you are free to do it like in any
other class.</p>
<h2 id="by-methods"><a aria-hidden="true" href="#by-methods" tabindex="-1"><span class="icon icon-link"></span></a>By Methods</h2>
<p>By methods are type of queries that return list of persistent objects.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><code>By</code> method is declared in <code>Query&lt;T></code> base class to help you create query
methods quickly.</p>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p><code>Query&lt;T>.By</code> method accepts an expression that is converted to <code>SQL</code>. This
expression never runs in your .NET application. Because of this reason you
are not supposed to call methods of persistent classes within these
expressions.  For example; <code>By(c => c.GetEmployees().Count > 0)</code> will not
work.</p>
</div></div></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>Do not use <code>Id</code> properties for filtering;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City<span class="token punctuation">.</span>Id <span class="token operator">==</span> city<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This will cause a <code>NullReferenceException</code> when city is <code>null</code>. Prefer
<code>c.City == city</code> expression, which will handle both cases in one shot.</p>
</div></div></div>
<p>A by method can also be implemented like below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">)</span> <span class="token operator">=></span>
        Lookup<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><code>Lookup</code> property is declared in <code>Query&lt;T></code> base class and is of type
<code>ILookup&lt;T></code>. This interface acts as a gateway to NHibernate. <code>ILookup&lt;T>.List</code>
method returns an <code>IQueryable&lt;T></code> instance. You may use this instance when <code>By</code>
method is not enough.</p>
<h3 id="single-parameter-convention"><a aria-hidden="true" href="#single-parameter-convention" tabindex="-1"><span class="icon icon-link"></span></a>Single Parameter Convention</h3>
<p>When there is only one parameter in query methods, we suggest you to include
parameter name in method name like below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transactions</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span> <span class="token function">ByFrom</span><span class="token punctuation">(</span><span class="token class-name">Account</span> from<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">By</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>From <span class="token operator">==</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Consider you have two different queries on <code>Transaction</code> table, first one
filters using <code>From</code> column, second one filters using <code>To</code> column;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transactions</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name">Account</span> from<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">By</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>From <span class="token operator">==</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name">Account</span> to<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">By</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>To <span class="token operator">==</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Above code will not compile because there are two methods with exactly the same
signature. To make it compile, you need to rename one of them. We prefer
renaming both to provide consistency in naming;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transactions</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span> <span class="token function">ByFrom</span><span class="token punctuation">(</span><span class="token class-name">Account</span> from<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">By</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>From <span class="token operator">==</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span> <span class="token function">ByTo</span><span class="token punctuation">(</span><span class="token class-name">Account</span> to<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">By</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>To <span class="token operator">==</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="take-and-skip"><a aria-hidden="true" href="#take-and-skip" tabindex="-1"><span class="icon icon-link"></span></a>Take and Skip</h3>
<p>You can use <code>skip</code> and <code>take</code> extensions methods. They are optional parameters.
<code>take</code> parameter extracts the first n elements from the beginning of the target
sequence. Here is how you can do it;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">take</span><span class="token punctuation">:</span> take<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">All</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">take</span><span class="token punctuation">:</span> take<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>skip</code> parameter moves pass the first n elements from the beginning of the
target sequence, returning the remainder;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">skip</span><span class="token punctuation">:</span> skip<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">All</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">skip</span><span class="token punctuation">:</span> skip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>You can apply pagination by using <code>skip</code> and <code>take</code> optional parameters. Here
is how you can do it;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">skip</span><span class="token punctuation">:</span> skip<span class="token punctuation">,</span> <span class="token named-parameter punctuation">take</span><span class="token punctuation">:</span>take<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">All</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">skip</span><span class="token punctuation">:</span> skip<span class="token punctuation">,</span> <span class="token named-parameter punctuation">take</span><span class="token punctuation">:</span>take<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Alternatively, you can also be implemented by using <code>ILookup&lt;T>.List</code> as shown
below. It actually returns an <code>IQueryable&lt;T></code> instance.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">)</span> <span class="token operator">=></span>
        Lookup
            <span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span>take<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">)</span> <span class="token operator">=></span>
        Lookup
            <span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> take<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> skip<span class="token punctuation">)</span> <span class="token operator">=></span>
        Lookup
            <span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&&</span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>City<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span>take<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="orderby-and-orderbydescending"><a aria-hidden="true" href="#orderby-and-orderbydescending" tabindex="-1"><span class="icon icon-link"></span></a>OrderBy and OrderByDescending</h3>
<p>You can use <code>orderBy</code> and <code>orderByDescending</code> extensions methods. They are
optional parameters.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>You can use <code>orderBy</code> and <code>orderByDescending</code> parameters in <code>By</code>, <code>All</code>,
<code>FirstBy</code>,  methods.</p>
</div></div></div>
<p>The <code>orderby</code> parameter sorts the elements of a sequence in ascending order
according to a key.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">ByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">orderBy</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">All</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">orderBy</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">FirstByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">FirstBy</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">orderBy</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>orderByDescending</code> parameter sorts the elements of a sequence in
descending order according to a key.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">ByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">orderByDescending</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">All</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">orderByDescending</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">FirstByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">FirstBy</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">orderByDescending</span><span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="firstby-and-singleby"><a aria-hidden="true" href="#firstby-and-singleby" tabindex="-1"><span class="icon icon-link"></span></a>FirstBy and SingleBy</h2>
<p><code>FirstBy</code> and <code>SingleBy</code> methods are like <code>By</code> methods but they return only one
record. <code>FirstBy</code> returns the first record matching the given conditions,
whereas <code>SingleBy</code> throws an exception when there are more than one records
matching the given conditions.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">SingleByEmail</span><span class="token punctuation">(</span><span class="token class-name">Email</span> email<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">SingleBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>Email <span class="token operator">==</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">FirstByRegistrationDate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> registrationDate<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">FirstBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>RegistrationDate <span class="token operator">==</span> registrationDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Single Parameter Convention applies to all query methods. That's why above
methods are named as <code>SingleByEmail</code> and <code>FirstByRegistrationDate</code> instead of
<code>SingleBy</code> and <code>FirstBy</code>. When you have more than one parameter you may
exclude parameter name from method name (e.g. <code>public User SingleBy(Email email, Password password)</code>).</p>
</div></div></div>
<p><code>SingleBy</code> method will return <code>null</code> when there are no matching records. LINQ
extension methods uses a different convention. <code>Single</code> methods expects to
return one record, if there are none or more than one they will throw an
exception. <code>SingleBy</code> methods acts like <code>SingleOrDefault</code> method.</p>
<h2 id="countby"><a aria-hidden="true" href="#countby" tabindex="-1"><span class="icon icon-link"></span></a>CountBy</h2>
<p>As the name implies, <code>CountBy</code> methods executes a <code>count</code> query and returns an
<code>int</code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CountByRegistrationDate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> registrationDate<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">CountBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>RegistrationDate <span class="token operator">==</span> registrationDate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CountBy</span><span class="token punctuation">(</span><span class="token class-name">Gender</span> gender<span class="token punctuation">,</span> <span class="token class-name">Date</span> birthDate<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">CountBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>Gender <span class="token operator">==</span> gender <span class="token operator">&&</span> u<span class="token punctuation">.</span>BirthDate <span class="token operator">==</span> birthDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="anyby"><a aria-hidden="true" href="#anyby" tabindex="-1"><span class="icon icon-link"></span></a>AnyBy</h2>
<p>As the name implies, <code>AnyBy</code> method determines whether all elements of a
sequence satisfy a condition and returns a <code>bool</code>.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">AnyByRegistrationDate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> registrationDate<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">AnyBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>RegistrationDate <span class="token operator">==</span> registrationDate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">AnyBy</span><span class="token punctuation">(</span><span class="token class-name">Gender</span> gender<span class="token punctuation">,</span> <span class="token class-name">Date</span> birthDate<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">AnyBy</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>Gender <span class="token operator">==</span> gender <span class="token operator">&&</span> u<span class="token punctuation">.</span>BirthDate <span class="token operator">==</span> birthDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="minby-and-maxby"><a aria-hidden="true" href="#minby-and-maxby" tabindex="-1"><span class="icon icon-link"></span></a>MinBy and MaxBy</h2>
<p>These aggregate functions take two expressions.</p>
<ol>
<li>An expression of the property on which aggregate function is applied</li>
<li>An expression for where clause</li>
</ol>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transactions</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Transaction<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Money</span> <span class="token function">MinAmountBy</span><span class="token punctuation">(</span><span class="token class-name">DateRange</span> transactionDateRange<span class="token punctuation">,</span> <span class="token class-name">CurrencyCode</span> currency<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">MinBy</span><span class="token punctuation">(</span>
            <span class="token comment">//Property expression</span>
            t <span class="token operator">=></span> t<span class="token punctuation">.</span>Amount<span class="token punctuation">.</span>Value<span class="token punctuation">,</span>

            <span class="token comment">//Where clause expression</span>
            t <span class="token operator">=></span> t<span class="token punctuation">.</span>TransactionDate <span class="token operator">>=</span> transactionDateRange<span class="token punctuation">.</span>Start <span class="token operator">&&</span>
                 t<span class="token punctuation">.</span>TransactionDate <span class="token operator">&lt;</span> transactionDateRange<span class="token punctuation">.</span>End <span class="token operator">&&</span>
                 t<span class="token punctuation">.</span>Amount<span class="token punctuation">.</span>Currency <span class="token operator">==</span> currency
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToMoney</span><span class="token punctuation">(</span>currency<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Money</span> <span class="token function">MaxAmountBy</span><span class="token punctuation">(</span><span class="token class-name">DateRange</span> transactionDateRange<span class="token punctuation">,</span> <span class="token class-name">CurrencyCode</span> currency<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">MaxBy</span><span class="token punctuation">(</span>
            <span class="token comment">//Property expression</span>
            t <span class="token operator">=></span> t<span class="token punctuation">.</span>Amount<span class="token punctuation">.</span>Value<span class="token punctuation">,</span>

            <span class="token comment">//Where clause expression</span>
            t <span class="token operator">=></span> t<span class="token punctuation">.</span>TransactionDate <span class="token operator">>=</span> transactionDateRange<span class="token punctuation">.</span>Start <span class="token operator">&&</span>
                 t<span class="token punctuation">.</span>TransactionDate <span class="token operator">&lt;</span> transactionDateRange<span class="token punctuation">.</span>End <span class="token operator">&&</span>
                 t<span class="token punctuation">.</span>Amount<span class="token punctuation">.</span>Currency <span class="token operator">==</span> currency
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToMoney</span><span class="token punctuation">(</span>currency<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="optional-where-clauses"><a aria-hidden="true" href="#optional-where-clauses" tabindex="-1"><span class="icon icon-link"></span></a>Optional Where Clauses</h2>
<p>In a query class, if a condition needs to be included in a query depending on
the state of a given parameter, an optional where clause can be created as
shown below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">,</span> <span class="token class-name">Vkn</span> taxNo <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span>
        <span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">When</span><span class="token punctuation">(</span>taxNo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>TaxNo <span class="token operator">==</span> taxNo<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This way you can create reusable query services/methods;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>companies<span class="token punctuation">.</span><span class="token function">By</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
companies<span class="token punctuation">.</span><span class="token function">By</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">taxNo</span><span class="token punctuation">:</span> taxNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
companies<span class="token punctuation">.</span><span class="token function">By</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span> <span class="token named-parameter punctuation">taxNo</span><span class="token punctuation">:</span> taxNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>You can use optional where clauses in <code>By</code>, <code>FirstBy</code>, <code>SingleBy</code>, <code>MinBy</code>,
<code>MaxBy</code>, <code>CountBy</code> methods.</p>
</div></div></div>
<p>An optional where clause is built in 3 steps:</p>
<ul>
<li><strong><code>When</code></strong>: In this step you specify the parameter on which you will check a
condition.</li>
<li><strong><code>Is/Not</code></strong>: <code>Is</code> method expects the given condition to be <code>true</code> while
<code>IsNot</code> method expects the given condition to be <code>false</code>.</li>
<li><strong><code>ThenAnd</code></strong>: This is the final step. In this step you provide the where
clause.</li>
</ul>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Together, in the above statement, you stated that there is an optional filter
which should be included when name is not <code>default</code>.</p>
<p>The alternative, you can also use as named optional parameters. They must be
the last ones in method arguments list.</p>
<p>There are available 2 different ways.</p>
<ul>
<li><strong><code>optional</code></strong>: In this way, you specify the single condition.</li>
<li><strong><code>optionals</code></strong>: In this way, you specify the multiple conditions.</li>
</ul>
<p>You can pass the parameter according to the name, as shown below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">optional</span><span class="token punctuation">:</span> <span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> <span class="token function">By</span><span class="token punctuation">(</span><span class="token class-name">City</span> city<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">,</span> <span class="token class-name">Vkn</span> taxNo <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">By</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>City <span class="token operator">==</span> city<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">optionals</span><span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">When</span><span class="token punctuation">(</span>taxNo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenAnd</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>TaxNo <span class="token operator">==</span> taxNo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div>
<h3 id="how-to-use-is"><a aria-hidden="true" href="#how-to-use-is" tabindex="-1"><span class="icon icon-link"></span></a>How to use <code>Is</code></h3>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token comment">//if given name parameter object is expectedName</span>
<span class="token comment">//then the condition will be included in the query.</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>n <span class="token operator">=></span> n <span class="token operator">==</span> expectedName<span class="token punctuation">)</span>

<span class="token comment">//you can pass an object instead of an expression</span>
<span class="token comment">//which will be equivalent to above code</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>expectedName<span class="token punctuation">)</span>

<span class="token comment">//There is a shortcut method that does the same job</span>
<span class="token comment">//that When(name).Is(null) and When(name).Is(default) does</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<h3 id="how-to-use-isnot"><a aria-hidden="true" href="#how-to-use-isnot" tabindex="-1"><span class="icon icon-link"></span></a>How to use <code>IsNot</code></h3>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token comment">//if given name parameter object is not excludedName</span>
<span class="token comment">//then the condition will be included in the query.</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">==</span> excludedName<span class="token punctuation">)</span>

<span class="token comment">//you can pass an object instead of an expression</span>
<span class="token comment">//which will be equivalent to above code</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNot</span><span class="token punctuation">(</span>excludedName<span class="token punctuation">)</span>

<span class="token comment">//There is a shortcut method that does the same job</span>
<span class="token comment">//that When(name).IsNot(null) and When(name).IsNot(default) does</span>
<span class="token function">When</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsNotDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<h2 id="query-base-class"><a aria-hidden="true" href="#query-base-class" tabindex="-1"><span class="icon icon-link"></span></a>Query Base Class</h2>
<p><code>Query&lt;T></code> is an abstract class with helper functionalities to make it simple
to create queries. All methods in this class are <code>protected</code>. If a method
declared in <code>Query&lt;T></code> class is to be exposed as a business service, you can
override its access modifiers with <code>public new</code> keyword.</p>
<h3 id="singlebyid-and-byids"><a aria-hidden="true" href="#singlebyid-and-byids" tabindex="-1"><span class="icon icon-link"></span></a>SingleById and ByIds</h3>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Query<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IQuery<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">T</span> <span class="token function">SingleById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token function">ByIds</span><span class="token punctuation">(</span><span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">></span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>These methods are protected helper methods and are used by Gazel to find a
record by an id or ids. If you want these methods to be available for internal
use, then you can simply do the following;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">internal</span> <span class="token keyword">new</span> <span class="token return-type class-name">Company</span> <span class="token function">SingleById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">SingleById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p><code>SingleById</code> caches the result in request scope, that is, when you make
subsequent calls to <code>SingleById</code>, only first call will hit database.</p>
</div></div></div>
<h3 id="queryall"><a aria-hidden="true" href="#queryall" tabindex="-1"><span class="icon icon-link"></span></a>Query.All</h3>
<p>This method lists all records in corresponding table. This method is
<code>protected</code> in <code>Query&lt;T></code> base class. If you want a persistent class to have an
<code>All</code> query as a business service do the following;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Companies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name">Company</span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><div><section id="transaction-management"><h1 class="article-title">Transaction Management</h1></section> <div class="nuxt-content"><p>Business services always runs in a transaction context. Its either main
transaction or manually created transactions. In this section you can learn how
we deal with database transactions.</p>
<h2 id="using-main-transaction"><a aria-hidden="true" href="#using-main-transaction" tabindex="-1"><span class="icon icon-link"></span></a>Using Main Transaction</h2>
<p>Before every service call, Gazel creates a database connection and begins a
transaction. If there occurs an exception the transaction is automatically
rolled back. If there are no exceptions than transaction is committed.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Above insert will be rolled back</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="creating-new-transactions"><a aria-hidden="true" href="#creating-new-transactions" tabindex="-1"><span class="icon icon-link"></span></a>Creating New Transactions</h2>
<p>Most of the time one transaction will be enough for business services. However
there are cases when you will need a record to be updated or inserted and
committed to database.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Above insert will not be rolled back</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>In above example <code>context.WithNewTransaction().Do(() => { ... })</code> creates a new
database connection and begins a transaction on this new connection to provide
you with a new transaction context.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>When an exception occurs in a transaction scope, Gazel catches the exception,
rollbacks the transcation, closes the connection and rethrows the exception.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Above insert will be rolled back</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div></div></div>
<h3 id="using-persistent-objects"><a aria-hidden="true" href="#using-persistent-objects" tabindex="-1"><span class="icon icon-link"></span></a>Using Persistent Objects</h3>
<p>In previous example we used a variable (<code>name</code>) from outer scope. This is not a
problem when variables are non-persistent objects such as <code>string</code>, <code>int</code>, a
manager object or any <code>class</code> or <code>struct</code> in your modules.</p>
<p>Consider you need to pass a persistent object to <code>AddEmployee</code> method.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Branch</span> employeeBranch<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">//employeeBranch object will cause trouble</span>
            context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> employeeBranch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>When you pass a persistent object directly to a new transaction context, this
means that a <code>Branch</code> instance from outer scope will be assigned to an
<code>Employee</code> instance from inner scope. This causes an unexpected state for
NHibernate. To assign a persistent object to another persistent object, they
need to be loaded from the same transaction scope and <code>ISession</code> instance. To
achieve this you need to pass <code>Branch</code> object with a different way.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Branch</span> employeeBranch<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span>employeeBranch<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>eb <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">//correct way to pass a persistent object to new transaction</span>
            context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> eb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><code>employeeBranch</code> is passed to new transaction scope using
<code>context.WithNewTransaction(employeeBranch).Do(eb => { ... })</code>. When you do
this, Gazel gets the id of given <code>employeeBranch</code>, loads it in new transaction
scope and passes it as a parameter (<code>eb</code>).</p>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You can pass up to <strong>15</strong> parameters to <code>WithNewTransaction</code> method.</p>
</div></div></div>
<h2 id="nested-transactions"><a aria-hidden="true" href="#nested-transactions" tabindex="-1"><span class="icon icon-link"></span></a>Nested Transactions</h2>
<p>You can create as many nested transactions as you want like below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token comment">//this level uses main transaction</span>

context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//this level uses first transaction</span>

    context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">//this level uses second transaction</span>

        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">//this level uses third transaction</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>When you create nested transactions, beware that you are using more than one
database connections at a time.</p>
</div></div></div>
<h2 id="example-update-balance-of-an-account"><a aria-hidden="true" href="#example-update-balance-of-an-account" tabindex="-1"><span class="icon icon-link"></span></a>Example: Update Balance of an Account</h2>
<p>Below is an example to demonstrate an update to a balance in an account.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Withdraw</span><span class="token punctuation">(</span><span class="token class-name">Money</span> amount<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>@<span class="token keyword">this</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            @<span class="token keyword">this</span><span class="token punctuation">.</span>Balance <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If you want to lock a record, you can make use of <code>IRepository&lt;T>.Lock</code> method.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Withdraw</span><span class="token punctuation">(</span><span class="token class-name">Money</span> amount<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>@<span class="token keyword">this</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">//use repository of @this object.</span>
            <span class="token comment">//"this.repository" uses outer scope whereas "@this.repository" uses inner scope.</span>
            @<span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span>@<span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            @<span class="token keyword">this</span><span class="token punctuation">.</span>Balance <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>To make it more readable, lets extract balance operation to another method.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Withdraw</span><span class="token punctuation">(</span><span class="token class-name">Money</span> amount<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">WithNewTransaction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>@<span class="token keyword">this</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            @<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LockAndChangeBalance</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LockAndChangeBalance</span><span class="token punctuation">(</span><span class="token class-name">Money</span> amount<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        repository<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Balance <span class="token operator">-=</span> amount
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div></div></div></div></div></div></div></div><script defer src="/gazel.io/_nuxt/static/1655290242/conventions/state.js"></script><script src="/gazel.io/_nuxt/12413c2.js" defer></script><script src="/gazel.io/_nuxt/7b10f97.js" defer></script><script src="/gazel.io/_nuxt/713adc0.js" defer></script><script src="/gazel.io/_nuxt/1464aa5.js" defer></script><script src="/gazel.io/_nuxt/da26cd5.js" defer></script><script src="/gazel.io/_nuxt/8dd2546.js" defer></script>
  </body>
</html>

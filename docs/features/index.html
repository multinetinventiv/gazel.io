<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>gazel - documentation</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.png"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"><link data-n-head="ssr" rel="stylesheet" type="text/css" href="/assets/css/stylesheet.css"><script data-n-head="ssr" src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script><script data-n-head="ssr" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script><script data-n-head="ssr" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script><link rel="preload" href="/_nuxt/1971f5d.js" as="script"><link rel="preload" href="/_nuxt/f12e08d.js" as="script"><link rel="preload" href="/_nuxt/ef83327.js" as="script"><link rel="preload" href="/_nuxt/ccecb32.js" as="script"><link rel="preload" href="/_nuxt/e82329e.js" as="script"><link rel="preload" href="/_nuxt/de6aec2.js" as="script"><link rel="preload" href="/_nuxt/c309ceb.js" as="script"><style data-vue-ssr-id="5764bbd8:0 62108049:0 1a73ea6b:0 4735450f:0 1bf3c55b:0 45299806:0 3d57fece:0">.svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;transform:translate(-50%,-50%);transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;transform:scale(.25);transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;transform:scale(.25);transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;transform:scale(.25);transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;transform:scale(.25);transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;transform:scale(.25);transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:.08em solid #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{animation:fa-spin 2s linear infinite}.fa-pulse{animation:fa-spin 1s steps(8) infinite}@keyframes fa-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.fa-rotate-90{transform:rotate(90deg)}.fa-rotate-180{transform:rotate(180deg)}.fa-rotate-270{transform:rotate(270deg)}.fa-flip-horizontal{transform:scaleX(-1)}.fa-flip-vertical{transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{transform:scale(-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}.svg-inline--fa .fa-primary{fill:currentColor;fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:currentColor;fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fad.fa-inverse{color:#fff}code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#264f78}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#264f78}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;color:#db4c69;background:#1e1e1e}.namespace{opacity:.7}.token.doctype .token.doctype-tag{color:#569cd6}.token.doctype .token.name{color:#9cdcfe}.token.comment,.token.prolog{color:#6a9955}.language-html .language-css .token.punctuation,.language-html .language-javascript .token.punctuation,.token.punctuation{color:#d4d4d4}.token.boolean,.token.constant,.token.inserted,.token.number,.token.property,.token.symbol,.token.tag,.token.unit{color:#b5cea8}.token.attr-name,.token.builtin,.token.char,.token.deleted,.token.selector,.token.string{color:#ce9178}.language-css .token.string.url{text-decoration:underline}.token.entity,.token.operator{color:#d4d4d4}.token.operator.arrow{color:#569cd6}.token.atrule{color:#ce9178}.token.atrule .token.rule{color:#c586c0}.token.atrule .token.url{color:#9cdcfe}.token.atrule .token.url .token.function{color:#dcdcaa}.token.atrule .token.url .token.punctuation{color:#d4d4d4}.token.keyword{color:#569cd6}.token.keyword.control-flow,.token.keyword.module{color:#c586c0}.token.function,.token.function .token.maybe-class-name{color:#dcdcaa}.token.regex{color:#d16969}.token.important{color:#569cd6}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name,.token.maybe-class-name{color:#4ec9b0}.token.console,.token.interpolation,.token.parameter{color:#9cdcfe}.token.boolean,.token.punctuation.interpolation-punctuation{color:#569cd6}.token.exports .token.maybe-class-name,.token.imports .token.maybe-class-name,.token.property,.token.variable{color:#9cdcfe}.token.escape,.token.selector{color:#d7ba7d}.token.tag{color:#569cd6}.token.cdata,.token.tag .token.punctuation{color:grey}.token.attr-name{color:#9cdcfe}.token.attr-value,.token.attr-value .token.punctuation{color:#ce9178}.token.attr-value .token.punctuation.attr-equals{color:#d4d4d4}.token.entity{color:#569cd6}.token.namespace{color:#4ec9b0}code[class*=language-javascript],code[class*=language-jsx],code[class*=language-tsx],code[class*=language-typescript],pre[class*=language-javascript],pre[class*=language-jsx],pre[class*=language-tsx],pre[class*=language-typescript]{color:#9cdcfe}code[class*=language-css],pre[class*=language-css]{color:#ce9178}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-regex .token.anchor{color:#dcdcaa}.language-html .token.punctuation{color:grey}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight.line-highlight{background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.bg-light{background-color:#fff!important}code[class*=language-],pre[class*=language-]{background-color:#1a1b26;text-shadow:none;font-size:.9em;margin-bottom:1rem;border-radius:5px}#header-logo{max-width:150px}.topmenu-options{font-weight:700}.alert-message{max-width:20px;display:contents}.alert{border-bottom-width:7px;margin:1px 1px 1rem;border-radius:5px;padding:.9rem}.alert p{margin-bottom:0}.alert .col{padding-left:.9rem;padding-right:.9rem}.fa-solid{position:relative;top:5px}</style><link rel="preload" href="/_nuxt/static/1668606782/features/state.js" as="script"><link rel="preload" href="/_nuxt/static/1668606782/features/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1668606782/manifest.js" as="script">
  </head>
  <body data-spy="scroll" data-target=".idocs-navigation" data-offset="125" data-n-head="%7B%22data-spy%22:%7B%22ssr%22:%22scroll%22%7D,%22data-target%22:%7B%22ssr%22:%22.idocs-navigation%22%7D,%22data-offset%22:%7B%22ssr%22:%22125%22%7D%7D">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="main-wrapper"><div><header id="header" class="sticky-top"><nav class="primary-menu navbar navbar-expand-lg bg-light navbar-text-dark navbar-dropdown-light border-0"><div class="container-fluid"><button id="sidebarCollapse" type="button" class="navbar-toggler d-block d-md-none show"><span></span> <span class="w-75"></span> <span></span></button> <a href="/" title="Gazel documentation" class="logo ml-md-2"><img id="header-logo" src="/main_logo_1x.png" alt="Gazel documentation"></a> <button type="button" data-toggle="collapse" data-target="#header-nav" class="navbar-toggler ml-auto"><span></span><span></span><span></span></button> <div id="header-nav" class="collapse navbar-collapse justify-content-end"><ul class="navbar-nav"><li><a href="/tutorial" class="topmenu-options">
              Tutorial
            </a></li><li><a href="/conventions" class="topmenu-options">
              Conventions
            </a></li><li><a href="/setup" class="topmenu-options">
              Setup
            </a></li><li><a href="/architecture" class="topmenu-options">
              Architecture
            </a></li><li><a href="/features" aria-current="page" class="topmenu-options nuxt-link-exact-active nuxt-link-active">
              Features
            </a></li><li><a href="/release-notes" class="topmenu-options">
              Release Notes
            </a></li></ul></div> <ul class="social-icons social-icons-sm ml-lg-2 mr-2"><li class="social-icons-github"><a data-toggle="tooltip" href="https://github.com/multinetinventiv/gazel" target="_blank" data-original-title="Github"><i class="fab fa-github"></i></a></li></ul></div></nav></header> <div id="content" role="main"><div class="idocs-navigation bg-light active"><ul class="nav flex-column"><li class="nav-item"><a href="#index" class="nav-link">Features</a> <ul class="nav flex-column"></ul></li><li class="nav-item"><a href="#authentication" class="nav-link">Authentication</a> <ul class="nav flex-column"><li class="nav-item"><a href="#isessionmanager-interface" class="nav-link">ISessionManager interface</a></li><li class="nav-item"><a href="#isession-interface" class="nav-link">ISession interface</a></li><li class="nav-item"><a href="#iaccount-interface" class="nav-link">IAccount interface</a></li><li class="nav-item"><a href="#accessing-user-session" class="nav-link">Accessing User Session</a></li><li class="nav-item"><a href="#overriding-current-session" class="nav-link">Overriding Current Session</a></li></ul></li><li class="nav-item"><a href="#crypto" class="nav-link">Crypto</a> <ul class="nav flex-column"><li class="nav-item"><a href="#crypto-api" class="nav-link">Crypto API</a></li><!----><!----><li class="nav-item"><a href="#crypto-configuration" class="nav-link">Configuration </a></li><!----><!----><!----><!----></ul></li><li class="nav-item"><a href="#exception-handling" class="nav-link">Exception Handling</a> <ul class="nav flex-column"><li class="nav-item"><a href="#result-codes" class="nav-link">Result Codes</a></li><!----><li class="nav-item"><a href="#response-status" class="nav-link">Response Status</a></li><!----><!----><!----><!----><!----><!----><li class="nav-item"><a href="#built-in-errors" class="nav-link">Built-in Errors</a></li><!----><li class="nav-item"><a href="#exception-handling-customization" class="nav-link">Customization </a></li><!----></ul></li><li class="nav-item"><a href="#file-system" class="nav-link">File System</a> <ul class="nav flex-column"><li class="nav-item"><a href="#ifilesystem-interface" class="nav-link">IFileSystem interface</a></li><li class="nav-item"><a href="#file-system-configuration" class="nav-link">Configuration </a></li><li class="nav-item"><a href="#file-system-customization" class="nav-link">Customization </a></li></ul></li><li class="nav-item"><a href="#configurations" class="nav-link">Configurations</a> <ul class="nav flex-column"><li class="nav-item"><a href="#application-assemblies" class="nav-link">Application Assemblies</a></li><!----><!----><!----><!----><li class="nav-item"><a href="#application-session" class="nav-link">Application Session</a></li><li class="nav-item"><a href="#business-logic" class="nav-link">Business Logic</a></li><li class="nav-item"><a href="#command-line" class="nav-link">Command Line</a></li><li class="nav-item"><a href="#database" class="nav-link">Database</a></li><li class="nav-item"><a href="#gateway" class="nav-link">Gateway</a></li><li class="nav-item"><a href="#http-header" class="nav-link">Http Header</a></li><li class="nav-item"><a href="#middleware" class="nav-link">Middleware</a></li><li class="nav-item"><a href="#rest-api" class="nav-link">Rest Api</a></li><li class="nav-item"><a href="#service-client" class="nav-link">Service Client</a></li><li class="nav-item"><a href="#service" class="nav-link">Service</a></li></ul></li><li class="nav-item"><a href="#options" class="nav-link">Options</a> <ul class="nav flex-column"><li class="nav-item"><a href="#audit" class="nav-link">Audit</a></li><li class="nav-item"><a href="#decimal-point" class="nav-link">Decimal Point</a></li><li class="nav-item"><a href="#utc" class="nav-link">UTC</a></li></ul></li></ul></div> <div class="idocs-content"><div class="container"><div><div><section id="index"><h1 class="article-title">Features</h1></section> <div class="nuxt-content"><p>Features are built-in behaviours that can be customized through their
configurers. Small features can be named as <em>Configuration</em> or <em>Option</em>. When
they only configure an existing behaviour, such as <code>DatabaseConfiguration</code>, it
is a <em>Configuration</em>. When they provide nothing to configure other than
enable/disable, such as <code>UtcOption</code>, it is an <em>Option</em>.</p>
<ul>
<li><a href="/features#authentication"><strong>Authentication</strong></a>: Learn what alternatives you
have in Gazel to provide authentication in your projects</li>
<li><a href="#"><strong>Authorization</strong></a>: TBD</li>
<li><a href="#"><strong>Cache</strong></a>: TBD</li>
<li><a href="/features#crypto"><strong>Crypto</strong></a>: Crypto provides a built-in way to encrypt &
decrypt sensitive data</li>
<li><a href="/features#exception-handling"><strong>Exception Handling</strong></a>: Gazel has a prebuilt
code & message system that converts exceptions into data</li>
<li><a href="/features#file-system"><strong>File System</strong></a>: File system gives a nice
abstraction for your application to read & write file</li>
<li><a href="#"><strong>Hashing</strong></a>: TBD</li>
<li><a href="#"><strong>Localization</strong></a>: TBD</li>
<li><a href="#"><strong>Logging</strong></a>: TBD</li>
<li><a href="#"><strong>Message Queue</strong></a>: TBD</li>
<li><a href="#"><strong>Remote Call</strong></a>: TBD</li>
<li><a href="#"><strong>Secure Call</strong></a>: TBD</li>
<li><a href="#"><strong>Transaction</strong></a>: TBD</li>
<li><a href="/features#configurations"><strong>Configurations</strong></a>: List of all <em>configuration</em>
type features</li>
<li><a href="/features#options"><strong>Options</strong></a>: List of all <em>option</em> type features</li>
<li><a href="#"><strong>Implement a new feature</strong></a>: TBD</li>
</ul></div></div><div><section id="authentication"><h1 class="article-title">Authentication</h1></section> <div class="nuxt-content"><p>In this section, you will learn about how authentication is implemented in
Gazel.</p>
<p>Authentication is enabled by default in <em>Service Application</em>. All requests
from outside of your host project require an token. When you run your
<code>App.Service</code> project, you will see an <code>Authorization</code> text box in request
headers section which configures an HTTP authorization header for every
request.</p>
<p><img alt=" " src="/assets/images/content/-images/features/authentication-service-test-ui.png"></p>
<p><img alt=" " src="/assets/images/content/-images/features/authentication-authorization-header.png"></p>
<p>Below you can see a sequence diagram explaining how gazel interacts with
your code through interfaces;</p>
<pre class="mermaid">sequenceDiagram
autonumber
    actor User
    participant A as Service Client
    participant B as Service Application
    participant C as Session Interceptor
    participant C1 as ISessionManager
    participant C2 as ISession
    participant D as Business Service
    User->>+A: Take action that requires Authorization
    A->>+B: Sends Request
    B->>+C: Validate Token
    C->>+C1 : Call GetSession()
    C1-->>-C : Returns ISession
    C->>+C2 : Call Validate()
    C2-->>-C : Validates Session
    C->>C : Sets ISession to Context.Session
    C-->>-B: Returns OK
    B->>+D: Forwards Request
    D-->>-B: Returns Response
    B-->>-A: Returns Response
    A-->>-User: Sees result
</pre>
<p>Here you can see that for every request;</p>
<ul>
<li>It first calls <code>GetSession()</code> to retrieve session object</li>
<li>Then it invokes <code>Validate()</code> to enable validation logic</li>
<li>If everything is ok, it sets your session object to request scope.</li>
</ul>
<h2 id="isessionmanager-interface"><a aria-hidden="true" href="#isessionmanager-interface" tabindex="-1"><span class="icon icon-link"></span></a><code>ISessionManager</code> interface</h2>
<p>When authentication is enabled, Gazel requires an implementation of
<code>ISessionManager</code> interface. Once you implement it in any module, it will be
registered automatically.</p>
<p><code>ISessionManager</code> is basically responsible for finding an <code>ISession</code> instance
from a given <code>AppToken</code>. An example implementation is as follows;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ISessionManager</span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ISession</span> <span class="token function">GetSession</span><span class="token punctuation">(</span><span class="token class-name">AppToken</span> appToken<span class="token punctuation">)</span> <span class="token operator">=></span>
        context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Sessions<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SingleByAppToken</span><span class="token punctuation">(</span>appToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>If you don't want <code>GetSession</code> method to be public, you can implement
<code>ISessionManager</code> explicitly.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ISessionManager</span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">ISession</span> <span class="token function">GetSession</span><span class="token punctuation">(</span><span class="token class-name">AppToken</span> appToken<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token range operator">..</span><span class="token punctuation">.</span>

    <span class="token return-type class-name">ISession</span> ISessionManager<span class="token punctuation">.</span><span class="token function">GetSession</span><span class="token punctuation">(</span><span class="token class-name">AppToken</span> appToken<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">GetSession</span><span class="token punctuation">(</span>appToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div></div></div>
<h2 id="isession-interface"><a aria-hidden="true" href="#isession-interface" tabindex="-1"><span class="icon icon-link"></span></a><code>ISession</code> interface</h2>
<p>Just like a web session, <code>ISession</code> represents a session of a user. Unlike a
web session it is not stored in cookies nor in a file. <code>ISessionManager</code>
creates it before every request and puts it in the request scope. After every
request, session instances are destroyed along with its request.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISession</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">AppToken</span> Token <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// The unique identifier of the session</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> Host <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// A text to represent client's host if needed</span>
    <span class="token return-type class-name">IAccount</span> Account <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// The account that this session is attached to</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The method that is invoked before every request</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Here is an example implementation of <code>ISession</code> interface;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Session</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ISession</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Session<span class="token punctuation">></span></span> repository<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token function">Session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Session</span><span class="token punctuation">(</span><span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Session<span class="token punctuation">></span></span> repository<span class="token punctuation">,</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">AppToken</span> Token <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Account</span> Account <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Host <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">DateTime</span> ExpireTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Session</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Account <span class="token operator">=</span> account<span class="token punctuation">;</span>

        Token <span class="token operator">=</span> context<span class="token punctuation">.</span>System<span class="token punctuation">.</span><span class="token function">NewAppToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Host <span class="token operator">=</span> context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Host<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ExpireTime <span class="token operator">=</span> context<span class="token punctuation">.</span>System<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMinutes</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ExpireTime <span class="token operator">&lt;</span> context<span class="token punctuation">.</span>System<span class="token punctuation">.</span>Now<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthenticationRequiredException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//implemented explicitly to return IAccount</span>
    <span class="token return-type class-name">IAccount</span> ISession<span class="token punctuation">.</span>Account <span class="token operator">=></span> Account<span class="token punctuation">;</span>

    <span class="token comment">//implemented explicitly to make Validate protected</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> ISession<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sessions</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Session<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">Sessions</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">internal</span> <span class="token return-type class-name">Session</span> <span class="token function">SingleByAppToken</span><span class="token punctuation">(</span><span class="token class-name">AppToken</span> appToken<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">SingleBy</span><span class="token punctuation">(</span>s <span class="token operator">=></span> s<span class="token punctuation">.</span>AppToken <span class="token operator">==</span> appToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="iaccount-interface"><a aria-hidden="true" href="#iaccount-interface" tabindex="-1"><span class="icon icon-link"></span></a><code>IAccount</code> interface</h2>
<p><code>IAccount</code> represents an account in your application.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAccount</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// Id of the account</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> DisplayName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// A text to represent the account</span>

    <span class="token comment">// The method that is invoked before every request if authorization is enabled</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">HasAccess</span><span class="token punctuation">(</span><span class="token class-name">IResource</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Here is an example implementation of <code>IAccount</code> interface;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAccount</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Account<span class="token punctuation">></span></span> repository<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token function">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Account</span><span class="token punctuation">(</span><span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Account<span class="token punctuation">></span></span> repository<span class="token punctuation">,</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FullName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Account</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fullName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        FullName <span class="token operator">=</span> fullName<span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//implemented explicitly to map DisplayName on FullName</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> IAccount<span class="token punctuation">.</span>DisplayName <span class="token operator">=></span> FullName<span class="token punctuation">;</span>

    <span class="token comment">//give access to everything for this sample</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> IAccount<span class="token punctuation">.</span><span class="token function">HasAccess</span><span class="token punctuation">(</span><span class="token class-name">IResource</span> resource<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Accounts</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Query<span class="token punctuation">&lt;</span>Account<span class="token punctuation">></span></span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div>
<h2 id="accessing-user-session"><a aria-hidden="true" href="#accessing-user-session" tabindex="-1"><span class="icon icon-link"></span></a>Accessing User Session</h2>
<p>When you finish setting up your authentication mechanism, you can access user
session using <code>IModuleContext.Session</code> property.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompanyManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CompanyManager</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Company</span> <span class="token function">CreateCompany</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>
           <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
           <span class="token named-parameter punctuation">createdBy</span><span class="token punctuation">:</span> context<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>Account<span class="token punctuation">.</span>DisplayName
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="overriding-current-session"><a aria-hidden="true" href="#overriding-current-session" tabindex="-1"><span class="icon icon-link"></span></a>Overriding Current Session</h2>
<p>You may need to override the session in some specific cases. You can use
<code>IModuleContext.OverrideSession</code> method as shown below.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> repository<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token function">Company</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Company</span><span class="token punctuation">(</span><span class="token class-name">IRepository<span class="token punctuation">&lt;</span>Company<span class="token punctuation">></span></span> repository<span class="token punctuation">,</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Company</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//this level uses current session</span>

        <span class="token comment">//assume we need an admin session here</span>
        <span class="token class-name"><span class="token keyword">var</span></span> adminSession <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">New</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Session<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithAdminRights</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">OverrideSession</span><span class="token punctuation">(</span>adminSession<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            <span class="token comment">//here context.Session returns adminSession</span>

            <span class="token comment">//do some admin stuff</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//back to current session</span>

        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Address <span class="token operator">=</span> address<span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p><code>OverrideSession</code> can be used nested. After each <code>OverrideSession</code> block
ends, previous session becomes accessible.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Company</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//this level uses current session</span>
    context<span class="token punctuation">.</span><span class="token function">OverrideSession</span><span class="token punctuation">(</span>innerSession<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//this level uses inner session</span>
        context<span class="token punctuation">.</span><span class="token function">OverrideSession</span><span class="token punctuation">(</span>nestedSession<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            <span class="token comment">//this level uses nested session</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//this level uses current session</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div>
</div></div></div></div></div><div><section id="crypto"><h1 class="article-title">Crypto</h1></section> <div class="nuxt-content"><p>Crypto feature provides a basic encryption/decryption capability to store
sensitive data in configuration file or database. It also provides an API to be
used in accepting an input in a more secure way. Let's dive in to see how you
can use this feature to make your back-end functionality more secure.</p>
<h2 id="crypto-api"><a href="#crypto-api" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Crypto API</h2>
<p>This API consists of two main types <code>ICryptographer</code> and <code>EncryptedString</code>
providing ways to encrypt/decrypt data and represent encrypted data,
respectively.</p>
<h3 id="icryptographer-interface"><a href="#icryptographer-interface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>ICryptographer</code> interface</h3>
<p>This interface is a gateway facade to an underlying security mechanism provided
by .NET. Behind the scenes, this interface uses a <code>X.509</code> certificate with a an
<em>public / private key pair</em> (for more information see <a href="https://en.wikipedia.org/wiki/X.509" rel="nofollow noopener noreferrer" target="_blank">X.509</a> and <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="nofollow noopener noreferrer" target="_blank">RSA</a>).
This way you can make use of asymmetric encryption where needed. There are two
types of usage; <em>Encrypt / Decrypt</em> and <em>Sign / Verify</em>.</p>
<h4 id="encrypt--decrypt"><a href="#encrypt--decrypt" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>Encrypt</code> & <code>Decrypt</code></h4>
<p>First and most basic type of usage is to encrypt data using the public key, and
decrypt it using the private key. For example, you can use this to encrypt
sensitive data to save it in somewhere unsafe so that you can retrieve and
decrypt it later.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CryptoManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICryptographer</span> crypto<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">FileManager</span><span class="token punctuation">(</span><span class="token class-name">ICryptographer</span> crypto<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>crypto <span class="token operator">=</span> crypto<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Binary</span> <span class="token function">GetSensitiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> <span class="token string">"something to hide"</span><span class="token punctuation">.</span><span class="token function">ToUtf8Binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">Encrypt</span><span class="token punctuation">(</span>sensitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckSensitiveData</span><span class="token punctuation">(</span><span class="token class-name">Binary</span> binary<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">Decrypt</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUtf8String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> sensitive <span class="token operator">==</span> <span class="token string">"something to hide"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You may share your public key with the outside world so that anyone with this
key can encrypt and send a sensitive information which can only be decrypted
by your back-end system.</p>
</div></div></div>
<p><code>ICryptographer</code> also has helper methods to make string conversions easier.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetSensitiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// returns base64 representation of encrypted binary</span>
    <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">Encrypt</span><span class="token punctuation">(</span><span class="token string">"something to hide"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckSensitiveData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> encryptedSensitive<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">DecryptUnsecure</span><span class="token punctuation">(</span>encryptedSensitive<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"something to hide"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div>
<p>Above code uses <code>DecryptUnsecure</code> method, which returns a regular string
object. There is also a <code>Decrypt</code> method which returns a <code>SecureString</code>.
<a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.securestring" rel="nofollow noopener noreferrer" target="_blank">SecureString</a> is a class that encrypts given string with a symmetric key and
stores in memory so that a it is safely kept in memory.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckSensitiveData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> encryptedSensitive<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">Decrypt</span><span class="token punctuation">(</span>encryptedSensitive<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> sensitive<span class="token punctuation">.</span><span class="token function">Decrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"something to hide"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div>
<p>Notice that data is decrypted twice; first time it is done by using your X.509
certificate, second time it is done on <code>SecureString</code> object by using a
symmetric key that .NET generates.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>This code is for demonstration purposes only. In a real life case you might
keep your sensitive data in a <code>SecureString</code> object, and pass it to a method
as a parameter or store in a property. This way it will be less likely to be
exposed. Decrypt a <code>SecureString</code> right before you use it in your code.</p>
</div></div></div>
<h4 id="sign--verify"><a href="#sign--verify" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>Sign</code> & <code>Verify</code></h4>
<p><em>Sign & verify</em> is like the opposite usage of <em>encrypt & decrypt</em>. Decryption
can only happen on the side that has the private key, which is back-end side in
this case. So encryption is made with a public key, decryption is made with the
corresponding private key.</p>
<p>On the contrary, here, signing is done using a private key, and verifying is
done using its corresponding public key. So in this usage it's not about hiding
information from outside, rather it's about signing data to make it possible
for retrievers to verify that data is signed by, thus coming from, the trusted
source.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetSignedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> <span class="token string">"something to be signed"</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> hasher <span class="token operator">=</span> HashAlgorithm<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"SHA256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hasher<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>sensitive<span class="token punctuation">.</span><span class="token function">ToUtf8Binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Signing is done using the private key</span>
    <span class="token class-name"><span class="token keyword">var</span></span> signature <span class="token operator">=</span> testing<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>hasher<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> <span class="token string">"SHA256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> sensitive<span class="token punctuation">,</span> signature <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Verify</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> signedData<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> signedData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> signature <span class="token operator">=</span> signedData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> hasher <span class="token operator">=</span> HashAlgorithm<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"SHA256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hasher<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>sensitive<span class="token punctuation">.</span><span class="token function">ToUtf8Binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Verification is done with the public key</span>
    <span class="token keyword">return</span> testing<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>hasher<span class="token punctuation">.</span>Hash<span class="token punctuation">,</span> <span class="token string">"SHA256"</span><span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Sign and verify is used in <a href="/features#secure-call">Secure Call</a> feature,
where response values are used to compute a hash to be signed so that client
can verify and trust response.</p>
</div></div></div>
<h3 id="encryptedstring-struct"><a href="#encryptedstring-struct" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>EncryptedString</code> struct</h3>
<p>This struct acts like a wrapper type for <code>SecureString</code> class from .NET, (see
<a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.securestring" rel="nofollow noopener noreferrer" target="_blank">SecureString</a>). It conforms to the <em>parseable value type</em> convention just
like rest of the value types from <em>Gazel.Primitives</em> package. There are three ways to
create an <code>EncryptedString</code> instance.</p>
<ol>
<li><code>Parse</code> method, when you have a plain string object;
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> encrypted <span class="token operator">=</span> EncryptedString<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">"something sensitive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
</li>
<li><code>FromEncrypted</code> method, when you have an encrypted value;
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> encrypted <span class="token operator">=</span> EncryptedString<span class="token punctuation">.</span><span class="token function">FromEncrypted</span><span class="token punctuation">(</span>encryptedBinary<span class="token punctuation">,</span> b <span class="token operator">=></span> crypto<span class="token punctuation">.</span><span class="token function">DecryptUnsecure</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
Second parameter is <code>decryptDelegate</code> in case <code>EncryptedString.Decrypt</code> or
<code>Encrypted.ToString()</code> method are called on this instance. Without a decrypt
delegate it would not be able to decrpyt its value.</li>
<li>Use a <code>SecureString</code> instance. You can cast it to an <code>EncryptedString</code>;
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> encrypted <span class="token operator">=</span> <span class="token punctuation">(</span>EncryptedString<span class="token punctuation">)</span>secureString<span class="token punctuation">;</span>
</code></pre></div>
or use constructor;
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> encrypted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EncryptedString</span><span class="token punctuation">(</span>secureString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
</li>
</ol>
<p>This struct either stores given encrypted binary value, or a secure string
instance so that sensitive information is securly kept in memory. You may read
<em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.securestring#HowSecure" rel="nofollow noopener noreferrer" target="_blank">How secure is SecureString</a></em> section from .NET documentation to learn more.</p>
<h4 id="mapping-to-a-table-column"><a href="#mapping-to-a-table-column" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Mapping to a Table Column</h4>
<p>You can map <code>EncryptedString</code> just like any other value type.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Secret</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">EncryptedString</span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If you intend to use an encrypted string property, <strong>please read</strong> below
information carefully;</p>
<ul>
<li>Only encrypted binary value is stored in database so that nobody can see the
value without a proper certificate. So it is <strong>highly recommended</strong> for you
to use a <strong>different</strong> certificate for each environment (<em>Development</em>,
<em>Production</em> etc.), and <strong>never</strong> expose private key of your <em>Production</em>
certificate to the people that have access to your production database.</li>
<li>Value is not decrypted until you explicitly call <code>Decrypt</code> or <code>ToString</code>.
This is because decryption is costly and retrieving a list of persistent
objects should not decrypt automatically. <code>DataAccessLayer</code> uses
<code>FromEncrypted</code> method to create <code>EncryptedString</code> instances when data is
retrieved from database.</li>
<li>Since <code>EncryptedString</code> is expected to store sensitive data, it will never
appear in a response directly. So you don't need to make it <code>protected internal</code> or <code>[Internal]</code>.</li>
</ul>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Notice how Gazel does <strong>not</strong> decrypt an EncryptedString in any case. So if
your business logic somehow requires an encrypted string to be decrypted,
remember that you will need to either call <code>ToString()</code> or <code>Decrypt()</code> at
some point.</p>
</div></div></div>
<p>Below is an example of how you can generate and store a sensitive information;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Secret</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token return-type class-name">SecretToken</span> <span class="token function">With</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Value <span class="token operator">=</span> EncryptedString<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">system<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        repository<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="as-a-service-parameter"><a href="#as-a-service-parameter" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>As a Service Parameter</h4>
<p>You may use <code>EncryptedString</code> as a service parameter just like any other value
type. Below you can see a simple example;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Secret</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateValue</span><span class="token punctuation">(</span><span class="token class-name">EncryptedString</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>Beware that this does <strong>not</strong> encrypt the sensitive data when transferring
from client to your back-end. You can already achieve this through an HTTPS
connection. <code>EncryptedString</code> only helps you to secure this data using a
symmetric encryption when stored in memory and an asymmetric encryption when
stored in database.</p>
</div></div></div>
<p>Although <code>EncryptedString</code> is accepted as a service parameter, a method that
returns <code>EncryptedString</code> cannot be registered as a business service (a.k.a.
operation), and cannot be called from outside. And also, a property with its
type as <code>EncryptedString</code> cannot be registered in service layer as a business
data as well.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>When a service one of the parameters of a service is <code>EncryptedString</code>, that
service is marked as sensitive and does <strong>not</strong> log its parameter and
response data.</p>
</div></div></div>
<h4 id="reading-from-settings"><a href="#reading-from-settings" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Reading from Settings</h4>
<p>This feature allows you to read an encrypted string from settings using
<code>GetEncryptedString</code> method of <code>ICryptographer</code> interface. Let's revisit the
previous example from <a href="features#icryptographer-interface">ICryptographer
Interface</a> section.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">Binary</span> <span class="token function">GetSensitiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> <span class="token string">"something to hide"</span><span class="token punctuation">.</span><span class="token function">ToUtf8Binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">Encrypt</span><span class="token punctuation">(</span>sensitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Here you can see that sensitive information is exposed as a constant string,
which makes this sensitive information available to anyone who has access to
this code. To prevent this we can read it from settings.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">Binary</span> <span class="token function">GetSensitiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sensitive <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">GetEncryptedString</span><span class="token punctuation">(</span><span class="token string">"Sensitive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> sensitive<span class="token punctuation">.</span>EncryptedValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Encrypt a sensitive data using your certificate and put its encrypted value to
configuration file in base64 format. This way only someone with private key
will be able to know actual value of sensitive data.</p>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>This method first looks for a value with given key. If value does not exist,
it will look for its decrypted version under <code>"Sensitive.Decrypted"</code> key, so
below file also works;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"Sensitive"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"Decrypted"</span><span class="token operator">:</span> <span class="token string">"something to hide"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This can be handy in development environemnt, when sensitive data is
sensitive only in production and you have some other not sensitive value in
development.</p>
</div></div></div>
<h2 id="crypto-configuration"><a href="#configuration-crypto-configuration" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuration </h2>
<p>There are three ways to load a certificate, <code>X509Store</code>,
<code>X509CertificateFromP12File</code> and <code>X509CertificateFromPem</code>. There is also a
fourth, and the default, <code>AutoResolve</code> option which uses configuration file to
decide which one to use.</p>
<h3 id="x509store"><a href="#x509store" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>X509Store</code></h3>
<p>This option uses certificate store of operating system to load a certificate.
If you use this option you will have to install your certificate to every OS
that will run your back-end system.</p>
<div><div class="alert alert-danger row"><div class="alert-message col"><i class="fa-solid fa-circle-xmark"></i></div> <div class="col">

<p>Currently this option is <strong>only</strong> supported in <strong>Windows</strong> operating systems.</p>
</div></div></div>
<p>You can choose this option as follows;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509Store</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p><code>X509Store</code> requires <code>storeName</code> and <code>storeLocation</code> information to know in
which store to look for a certificate. It also requires an extra search
parameter to locate certificate in the specified store. By default this option
looks for <code>StoreName</code>, <code>StoreLocation</code> and <code>SubjectName</code> in configuration file
under <code>Gazel.Certificate</code> section like the following;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"StoreName"</span><span class="token operator">:</span> <span class="token string">"TrustedPublisher"</span><span class="token punctuation">,</span>
            <span class="token property">"StoreLocation"</span><span class="token operator">:</span> <span class="token string">"LocalComputer"</span><span class="token punctuation">,</span>
            <span class="token property">"SubjectName"</span><span class="token operator">:</span> <span class="token string">"Gazel"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If no configuration was given, <code>storeName</code> defaults to <code>TrustedPublisher</code>,
<code>storeLocation</code> defaults to <code>LocalComputer</code>. Possible values to these
parameters can be found at <a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.storename" rel="nofollow noopener noreferrer" target="_blank">StoreName</a> and <a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.storelocation" rel="nofollow noopener noreferrer" target="_blank">StoreLocation</a> pages.</p>
<p>You can override this configuration directly from configurer as well;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509Store</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">storeName</span><span class="token punctuation">:</span> StoreName<span class="token punctuation">.</span>TrustedPublisher<span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">storeLocation</span><span class="token punctuation">:</span> StoreLocation<span class="token punctuation">.</span>LocalMachine
<span class="token punctuation">)</span>
</code></pre></div>
<p>For the extra search parameter, you may give any of search criteria defined in
<a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509findtype" rel="nofollow noopener noreferrer" target="_blank">X509FindType</a>. All values of <code>X509FindType</code> enum starts with <code>FindBy</code>
prefix, which is removed in configuration keys. For example if you use
<code>FindByIssuerName</code> and use <code>Inventiv</code> as its value, you should change
configuration as follows;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"StoreName"</span><span class="token operator">:</span> <span class="token string">"TrustedPublisher"</span><span class="token punctuation">,</span>
            <span class="token property">"StoreLocation"</span><span class="token operator">:</span> <span class="token string">"LocalComputer"</span><span class="token punctuation">,</span>
            <span class="token property">"IssuerName"</span><span class="token operator">:</span> <span class="token string">"Inventiv"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>You cannot override this extra search parameter from configurer like you do
it with <code>storeName</code> and <code>storeLocation</code> parameters. It has to be specified
from configuration file.</p>
</div></div></div>
<h3 id="x509certificatefromp12file"><a href="#x509certificatefromp12file" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>X509CertificateFromP12File</code></h3>
<p>This option enables you to load a <a href="https://en.wikipedia.org/wiki/PKCS_12" rel="nofollow noopener noreferrer" target="_blank">PKCS #12</a> certificate from <code>.p12</code> file
using configured <code>IFileSystem</code> instance (see <a href="features#file-system">File
System</a>) and suitable in non-Windows operating systems.
Below code enables this option;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509CertificateFromP12File</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>It requires <code>path</code> and <code>passwordFile</code> information to load a certificate from
given path and use private key with the password specified in given password
file. By default it looks for <code>Path</code> and <code>PasswordFile</code> keys in configuration
under <code>Gazel.Certificate</code> section as follows;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"Path"</span><span class="token operator">:</span> <span class="token string">"Gazel.p12"</span><span class="token punctuation">,</span>
            <span class="token property">"PasswordFile"</span><span class="token operator">:</span> <span class="token string">".CERTPASS"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>When configuration does not contain these keys, <code>path</code> defaults to <code>Gazel.p12</code>
and <code>passwordFile</code> defaults to <code>.CERTPASS</code>.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Private key password is asked to be in a separate file so that you can
include a certificate, such as a development certificate in your code
repository, but put <code>.CERTPASS</code> file in <code>.gitignore</code>. This will protect your
certificate even if you include it in your repository.</p>
</div></div></div>
<p>You may override these configurations to be set directly from configurer;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509CertificateFromP12File</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">path</span><span class="token punctuation">:</span> <span class="token string">"Inventiv.p12"</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">passwordFile</span><span class="token punctuation">:</span> <span class="token string">".Inventiv.p12.pass"</span>
<span class="token punctuation">)</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>We suggest you to use a hidden file for password files. In a unix-like
operating systems when a file starts with a dot, it means it is a hidden file
(see <a href="https://en.wikipedia.org/wiki/Dot_file" rel="nofollow noopener noreferrer" target="_blank">Dot file</a>). In Windows operating systems you explicitly need to set a
file as hidden.</p>
</div></div></div>
<h3 id="x509certificatefrompem"><a href="#x509certificatefrompem" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>X509CertificateFromPem</code></h3>
<p>This option enables you to give certificate information directly from
configuration file or configurer. Gazel uses this option to register a stub
certificate during unit test runs. Below code enables this option;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509CertificateFromPem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>This option requires <code>certPem</code>, <code>keyPem</code> and <code>passwordFile</code> information to be
used. By default it looks for these information configuration file using
<code>CertPem</code>, <code>KeyPem</code> and <code>PasswordFile</code> keys, respectively, under
<code>Gazel.Certificate</code> section. Certificate contents usually start with
<code>-----BEGIN CERTIFICATE-----</code> and has new lines in them. To handle this you
need to use <code>\n</code> character in json string, an example is as follows;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"CertPem"</span><span class="token operator">:</span> <span class="token string">"-----BEGIN CERTIFICATE-----\nMIIC7zCCAdegAwIBAgIQhaAixfnuiK5HBHMC+kz4zTANBgkqhkiG9w0BAQsFADAQ\nMQ4wDAYDVQQDEwVHYXplbDAeFw0xODAxMTcxMDMxMDFaFw0zOTEyMzEyMzU5NTla..."</span><span class="token punctuation">,</span>
            <span class="token property">"KeyPem"</span><span class="token operator">:</span> <span class="token string">"-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIIFHDBOBgkqhkiG9w0BBQ0wQTApBgkqhkiG9w0BBQwwHAQIG7xEAxkSK6gCAggA\nMAwGCCqGSIb3DQIJBQAwFAYIKoZIhvcNAwcECEmeebmmTgQsBIIEyJGTsjMc2869..."</span><span class="token punctuation">,</span>
            <span class="token property">"PasswordFile"</span><span class="token operator">:</span> <span class="token string">".CERTPASS"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Gazel does not have a default certificate so <code>certPem</code> and <code>keyPem</code> do not have
a default. Just like previous option, <code>passwordFile</code> defaults to <code>.CERTPASS</code>.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">X509CertificateFromPem</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">certPem</span><span class="token punctuation">:</span> <span class="token string">@"
-----BEGIN CERTIFICATE-----
MIIC7zCCAdegAwIBAgIQhaAixfnuiK5HBHMC+kz4zTANBgkqhkiG9w0BAQsFADAQ
MQ4wDAYDVQQDEwVHYXplbDAeFw0xODAxMTcxMDMxMDFaFw0zOTEyMzEyMzU5NTla
...
-----END CERTIFICATE-----
"</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">keyPem</span><span class="token punctuation">:</span> <span class="token string">@"
-----BEGIN ENCRYPTED PRIVATE KEY-----
MIIFHDBOBgkqhkiG9w0BBQ0wQTApBgkqhkiG9w0BBQwwHAQIG7xEAxkSK6gCAggA
MAwGCCqGSIb3DQIJBQAwFAYIKoZIhvcNAwcECEmeebmmTgQsBIIEyJGTsjMc2869
...
-----END ENCRYPTED PRIVATE KEY-----
"</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">passwordFile</span><span class="token punctuation">:</span> <span class="token string">".CERTIFICATE_PASSWORD"</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>Above example illustrates how you can override default configuratiion directly
from configurer.</p>
<div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div> <div class="col">

<p>Configuring certificate directly from configurer is <strong>not</strong> recommended for
production code, because it may lead you to include production certificate
directly in source code. Production certificates are strongly recommended
<strong>not</strong> to be in your repository. If you choose <code>X509CertificateFromPem</code>
option, make sure you load certificate from configuration file and you don't
include <code>Gazel.Certificate</code> section of your production environment
configuration in your repository.</p>
</div></div></div>
<h3 id="autoresolve"><a href="#autoresolve" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>AutoResolve</code></h3>
<p>This option is the default option for crypto feature and enables you to
configure crypto feature completely through configuration file. You don't have
to select this option explicitly but you can still choose to do it as shown
below;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>crypto<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">AutoResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p>It does not accept any parameters. Default behaviour is to use <code>X509Store</code> on
Windows and <code>X509CertificateFromP12File</code> on unix-like operating systems. To
explicitly specify which option to use, you can add <code>Type</code> key under
<code>Gazel.Certificate</code> section;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"X509Store"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Option names are the same as previous sections; <code>X509Store</code>,
<code>X509CertificateFromP12File</code> and <code>X509CertificateFromPem</code>. Each option expects
its own keys as explained in previous sections. Below example uses store option
and specifies certificate information under same conffiguration section;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"X509Store"</span><span class="token punctuation">,</span>
            <span class="token property">"SubjectName"</span><span class="token operator">:</span> <span class="token string">"Inventiv"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>Combining options is also possible. Assume some people use Windows for
development and some use unix-like systems. Below example will be sufficient
to configure both at one place;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"Gazel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Certificate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"SubjectName"</span><span class="token operator">:</span> <span class="token string">"Inventiv"</span><span class="token punctuation">,</span>
            <span class="token property">"Path"</span><span class="token operator">:</span> <span class="token string">"Inventiv.p12"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This configuration will look for a certificate with subject name <code>Inventiv</code>
in trusted publisher and local machine for Windows operating systems, and
will look for a certificate <code>Inventiv.p12</code> in file system for unix-like
operating systems.</p>
</div></div></div>
<h4 id="configuring-certificates-for-a-gazel-cli-process"><a href="#configuring-certificates-for-a-gazel-cli-process" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuring certificates for a Gazel CLI process</h4>
<p>Gazel CLI allows you to generate a schema from a bin directory. When you use
this option Gazel CLI will render given bin directory including your
configuration files and configurers in your <code>Program.cs</code>. This means that if
you use crypto feature, especially in configuration files, it might require a
correct configuration for crypto feature as well.</p>
<p>Gazel CLI uses <code>Development</code> for environment by default. However if you face a
problem while generating schema, code or dll because of encryption problems,
you can make use of <code>--environment</code> option to set environment during Gazel CLI
process.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-bash"><code>g schemagen bin/net6.0/Debug <span class="token parameter variable">--environment</span> GazelCLI
</code></pre></div>
<p>This, for example, sets environment to <code>GazelCLI</code> so that you can create a
<code>appsettings.GazelCLI.json</code> file and specify your certificate option in this
configuration under <code>Gazel.Certificate</code> section.</p></div></div><div><section id="exception-handling"><h1 class="article-title">Exception Handling</h1></section> <div class="nuxt-content"><p>Exception handling feature provides a way for your services to respond with a
code and a message for every request. To set an error code and message in your
response you simply implement an exception class that extends
<code>ServiceException</code> and throw an instance of that exception class in your
business code.</p>
<p>But before you start writing exception classes and use them right away, we want
to describe result code system in Gazel.</p>
<h2 id="result-codes"><a href="#result-codes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Result Codes</h2>
<p>Result codes are reserved numbers starting from <code>0</code> to <code>99999</code> that will
represent a response status of a service in your system. There are 5 types of
result codes;</p>



































<table class="table"><thead><tr><th>Type</th><th>Abbr.</th><th>Code Range</th></tr></thead><tbody><tr><td>Success</td><td>-</td><td><code>0</code></td></tr><tr><td>Info</td><td><code>INF</code></td><td><code>1 - 10000</code></td></tr><tr><td>Warning</td><td><code>WAR</code></td><td><code>10001 - 20000</code></td></tr><tr><td>Error</td><td><code>ERR</code></td><td><code>20001 - 90000</code></td></tr><tr><td>Fatal</td><td>-</td><td><code>99999</code></td></tr></tbody></table>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>These types are represented by <code>ResultCodeType</code> enum in <code>Gazel.Service</code>
namespace.</p>
</div></div></div>
<h3 id="result-code-blocks"><a href="#result-code-blocks" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Result Code Blocks</h3>
<p>There are two main concerns about result codes that need to be addressed;</p>
<ol>
<li>To be unique and static so that they can be documented</li>
<li>To be organized so that they are easily used</li>
</ol>
<p>There are <code>10K</code> info, <code>10K</code> warning codes and <code>70K</code> error codes. To organize
these numbers without breaking uniqueness you may split those codes into
blocks, so that for every result code block there are <code>100</code> info, <code>100</code> warning
and <code>700</code> error codes. Here is the table for result codes organized using
result code blocks;</p>









































<table class="table"><thead><tr><th>Block Index</th><th>Info</th><th>Warning</th><th>Error</th></tr></thead><tbody><tr><td><em>#0 (Reserved)</em></td><td><code>1 - 100</code></td><td><code>10001 - 10100</code></td><td><code>20001 - 20700</code></td></tr><tr><td><em>#1</em></td><td><code>101 - 200</code></td><td><code>10101 - 10200</code></td><td><code>20701 - 21400</code></td></tr><tr><td><em>#2</em></td><td><code>201 - 300</code></td><td><code>10201 - 10300</code></td><td><code>21401 - 22100</code></td></tr><tr><td>...</td><td></td><td></td><td></td></tr><tr><td><em>#99</em></td><td><code>9901 - 10000</code></td><td><code>19901 - 20000</code></td><td><code>89301 - 90000</code></td></tr></tbody></table>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Block <code>0</code> is reserved for built-in result codes such as <code>20001 - Authentication Required</code> etc. See <a href="features#built-in-errors">below section</a>
for all built-in result codes of Gazel</p>
</div></div></div>
<p>To create a result code block extend <code>ResultCodeBlocks</code> class like this;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultCodes</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ResultCodeBlocks</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">ResultCodeBlock</span> MyBlock <span class="token operator">=</span> <span class="token function">CreateBlock</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"MyBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You will use this class potentially from every business module, so it's
better for this to be included in the most base business module.</p>
</div></div></div>
<p>Now that we've created a block called <code>MyBlock</code> at index <code>1</code>, let's use this
block to create a unique result code within its code ranges;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">using</span> <span class="token keyword">static</span> <span class="token class-name">MyProduct<span class="token punctuation">.</span>ResultCodes</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>MyBlock<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 101</span>
MyBlock<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 111</span>

MyBlock<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10101</span>
MyBlock<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10111</span>

MyBlock<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20701</span>
MyBlock<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20711</span>
</code></pre></div>
<p>You may use one block per business module in your project. This way, errors
will be organized by the domain they belong to.</p>
<h2 id="response-status"><a href="#response-status" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Response Status</h2>
<p>Response status is managed by <code>Status</code> property of <code>IResponse</code> to which you can
access through <code>IModuleContext</code>.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code>context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Status
</code></pre></div>
<p>Type of this property is <code>IResponseStatus</code>, which is the interface to represent
all response statuses. There are 3 base classes that implements this interface;</p>
<ul>
<li><code>ServiceInformation</code> for information</li>
<li><code>ServiceWarning</code> for warnings</li>
<li><code>ServiceException</code> for errors</li>
</ul>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>In service applications, <code>ServiceInformation</code> and <code>ServiceWarning</code> are
included in response headers along with the successful response body.
However, <code>ServiceException</code> is returned directly in the response body.</p>
</div></div></div>
<h3 id="implementing-a-response-status"><a href="#implementing-a-response-status" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Implementing a response status</h3>
<p>For every message and status extend one of the response status base classes
with a proper result code.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">using</span> <span class="token keyword">static</span> <span class="token class-name">MyProduct<span class="token punctuation">.</span>ResultCodes</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThisIsWrong</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceException</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">ThisIsWrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>MyBlock<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyWarnings</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YouAreWarned</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceWarning</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">YouAreWarned</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>MyBlock<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Here you can see that we've used a result code block <code>MyBlock</code> to give a
proper warning code.</p>
</div></div></div>
<h3 id="throwing-exceptions"><a href="#throwing-exceptions" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Throwing exceptions</h3>
<p>When you implement an exception class that extends <code>ServiceException</code> you may
throw it just like any .NET exception;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">using</span> <span class="token keyword">static</span> <span class="token class-name">MyProduct<span class="token punctuation">.</span>MyExceptions</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GiveMeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ThisIsWrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Exception handling mechanism catches this exception and automatically sets it
as a response status.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>When you throw an exception that is not a <code>ServiceException</code>, then it will be
treated as a fatal error with result code <code>99999</code>. To handle other exceptions
than <code>ServiceException</code> you need to implement a custom exception handler as
mentioned in <a href="features#customization">below section</a>.</p>
</div></div></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You may still catch this exception from your business code so that exception
handling mechanism is not triggered.</p>
</div></div></div>
<h3 id="setting-response-status"><a href="#setting-response-status" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Setting response status</h3>
<p>You may also directly set <code>context.Response.Status</code> property with an
<code>IResponseStatus</code> instance. Below is an example of setting status to a warning;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">using</span> <span class="token keyword">static</span> <span class="token class-name">MyProduct<span class="token punctuation">.</span>MyWarnings</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IModuleContext</span> context<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MyManager</span><span class="token punctuation">(</span><span class="token class-name">IModuleContext</span> context<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GiveMeStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Status <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">YouAreWarned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="log-levels"><a href="#log-levels" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Log Levels</h3>
<ul>
<li>Handled exceptions, responses with error codes, are logged in <strong>Warning</strong>
level.</li>
<li>Unhandled exceptions, responses with fatal code , are logged in <strong>Error</strong>
level.</li>
<li>Other statuses are not logged separately.</li>
</ul>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>You may configure logging to only include error logs in production, so that
you can monitor unhandled errors in the production code.</p>
</div></div></div>
<h3 id="localizing-messages"><a href="#localizing-messages" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Localizing messages</h3>
<p>Every result code should have a corresponding message in localization.
Exception handling uses <code>ILocalizer</code> to retrieve message format using a key
with type and code such as <code>ERR-20001</code>, <code>WAR-10001</code>. Once message format is
retrieved, it is formatted using message parameters in response status object.</p>
<p>Let's say you defined another exception in <code>MyBlock</code>;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequiredParameter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceException</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">RequiredParameter</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> parameterName<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>MyBlock<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameterName<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This would have a localization key <code>ERR-20702</code>.</p>
<p>Assume your localization has a message like this;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
    <span class="token property">"ERR-20702"</span><span class="token operator">:</span> <span class="token string">"Parameter is required: '{0}'"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>When you throw this exception;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateEmployee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> ssid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhitespace</span><span class="token punctuation">(</span>ssid<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RequiredParameter</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>ssid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>You will send a response with code <code>20702</code> and message;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-text"><code>Parameter is required: 'ssid'
</code></pre></div>
<h3 id="including-extra-data"><a href="#including-extra-data" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Including extra data</h3>
<p><code>ServiceException</code> class has a special property called <code>ExtraData</code> to enable you
to include extra data along with code and message so that client applications can
use this information to handle some business logic in exception case.</p>
<p>Assume you have a <code>Withdraw</code> service that withdraws money from an account. You
may return current balance in extra data, when withdraw operation throws
insufficient balance exception so that client application can use it to provide
some further functionality.</p>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Service applications include this informations in <code>X-Extra-Data</code> response
header. Other applications, e.g. api application, may not return this
information.</p>
</div></div></div>
<h2 id="built-in-errors"><a href="#built-in-errors" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Built-in Errors</h2>
<p>Below you can see built-in exceptions and their defined error codes;</p>






































































































































































































































<table class="table"><thead><tr><th>Error Code</th><th>Error Type</th><th>HTTP Status Code<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup></th></tr></thead><tbody><tr><td>20001</td><td>AuthenticationRequiredException</td><td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401" rel="nofollow noopener noreferrer" target="_blank">401</a></td></tr><tr><td>20002</td><td>FormatException</td><td></td></tr><tr><td>20003</td><td>PermissionDeniedException</td><td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403" rel="nofollow noopener noreferrer" target="_blank">403</a></td></tr><tr><td>20004</td><td>FormatException&lt;<strong>CreditCardNumber</strong>></td><td></td></tr><tr><td>20005</td><td>UriFormatException</td><td></td></tr><tr><td>20006</td><td>ObjectNotFoundException</td><td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404" rel="nofollow noopener noreferrer" target="_blank">404</a></td></tr><tr><td>20007</td><td>FormatException&lt;<strong>AppToken</strong>></td><td></td></tr><tr><td>20008</td><td>FormatException&lt;<strong>CardNumber</strong>></td><td></td></tr><tr><td>20009</td><td>FormatException&lt;<strong>CurrencyCode</strong>></td><td></td></tr><tr><td>20010</td><td>FormatException&lt;<strong>DateRange</strong>></td><td></td></tr><tr><td>20011</td><td>FormatException&lt;<strong>Date</strong>></td><td></td></tr><tr><td>20012</td><td>FormatException&lt;<strong>Email</strong>></td><td></td></tr><tr><td>20013</td><td>FormatException&lt;<strong>MoneyRange</strong>></td><td></td></tr><tr><td>20014</td><td>FormatException&lt;<strong>Money</strong>></td><td></td></tr><tr><td>20015</td><td>FormatException&lt;<strong>Tckn</strong>></td><td></td></tr><tr><td>20016</td><td>FormatException&lt;<strong>TimeRange</strong>></td><td></td></tr><tr><td>20017</td><td>FormatException&lt;<strong>Time</strong>></td><td></td></tr><tr><td>20018</td><td>FormatException&lt;<strong>Vkn</strong>></td><td></td></tr><tr><td>20019</td><td>InvalidEnumArgumentException</td><td></td></tr><tr><td>20020</td><td>RangeException&lt;<strong>DateRange</strong>></td><td></td></tr><tr><td>20021</td><td>RangeException&lt;<strong>MoneyRange</strong>></td><td></td></tr><tr><td>20022</td><td>RangeException&lt;<strong>TimeRange</strong>></td><td></td></tr><tr><td>20023</td><td>FormatException&lt;<strong>TriState</strong>></td><td></td></tr><tr><td>20024</td><td>InvalidCurrencyException</td><td></td></tr><tr><td>20025</td><td>FormatException&lt;<strong>Rate</strong>></td><td></td></tr><tr><td>20026</td><td>FormatException&lt;<strong>Timestamp</strong>></td><td></td></tr><tr><td>20027</td><td>FormatException&lt;<strong>DateTime</strong>></td><td></td></tr><tr><td>20028</td><td>FormatException&lt;<strong>DateTimeRange</strong>></td><td></td></tr><tr><td>20029</td><td>RangeException&lt;<strong>DateTimeRange</strong>></td><td></td></tr><tr><td>20030</td><td>FormatException&lt;<strong>Guid</strong>></td><td></td></tr><tr><td>20031</td><td>RequestIdRequiredException</td><td></td></tr><tr><td>20032</td><td>FormatException&lt;<strong>Binary</strong>></td><td></td></tr><tr><td>20033</td><td>MaxDailyRequestCountExceededException</td><td></td></tr><tr><td>20034</td><td>FormatException&lt;<strong>Iban</strong>></td><td></td></tr><tr><td>20035</td><td>FormatException&lt;<strong>Geoloc</strong>></td><td></td></tr><tr><td>20036</td><td>FormatException&lt;<strong>TimeSpan</strong>></td><td></td></tr><tr><td>20037</td><td>FormatException&lt;<strong>VknOrTckn</strong>></td><td></td></tr><tr><td>20038</td><td>FormatException&lt;<strong>MimeType</strong>></td><td></td></tr><tr><td>20039</td><td>FormatException&lt;<strong>CountryCode</strong>></td><td></td></tr><tr><td>20040</td><td>NotImplementedException</td><td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/501" rel="nofollow noopener noreferrer" target="_blank">501</a><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></td></tr><tr><td>20041</td><td>FormatException&lt;<strong>Password</strong>></td><td></td></tr><tr><td>20042</td><td>FormatException&lt;<strong>EncryptedString</strong>></td><td></td></tr><tr><td>20201</td><td>FrameworkExceptions.Remote</td><td></td></tr><tr><td>20202</td><td>FrameworkExceptions.InvalidSign</td><td></td></tr></tbody></table>
<h3 id="information-and-warnings"><a href="#information-and-warnings" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Information and Warnings</h3>

























<table class="table"><thead><tr><th>Result Code</th><th>Response Status</th></tr></thead><tbody><tr><td>1</td><td>FrameworkInformations.Remote</td></tr><tr><td>10001</td><td>FrameworkWarnings.ObsoleteServiceCalled</td></tr><tr><td>10002</td><td>FrameworkWarnings.Remote</td></tr><tr><td>10003</td><td>FrameworkWarnings.GivenLanguageCodeIsNotSupported</td></tr></tbody></table>
<h2 id="exception-handling-customization"><a href="#customization-exception-handling-customization" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Customization </h2>
<p>Exception handling mechanism is a core feature of Gazel framework. You cannot
change the underlying mechanism nor you cannot disable it. However, you can
extend it to provide additional exception handlers.</p>
<h3 id="creating-a-custom-handler"><a href="#creating-a-custom-handler" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating a custom handler</h3>
<p>Exception handling is done through <code>IExceptionHandler</code> interface. If you want
to provide a custom mechanism to handle errors, you must implement this
interface and register it to <code>IKernel</code>.</p>
<p>When an exception is thrown, exception handling feature loops through all
exception handlers to find a way to convert the exception into
<code>ServiceException</code>. If it can, then it means exception is handled with an error
code, if it cannot, then it means it is an unhandled exception with the fatal
code.</p>
<p>Below is an example of a custom exception handler for <code>ArgumentException</code>;</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IExceptionHandler</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Handles</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token operator">=></span> ex <span class="token keyword">is</span> <span class="token class-name">ArgumentException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ServiceException</span> <span class="token function">Handle</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceException</span><span class="token punctuation">(</span><span class="token number">90001</span><span class="token punctuation">)</span>
    <span class="token return-type class-name">ExceptionInfo</span> <span class="token function">GetExceptionInfo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> resultCode<span class="token punctuation">)</span> <span class="token operator">=></span>
        resultCode <span class="token operator">==</span> <span class="token number">90001</span>
            <span class="token punctuation">?</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExceptionInfo</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ArgumentException</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>If you implement a handler inside a module project, it will be automatically
registered to kernel so that exception handling can use your custom handler.</p>
</div></div></div>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">This mapping violates <code>4xx</code> rule for handled exceptions. This is intentional to provide you to throw a <code>NotImplementedException</code> anywhere without causing an error log.<a href="#fnref-1" class="footnote-backref">↩</a></li>
<li id="fn-2">All handled errors are <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400" rel="nofollow noopener noreferrer" target="_blank">400</a> unless indicated otherwise.<a href="#fnref-2" class="footnote-backref">↩</a></li>
</ol>
</div></div></div><div><section id="file-system"><h1 class="article-title">File System</h1></section> <div class="nuxt-content"><p>File system feature basically enables you to read/write file content from/to a
file storage.</p>
<h2 id="ifilesystem-interface"><a aria-hidden="true" href="#ifilesystem-interface" tabindex="-1"><span class="icon icon-link"></span></a><code>IFileSystem</code> interface</h2>
<p>When an application has this feature, you can directly inject <code>IFileSystem</code> interface
into your business objects. Below is a simple example;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileManager</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IFileSystem</span> file<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">FileManager</span><span class="token punctuation">(</span><span class="token class-name">IFileSystem</span> file<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>file <span class="token operator">=</span> file<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">await</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Binary<span class="token punctuation">></span></span> <span class="token function">FetchContent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">ReadAsync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="file-system-configuration"><a aria-hidden="true" href="#configuration-file-system-configuration" tabindex="-1"><span class="icon icon-link"></span></a>Configuration </h2>
<p>Gazel has a built-in implementation that uses local storage.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    fileSystem<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">Local</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">rootPath</span><span class="token punctuation">:</span> <span class="token string">"files"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>When <code>rootPath</code> is given, all files will be stored under this folder. You might
pass an absolute path as well.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">Local</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">rootPath</span><span class="token punctuation">:</span> <span class="token string">"/absolute-path"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p>Local storage makes sense for development environment. You may use a network
path by giving an absolute path as well.</p>
</div></div></div>
<h2 id="file-system-customization"><a aria-hidden="true" href="#customization-file-system-customization" tabindex="-1"><span class="icon icon-link"></span></a>Customization </h2>
<p>When you want to store files in a different type of storage, you can implement
<code>IFileSystem</code> interface and register it using <code>Custom</code> configurer in
<code>FileSystemConfigurer</code>.</p>
<p>Assume you've made an S3 implementation of file system interface, you can
register it as below;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Custom</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>S3FileSystem<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p>If your implementation depends on some configuration, write a settings class,
register it to the IoC and inject it to the file system implementation.</p>
<p>For above example, write a class named <code>S3Settings</code> and inject it into
<code>S3FileSystem</code> class, and then register <code>S3Settings</code> to the kernel.</p>
</div></div></div></div></div><div><section id="configurations"><h1 class="article-title">Configurations</h1></section> <div class="nuxt-content"><h2 id="application-assemblies"><a aria-hidden="true" href="#application-assemblies" tabindex="-1"><span class="icon icon-link"></span></a>Application Assemblies</h2>
<p>You may change which assemblies are used for an application via this
configuration. By default Gazel loads all assemblies starting with the root
namespace of your entry assembly. Assume your <code>Program.cs</code> is in a project
named <code>MyCompany.MyComponent.App.Service</code>, then the root namespace is
<code>MyCompany</code>.</p>
<p>Each application configurer has a configuration named <code>applicationAssemblies</code>
which is a lambda function that provides <code>Assemblies</code> instance as a parameter
and expects <code>List&lt;Assembly></code> as a result. Below you can find default
configuration;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    applicationAssemblies<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>All
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>There are several ways to determine which assemblies to use;</p>
<h3 id="filtering-all"><a aria-hidden="true" href="#filtering-all" tabindex="-1"><span class="icon icon-link"></span></a>Filtering <code>All</code></h3>
<p>You can directly filter out unwanted assemblies returned by <code>All</code> property.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    applicationAssemblies<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span>All<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=></span> <span class="token operator">!</span>a<span class="token punctuation">.</span>FullName<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"Exclude"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="find-by-namespace"><a aria-hidden="true" href="#find-by-namespace" tabindex="-1"><span class="icon icon-link"></span></a>Find By Namespace</h3>
<p>There is a method on <code>Assemblies</code> class called <code>Find</code> that takes a namespace
predicate as a parameter;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    applicationAssemblies<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ns <span class="token operator">=></span> ns<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">"MyCompany"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="find-by-regex"><a aria-hidden="true" href="#find-by-regex" tabindex="-1"><span class="icon icon-link"></span></a>Find By Regex</h3>
<p>You can also provide a namespace regex;</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    applicationAssemblies<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"^MyCompany.*$"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="find-by-assemblytype"><a aria-hidden="true" href="#find-by-assemblytype" tabindex="-1"><span class="icon icon-link"></span></a>Find By <code>AssemblyType</code></h3>
<p>You can make use of <code>AssemblyType</code> class.</p>
<div class="nuxt-content-highlight"><pre class="language-csharp line-numbers"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGazelServiceApplication</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    applicationAssemblies<span class="token punctuation">:</span> c <span class="token operator">=></span> c<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>AssemblyType<span class="token punctuation">.</span>Module<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div> <div class="col">

<p><code>c => c.Find(AssemblyType.All)</code> is equivalent to <code>c => c.All</code></p>
</div></div></div>
<div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div> <div class="col">

<p><code>AssemblyType</code> uses root namespace of your project that is resolved
automatically. You can access your root namespace programmatically via
<code>AssemblyType.Root</code> or <code>Config.RootNamespace</code>.</p>
</div></div></div>
<h2 id="application-session"><a aria-hidden="true" href="#application-session" tabindex="-1"><span class="icon icon-link"></span></a>Application Session</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="business-logic"><a aria-hidden="true" href="#business-logic" tabindex="-1"><span class="icon icon-link"></span></a>Business Logic</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="command-line"><a aria-hidden="true" href="#command-line" tabindex="-1"><span class="icon icon-link"></span></a>Command Line</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="database"><a aria-hidden="true" href="#database" tabindex="-1"><span class="icon icon-link"></span></a>Database</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="gateway"><a aria-hidden="true" href="#gateway" tabindex="-1"><span class="icon icon-link"></span></a>Gateway</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="http-header"><a aria-hidden="true" href="#http-header" tabindex="-1"><span class="icon icon-link"></span></a>Http Header</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="middleware"><a aria-hidden="true" href="#middleware" tabindex="-1"><span class="icon icon-link"></span></a>Middleware</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="rest-api"><a aria-hidden="true" href="#rest-api" tabindex="-1"><span class="icon icon-link"></span></a>Rest Api</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="service-client"><a aria-hidden="true" href="#service-client" tabindex="-1"><span class="icon icon-link"></span></a>Service Client</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="service"><a aria-hidden="true" href="#service" tabindex="-1"><span class="icon icon-link"></span></a>Service</h2>
<blockquote>
<p>TBD</p>
</blockquote></div></div><div><section id="options"><h1 class="article-title">Options</h1></section> <div class="nuxt-content"><h2 id="audit"><a aria-hidden="true" href="#audit" tabindex="-1"><span class="icon icon-link"></span></a>Audit</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="decimal-point"><a aria-hidden="true" href="#decimal-point" tabindex="-1"><span class="icon icon-link"></span></a>Decimal Point</h2>
<blockquote>
<p>TBD</p>
</blockquote>
<h2 id="utc"><a aria-hidden="true" href="#utc" tabindex="-1"><span class="icon icon-link"></span></a>UTC</h2>
<blockquote>
<p>TBD</p>
</blockquote></div></div></div></div></div></div></div></div></div></div><script defer src="/_nuxt/static/1668606782/features/state.js"></script><script src="/_nuxt/1971f5d.js" defer></script><script src="/_nuxt/e82329e.js" defer></script><script src="/_nuxt/de6aec2.js" defer></script><script src="/_nuxt/c309ceb.js" defer></script><script src="/_nuxt/f12e08d.js" defer></script><script src="/_nuxt/ef83327.js" defer></script><script src="/_nuxt/ccecb32.js" defer></script>
  </body>
</html>

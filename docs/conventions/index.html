<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="format-detection" content="telephone=no">
<meta property="og:url" content="https://gazel.io">
<meta property="og:image" content="https://gazel.io/main_logo_1x.png">
<meta property="og:image:width" content="270">
<meta property="og:image:height" content="64">
<link rel="icon" type="image/png" href="/favicon.png">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/css/stylesheet.css">
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
<title>Gazel - Documentation</title>
<meta property="og:title" content="Gazel - Conventions">
<meta property="og:description" content="In this section you will learn about the conventions in Gazel.">
<meta name="description" content="In this section you will learn about the conventions in Gazel."><link rel="modulepreload" href="/conventions/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.ef08e1a7.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.20a8b0d9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.66578c96.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.7ea06dd1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.58685aca.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/app.config.4734e3a3.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/states.c4a11c4c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_...slug_.7b3d4bb8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.e76a7133.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.18bf65ab.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.81b9ca2f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH1.d4317c6e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.90f43a30.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseEm.c89ce9ec.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.e22f2836.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.03111c9a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.a1e32c98.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseStrong.5600d177.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.34d9d28f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseOl.85554e6f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCodeInline.95409553.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.e3fa3fce.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH3.f1ac3364.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseBlockquote.2c139769.js"><link rel="preload" as="style" href="/_nuxt/Alert.52f5ff90.css"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.ac7cb80d.js"><link rel="stylesheet" href="/_nuxt/Alert.52f5ff90.css"><style>pre{background-color:#1a1b26;border-radius:5px;font-size:.9em;margin-bottom:1rem;padding:1em;text-shadow:none}pre.mermaid{background-color:#fff}.bg-light{background-color:#fff!important}</style><style>#header-logo[data-v-7ce25d56]{max-width:150px}.topmenu-options[data-v-7ce25d56]{font-weight:700}</style><style>pre code .line{display:block;min-height:1rem}</style><style>.alert-message{display:contents;max-width:20px}.alert{border-bottom-width:7px;border-radius:5px;margin:1px 1px 1rem;padding:.9rem}.alert p{margin-bottom:0}.alert .col{padding-left:.9rem;padding-right:.9rem}.alert-message .fa-solid{position:relative;top:6px}</style></head>
<body data-spy="scroll" data-target=".idocs-navigation" data-offset="125"><div id="__nuxt"><!--[--><div id="__layout"><div id="main-wrapper"><header id="header" class="sticky-top" data-v-7ce25d56><nav class="primary-menu navbar navbar-expand-lg bg-light navbar-text-dark navbar-dropdown-light border-0" data-v-7ce25d56><div class="container-fluid" data-v-7ce25d56><button id="sidebar" class="navbar-toggler d-block d-md-none" type="button" data-v-7ce25d56><span data-v-7ce25d56></span><span class="w-75" data-v-7ce25d56></span><span class="w-50" data-v-7ce25d56></span></button><a href="/" class="logo ml-md-2" title="Gazel documentation" data-v-7ce25d56><img id="header-logo" src="/main_logo_1x.png" alt="Gazel documentation" data-v-7ce25d56></a><button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#header-nav" data-v-7ce25d56><span data-v-7ce25d56></span><span data-v-7ce25d56></span><span data-v-7ce25d56></span></button><div id="header-nav" class="collapse navbar-collapse justify-content-end" data-v-7ce25d56><ul class="navbar-nav" data-v-7ce25d56><!--[--><li data-v-7ce25d56><a href="/tutorial" class="topmenu-options" data-v-7ce25d56>Tutorial</a></li><li data-v-7ce25d56><a aria-current="page" href="/conventions" class="router-link-active router-link-exact-active topmenu-options" data-v-7ce25d56>Conventions</a></li><li data-v-7ce25d56><a href="/setup" class="topmenu-options" data-v-7ce25d56>Setup</a></li><li data-v-7ce25d56><a href="/architecture" class="topmenu-options" data-v-7ce25d56>Architecture</a></li><li data-v-7ce25d56><a href="/features" class="topmenu-options" data-v-7ce25d56>Features</a></li><li data-v-7ce25d56><a href="/release-notes" class="topmenu-options" data-v-7ce25d56>Release Notes</a></li><!--]--></ul></div><ul class="social-icons social-icons-sm ml-lg-2 mr-2" data-v-7ce25d56><li class="social-icons-github" data-v-7ce25d56><a href="https://github.com/multinetinventiv/gazel" rel="noopener noreferrer" target="_blank" data-toggle="tooltip" title data-original-title="Github" data-v-7ce25d56><i class="fab fa-github" data-v-7ce25d56></i></a></li></ul></div></nav></header><div id="content" role="main"><div class="idocs-content"><div class="container"><!--[--><!--[--><div><div class="idocs-navigation bg-light"><ul class="nav flex-column"><!--[--><li class="nav-item"><a class="nav-link" href="#">Conventions</a><ul class="nav flex-column"><!--[--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#dependency-injection">Dependency Injection</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-scopes">Scopes</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-manager-classes">Manager classes</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-injecting-a-dependency">Injecting a Dependency</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-imodulecontext-interface">IModuleContext interface</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-injecting-interfaces">Injecting Interfaces</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#dependency-injection-injecting-multiple-implementations">Injecting Multiple Implementations</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#business-services">Business Services</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-public-methods">Public Methods</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-persistent-objects-as-parameters">Persistent Objects as Parameters</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-method-overloads">Method Overloads</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-optional-parameters">Optional parameters</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-list-and-array-parameters-and-return-types">List and array parameters and return types</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-data-transfer-objects-dtos">Data Transfer Objects (DTOs)</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#business-services-hiding-public-methods-and-properties">Hiding Public Methods and Properties</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#data-persistence">Data Persistence</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#data-persistence-persistent-class-conventions">Persistent Class Conventions</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#data-persistence-inserting-a-new-record">Inserting a New Record</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#data-persistence-updating-a-record">Updating a Record</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#data-persistence-deleting-a-record">Deleting a Record</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#relations">Relations</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#relations-many-to-one-relation">Many-to-One Relation</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#relations-one-to-many-relations">One-to-Many Relations</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#relations-eager-fetching-and-lazy-loading">Eager-Fetching and Lazy-Loading</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#relations-one-to-any-relation">One-to-Any Relation</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#queries">Queries</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-query-class-conventions">Query Class Conventions</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-by-methods">By Methods</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-firstby-and-singleby">FirstBy and SingleBy</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-countby">CountBy</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-anyby">AnyBy</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-minby-and-maxby">MinBy and MaxBy</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-optional-where-clauses">Optional Where Clauses</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#queries-query-base-class">Query Base Class</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#transaction-management">Transaction Management</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#transaction-management-using-main-transaction">Using Main Transaction</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#transaction-management-creating-new-transactions">Creating New Transactions</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#transaction-management-nested-transactions">Nested Transactions</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#transaction-management-example-update-balance-of-an-account">Example: Update Balance of an Account</a></li><!--]--><!--]--></ul></li><li class="nav-item"><a class="nav-link" href="#exception-handling">Exception Handling</a><ul class="nav flex-column"><!--[--><!--[--><li class="nav-item"><a class="nav-link" href="#exception-handling-writing-an-exception">Writing an Exception</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#exception-handling-throwing-an-exception">Throwing an Exception</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#exception-handling-result-codes">Result Codes</a></li><!--]--><!--[--><li class="nav-item"><a class="nav-link" href="#exception-handling-parameterized-exceptions">Parameterized Exceptions</a></li><!--]--><!--]--></ul></li><!--]--></ul></div><section id="conventions"><div><h1 id="conventions"><!--[-->Conventions<!--]--></h1><p><!--[-->In this section you will learn about the conventions in Gazel. Keep in mind
that Gazel heavily relies on <em><!--[-->Convention over Configuration<!--]--></em> design paradigm.<!--]--></p><ul><!--[--><li><!--[--><a aria-current="page" href="/conventions#dependency-injection" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Dependency Injection<!--]--></strong><!--]--> <!----></a>: Learn to use how to make
use of dependency injection in Gazel<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#business-services" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Business Services<!--]--></strong><!--]--> <!----></a>: Find out how a public method
turns into a business service<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#data-persistence" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Data Persistence<!--]--></strong><!--]--> <!----></a>: Understand conventions for data
persistence<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#relations" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Relations<!--]--></strong><!--]--> <!----></a>: Explore different ways to create relations
between persistent classes<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#queries" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Queries<!--]--></strong><!--]--> <!----></a>: Learn how to create query services<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#transaction-management" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Transaction Management<!--]--></strong><!--]--> <!----></a>: Learn about how
Gazel manages transactions<!--]--></li><li><!--[--><a aria-current="page" href="/conventions#exception-handling" class="router-link-active router-link-exact-active"><!--[--><strong><!--[-->Exception Handling<!--]--></strong><!--]--> <!----></a>: See how to write exceptions
in Gazel<!--]--></li><!--]--></ul></div></section><!--[--><section id="dependency-injection"><div><h1 id="dependency-injection"><!--[-->Dependency Injection<!--]--></h1><p><!--[-->Gazel uses <a href="http://www.castleproject.org/projects/windsor" rel="nofollow" target="_blank"><!--[-->Castle.Windsor<!--]--> <i class="fa-solid fa-arrow-up-right-from-square"></i></a> for Dependency Injection. Using Convention over
Configuration capabilities of Castle.Windsor, you don&#39;t have to register your
classes one by one. Every public class in module projects are automatically
registered to the kernel. In this document you will find ways on how to make
use of this feature.<!--]--></p><h2 id="dependency-injection-scopes"><!--[-->Scopes<!--]--></h2><p><!--[-->There are 3 types of scope;<!--]--></p><ol><!--[--><li><!--[-->Transient: For every resolution, Windsor creates a new instance.<!--]--></li><li><!--[-->Request: For every request there is only one instance. After the request
ends, object is disposed.<!--]--></li><li><!--[-->Singleton: There is only one instance until application is shut down.<!--]--></li><!--]--></ol><p><!--[--><code><!--[-->Manager<!--]--></code> and <code><!--[-->Query<!--]--></code> classes are singleton by convention and the rest are
transient.<!--]--></p><h2 id="dependency-injection-manager-classes"><!--[-->Manager classes<!--]--></h2><p><!--[-->For a class to be a manager class, it should have <code><!--[-->Manager<!--]--></code> suffix.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div></code></pre><!--]--><p><!--[-->Manager classes are singleton by convention. You can make use of <code><!--[-->Manager<!--]--></code>
classes to provide general domain logic of a module, batch operations or
complex query services.<!--]--></p><h2 id="dependency-injection-injecting-a-dependency"><!--[-->Injecting a Dependency<!--]--></h2><p><!--[-->Every public class is registered to Castle.Windsor by their own type so that
they can be injected to other classes.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-28935c">readonly</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977"> = </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> { ... }</span></div></code></pre><!--]--><h3 id="dependency-injection-public-constructors"><!--[-->Public Constructors<!--]--></h3><p><!--[-->Every public class should contain a <code><!--[-->public<!--]--></code> constructor, in order for
Castle.Windsor to register and configure them.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">()</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        ...</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div></code></pre><!--]--><h3 id="dependency-injection-circular-dependencies"><!--[-->Circular Dependencies<!--]--></h3><p><!--[-->Avoid creating circular dependencies as shown below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        ...</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">UserManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">ProductManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        ...</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div></code></pre><!--]--><p><!--[-->For such cases;<!--]--></p><ol><!--[--><li><!--[-->Consider refactoring your code. Two classes shouldn&#39;t depend on each other.<!--]--></li><li><!--[-->If you think you have no other choice, then you can refactor code as shown
below;<!--]--></li><!--]--></ol><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-28935c">readonly</span><span class="ct-fe3977"> </span><span class="ct-2fa707">IModuleContext</span><span class="ct-fe3977"> </span><span class="ct-104e05">_context</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">UserManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">IModuleContext</span><span class="ct-fe3977"> </span><span class="ct-104e05">context</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_context</span><span class="ct-fe3977"> = </span><span class="ct-104e05">context</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">ProductManager</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-28935c">get</span></div><div class="line"><span class="ct-fe3977">        {</span></div><div class="line"><span class="ct-fe3977">            </span><span class="ct-476de9">return</span><span class="ct-fe3977"> </span><span class="ct-104e05">_context</span><span class="ct-fe3977">.</span><span class="ct-b868a7">Resolve</span><span class="ct-fe3977">(</span><span class="ct-28935c">typeof</span><span class="ct-fe3977">(</span><span class="ct-2fa707">ProductManager</span><span class="ct-fe3977">), </span><span class="ct-104e05">Scope</span><span class="ct-fe3977">.</span><span class="ct-104e05">Any</span><span class="ct-fe3977">);</span></div><div class="line"><span class="ct-fe3977">        }</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div></code></pre><!--]--><h2 id="dependency-injection-imodulecontext-interface"><!--[--><code><!--[-->IModuleContext<!--]--></code> interface<!--]--></h2><p><!--[--><code><!--[-->IModuleContext<!--]--></code> is basically an abstraction for your domain objects to be
isolated from the 3rd party libraries.<!--]--></p><p><!--[-->For singleton objects, mainly <code><!--[-->Manager<!--]--></code> objects, we encourage you to inject
them through constructor. On the other hand, if you want to create a transient
object, you can make use of <code><!--[-->IModuleContext.New&lt;T&gt;()<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-28935c">readonly</span><span class="ct-fe3977"> </span><span class="ct-2fa707">IModuleContext</span><span class="ct-fe3977"> </span><span class="ct-104e05">_context</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">IModuleContext</span><span class="ct-fe3977"> </span><span class="ct-104e05">context</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_context</span><span class="ct-fe3977"> = </span><span class="ct-104e05">context</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">void</span><span class="ct-fe3977"> </span><span class="ct-b868a7">DoSomethingHeavy</span><span class="ct-fe3977">()</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_context</span><span class="ct-fe3977">.</span><span class="ct-b868a7">New</span><span class="ct-fe3977">&lt;</span><span class="ct-2fa707">BatchUserOperation</span><span class="ct-fe3977">&gt;().</span><span class="ct-b868a7">DoSomethingHeavy</span><span class="ct-fe3977">();</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">BatchUserOperation</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-28935c">readonly</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">BatchUserOperation</span><span class="ct-fe3977">(</span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977"> = </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">internal</span><span class="ct-fe3977"> </span><span class="ct-28935c">void</span><span class="ct-fe3977"> </span><span class="ct-b868a7">DoSomethingHeavy</span><span class="ct-fe3977">() { ... }</span></div><div class="line"><span class="ct-fe3977">}</span></div></code></pre><!--]--><h2 id="dependency-injection-injecting-interfaces"><!--[-->Injecting Interfaces<!--]--></h2><p><!--[-->Public classes can also be injected using their interfaces<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-28935c">readonly</span><span class="ct-fe3977"> </span><span class="ct-2fa707">IUserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">IUserManager</span><span class="ct-fe3977"> </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_userManager</span><span class="ct-fe3977"> = </span><span class="ct-104e05">userManager</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">interface</span><span class="ct-fe3977"> </span><span class="ct-2fa707">IUserManager</span><span class="ct-fe3977"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">UserManager</span><span class="ct-fe3977"> : </span><span class="ct-2fa707">IUserManager</span><span class="ct-fe3977"> { ... }</span></div></code></pre><!--]--><h2 id="dependency-injection-injecting-multiple-implementations"><!--[-->Injecting Multiple Implementations<!--]--></h2><p><!--[-->If an interface has more than one implementations then you can inject all of
them at once by using <code><!--[-->IList&lt;T&gt;<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">ProductManager</span></div><div class="line"><span class="ct-fe3977">{</span></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">private</span><span class="ct-fe3977"> </span><span class="ct-2fa707">IList</span><span class="ct-fe3977">&lt;</span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977">&gt; </span><span class="ct-104e05">_notifiers</span><span class="ct-fe3977">;</span></div><div class="line"></div><div class="line"><span class="ct-fe3977">    </span><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-b868a7">ProductManager</span><span class="ct-fe3977">(</span><span class="ct-2fa707">IList</span><span class="ct-fe3977">&lt;</span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977">&gt; </span><span class="ct-104e05">notifiers</span><span class="ct-fe3977">)</span></div><div class="line"><span class="ct-fe3977">    {</span></div><div class="line"><span class="ct-fe3977">        </span><span class="ct-104e05">_notifiers</span><span class="ct-fe3977"> = </span><span class="ct-104e05">notifiers</span><span class="ct-fe3977">;</span></div><div class="line"><span class="ct-fe3977">    }</span></div><div class="line"><span class="ct-fe3977">    ...</span></div><div class="line"><span class="ct-fe3977">}</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">interface</span><span class="ct-fe3977"> </span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">SmsNotifier</span><span class="ct-fe3977"> : </span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977"> { ... }</span></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">MailNotifier</span><span class="ct-fe3977"> : </span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977"> { ... }</span></div><div class="line"><span class="ct-28935c">public</span><span class="ct-fe3977"> </span><span class="ct-28935c">class</span><span class="ct-fe3977"> </span><span class="ct-2fa707">PushNotifier</span><span class="ct-fe3977"> : </span><span class="ct-2fa707">INotifier</span><span class="ct-fe3977"> { ... }</span></div></code></pre><!--]--><style>.ct-476de9{color:#C586C0}
.ct-b868a7{color:#DCDCAA}
.ct-104e05{color:#9CDCFE}
.ct-2fa707{color:#4EC9B0}
.ct-fe3977{color:#D4D4D4}
.ct-28935c{color:#569CD6}</style></div></section><section id="business-services"><div><h1 id="business-services"><!--[-->Business Services<!--]--></h1><p><!--[-->Gazel configures <a href="https://github.com/multinetinventiv/routine" rel="nofollow" target="_blank"><!--[-->Routine<!--]--> <i class="fa-solid fa-arrow-up-right-from-square"></i></a> to expose every public method to be a business
service. A business service is a public method that you can call using HTTP.<!--]--></p><h2 id="business-services-public-methods"><!--[-->Public Methods<!--]--></h2><p><!--[--><code><!--[-->public<!--]--></code> methods are directly exposed as business services.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">List</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">Branch</span><span class="ct-31574c">&gt; </span><span class="ct-25cc3a">GetBranches</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-199bf8">return</span><span class="ct-31574c"> </span><span class="ct-7b1902">_context</span><span class="ct-31574c">.</span><span class="ct-25cc3a">Query</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">Branches</span><span class="ct-31574c">&gt;().</span><span class="ct-25cc3a">ByCompany</span><span class="ct-31574c">(</span><span class="ct-645ff1">this</span><span class="ct-31574c">);</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><h2 id="business-services-persistent-objects-as-parameters"><!--[-->Persistent Objects as Parameters<!--]--></h2><p><!--[-->You can use a persistent object directly in your business methods. Gazel will
automatically lookup for a record with given id. If record is not found, it
will automatically throw <code><!--[-->ObjectNotFoundException<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-199bf8">return</span><span class="ct-31574c"> </span><span class="ct-7b1902">_context</span><span class="ct-31574c">.</span><span class="ct-25cc3a">New</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">Branch</span><span class="ct-31574c">&gt;().</span><span class="ct-25cc3a">With</span><span class="ct-31574c">(</span><span class="ct-645ff1">this</span><span class="ct-31574c">, </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-7b1902">district</span><span class="ct-31574c">);</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->Therefore, with the above code, you ensured that district is either null or an
existing record in database.<!--]--></p><h2 id="business-services-method-overloads"><!--[-->Method Overloads<!--]--></h2><p><!--[-->Method overloads are considered as one business service in service layer. If
you create method overloads like below, then you will see only one business
service with all of parameters.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">) =&gt; </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-7b1902">district</span><span class="ct-31574c">, </span><span class="ct-645ff1">null</span><span class="ct-31574c">);</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">, </span><span class="ct-466a38">Company</span><span class="ct-31574c"> </span><span class="ct-7b1902">ownerCompany</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        ...</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->If you don&#39;t send an <code><!--[-->ownerCompany<!--]--></code> then the first overload will be called, if
you fulfill all parameters, then the second overload will be called.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Overload selection is automatic, and Gazel will try to pass as many
parameters as it can. Assume that you send <code><!--[-->name<!--]--></code> and <code><!--[-->ownerCompany<!--]--></code> to above
<code><!--[-->AddBranch<!--]--></code> service. Then first overload matches only <code><!--[-->name<!--]--></code> parameter, but
second overload matches both of them. So invocation will be on the second one
and <code><!--[-->district<!--]--></code> parameter will be <code><!--[-->null<!--]--></code>.<!--]--></p><!--]--><!--]--></div></div><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->If return type of overloads are not the same, the first overload will be a
business service, but the second one will be ignored.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-dfabb7">// First overload returns void</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-645ff1">void</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">) { ... }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-dfabb7">// Second overload returns Branch, this will not be a business service.</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">, </span><span class="ct-466a38">Company</span><span class="ct-31574c"> </span><span class="ct-7b1902">ownerCompany</span><span class="ct-31574c">) { ... }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="business-services-optional-parameters"><!--[-->Optional parameters<!--]--></h2><p><!--[-->Gazel supports optional parameters in business services. You can use
optional parameters instead of overloads.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">District</span><span class="ct-31574c"> </span><span class="ct-7b1902">district</span><span class="ct-31574c">,</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-466a38">Company</span><span class="ct-31574c"> </span><span class="ct-7b1902">ownerCompany</span><span class="ct-31574c"> = </span><span class="ct-645ff1">null</span></div><div class="line"><span class="ct-31574c">    )</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        ...</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><h2 id="business-services-list-and-array-parameters-and-return-types"><!--[--><code><!--[-->List<!--]--></code> and <code><!--[-->array<!--]--></code> parameters and return types<!--]--></h2><p><!--[-->You can use <code><!--[-->List<!--]--></code> class for both parameters and return types as long as type
parameter <code><!--[-->T<!--]--></code> for lists is a supported type.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">List</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">Branch</span><span class="ct-31574c">&gt; </span><span class="ct-25cc3a">GetBranches</span><span class="ct-31574c">() { ... }</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">Employee</span><span class="ct-31574c">[] </span><span class="ct-25cc3a">GetEmployees</span><span class="ct-31574c">() { ... }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><h3 id="business-services-no-dictionary-parameters-and-return-types"><!--[-->No <code><!--[-->Dictionary<!--]--></code> parameters and return types<!--]--></h3><p><!--[-->Gazel does not support <code><!--[-->Dictionary<!--]--></code> in business services by design. So any
service with Dictionary parameter or return type will not be exposed as a
business service. The reason behind this design decision is to favor
strongly-typed classes over generic dictionaries.<!--]--></p><h2 id="business-services-data-transfer-objects-dtos"><!--[-->Data Transfer Objects (DTOs)<!--]--></h2><p><!--[-->If you need a type other than persistent class or a primitive for input or
output, then you can make use of DTOs.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-645ff1">void</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranch</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">address</span><span class="ct-31574c">, </span><span class="ct-466a38">City</span><span class="ct-31574c"> </span><span class="ct-7b1902">city</span><span class="ct-31574c">, </span><span class="ct-466a38">Country</span><span class="ct-31574c"> </span><span class="ct-7b1902">country</span><span class="ct-31574c">) { ... }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->Example usage of a DTO with business service;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-645ff1">void</span><span class="ct-31574c"> </span><span class="ct-25cc3a">AddBranches</span><span class="ct-31574c">(</span><span class="ct-466a38">List</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">&gt; </span><span class="ct-7b1902">branches</span><span class="ct-31574c">) { ... }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->By definition DTOs are expected to be only used for data transfer with no
business logic and for this reason Gazel uses <code><!--[-->record<!--]--></code>.<!--]--></p><p><!--[-->You can define a record with using positional syntax. With this syntax,
compiler generates your record as a class with init only public properties and
a public constructor.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(string Name, string Address, City City, Country Country);</span></div></code></pre><!--]--><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Constructor parameters of record DTOs are just like parameters of business
services. You can use<!--]--></p><ul><!--[--><li><!--[-->primitives and other value types,<!--]--></li><li><!--[-->persistent classes,<!--]--></li><li><!--[-->other DTOs
as parameters of constructor.<!--]--></li><!--]--></ul><!--]--><!--]--></div></div><p><!--[-->You can use constructor overloads if you need some construction logic or
validation when creating your DTOs.<!--]--></p><p><!--[-->Example usage of a record with a constructor overloads.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(string Name, string Address, City City, Country Country)</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-466a38">Geoloc</span><span class="ct-31574c"> </span><span class="ct-7b1902">Location</span><span class="ct-31574c"> { </span><span class="ct-645ff1">get</span><span class="ct-31574c">; </span><span class="ct-645ff1">init</span><span class="ct-31574c">; }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-25cc3a">BranchInfo</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-466a38">Geoloc</span><span class="ct-31574c"> </span><span class="ct-7b1902">location</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">        : </span><span class="ct-645ff1">this</span><span class="ct-31574c">(</span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-7b1902">default</span><span class="ct-31574c">, </span><span class="ct-7b1902">default</span><span class="ct-31574c">, </span><span class="ct-7b1902">default</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">Location</span><span class="ct-31574c"> = </span><span class="ct-7b1902">location</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->You can use optional or calculated properties in records, without adding a constructor overload.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(string Name, City City, Country Country, string Address = default)</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">FullAddress</span><span class="ct-31574c"> =&gt; </span><span class="ct-023dd5">$&quot;{</span><span class="ct-7b1902">Name</span><span class="ct-023dd5">} - {</span><span class="ct-7b1902">Address</span><span class="ct-023dd5">} {</span><span class="ct-7b1902">City</span><span class="ct-023dd5">} {</span><span class="ct-7b1902">Country</span><span class="ct-023dd5">}&quot;</span><span class="ct-31574c">;</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    ....</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->If you need to keep some properties or methods only for internal business
logic, you can use <code><!--[-->internal<!--]--></code> access modifier or <code><!--[-->[Internal]<!--]--></code> attribute.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(string Name, [property: </span><span class="ct-466a38">Internal</span><span class="ct-31574c">] </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-466a38">Address</span><span class="ct-31574c">,...)</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-dfabb7">// this constructor will not be rendered in client APIs,</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-dfabb7">// it will only be available for your business services</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">internal</span><span class="ct-31574c"> </span><span class="ct-25cc3a">BranchInfo</span><span class="ct-31574c">(</span><span class="ct-466a38">Branch</span><span class="ct-31574c"> </span><span class="ct-7b1902">branch</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">        : </span><span class="ct-645ff1">this</span><span class="ct-31574c">(</span><span class="ct-7b1902">branch</span><span class="ct-31574c">.</span><span class="ct-7b1902">Name</span><span class="ct-31574c">, </span><span class="ct-7b1902">branch</span><span class="ct-31574c">.</span><span class="ct-7b1902">Address</span><span class="ct-31574c">, </span><span class="ct-7b1902">branch</span><span class="ct-31574c">.</span><span class="ct-7b1902">City</span><span class="ct-31574c">, </span><span class="ct-7b1902">branch</span><span class="ct-31574c">.</span><span class="ct-7b1902">Country</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">    { }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">FullAddress</span><span class="ct-31574c"> =&gt; </span><span class="ct-023dd5">$&quot;{</span><span class="ct-7b1902">Name</span><span class="ct-023dd5">} - {</span><span class="ct-7b1902">Address</span><span class="ct-023dd5">} {</span><span class="ct-7b1902">City</span><span class="ct-023dd5">} {</span><span class="ct-7b1902">Country</span><span class="ct-023dd5">}&quot;</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><p><!--[-->Example usage of record with internal constructor with business service;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">Company</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">virtual</span><span class="ct-31574c"> </span><span class="ct-466a38">List</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">&gt; </span><span class="ct-25cc3a">GetBranches</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-199bf8">return</span><span class="ct-31574c"> </span><span class="ct-7b1902">_context</span></div><div class="line"><span class="ct-31574c">            .</span><span class="ct-25cc3a">Query</span><span class="ct-31574c">&lt;</span><span class="ct-466a38">Branches</span><span class="ct-31574c">&gt;()</span></div><div class="line"><span class="ct-31574c">            .</span><span class="ct-25cc3a">ByCompany</span><span class="ct-31574c">(</span><span class="ct-645ff1">this</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">            .</span><span class="ct-25cc3a">Select</span><span class="ct-31574c">(</span><span class="ct-7b1902">b</span><span class="ct-31574c"> =&gt; </span><span class="ct-645ff1">new</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(</span><span class="ct-7b1902">b</span><span class="ct-31574c">))</span></div><div class="line"><span class="ct-31574c">            .</span><span class="ct-25cc3a">ToList</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">        ;</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">    ...</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><h3 id="business-services-legacy"><!--[-->Legacy<!--]--></h3><p><!--[--><code><!--[-->struct<!--]--></code> DTOs are currently supported as legacy for backward compatibility
and may not be available on future releases. We recommend you to use
<code><!--[-->record<!--]--></code> over <code><!--[-->struct<!--]--></code> in your new projects.<!--]--></p><p><!--[-->Below is a struct implementation of <em><!--[-->BranchInfo<!--]--></em> record.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span><span class="ct-31574c">(string Name, string Address, City City, Country Country);</span></div></code></pre><!--]--><!--[--><pre><code><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">struct</span><span class="ct-31574c"> </span><span class="ct-466a38">BranchInfo</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">Name</span><span class="ct-31574c"> { </span><span class="ct-645ff1">get</span><span class="ct-31574c">; </span><span class="ct-645ff1">private</span><span class="ct-31574c"> </span><span class="ct-645ff1">set</span><span class="ct-31574c">; }</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">Address</span><span class="ct-31574c"> { </span><span class="ct-645ff1">get</span><span class="ct-31574c">; </span><span class="ct-645ff1">private</span><span class="ct-31574c"> </span><span class="ct-645ff1">set</span><span class="ct-31574c">; }</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-466a38">City</span><span class="ct-31574c"> </span><span class="ct-7b1902">City</span><span class="ct-31574c"> { </span><span class="ct-645ff1">get</span><span class="ct-31574c">; </span><span class="ct-645ff1">private</span><span class="ct-31574c"> </span><span class="ct-645ff1">set</span><span class="ct-31574c">; }</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-466a38">Country</span><span class="ct-31574c"> </span><span class="ct-7b1902">Country</span><span class="ct-31574c"> { </span><span class="ct-645ff1">get</span><span class="ct-31574c">; </span><span class="ct-645ff1">private</span><span class="ct-31574c"> </span><span class="ct-645ff1">set</span><span class="ct-31574c">; }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-25cc3a">BranchInfo</span><span class="ct-31574c">(</span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">name</span><span class="ct-31574c">, </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-7b1902">address</span><span class="ct-31574c">, </span><span class="ct-466a38">City</span><span class="ct-31574c"> </span><span class="ct-7b1902">city</span><span class="ct-31574c">, </span><span class="ct-466a38">Country</span><span class="ct-31574c"> </span><span class="ct-7b1902">country</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">        : </span><span class="ct-645ff1">this</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">Name</span><span class="ct-31574c"> = </span><span class="ct-7b1902">name</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">Address</span><span class="ct-31574c"> = </span><span class="ct-7b1902">address</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">City</span><span class="ct-31574c"> = </span><span class="ct-7b1902">city</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">Country</span><span class="ct-31574c"> = </span><span class="ct-7b1902">country</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">}</span></div></code></pre><!--]--><h2 id="business-services-hiding-public-methods-and-properties"><!--[-->Hiding Public Methods and Properties<!--]--></h2><p><!--[-->In some cases you might need to have a public method, but you might not want it
to be exposed as a business service. In this kind of cases, you can mark a
business service by adding an <code><!--[-->Internal<!--]--></code> attribute on top of a <code><!--[-->class<!--]--></code>,
<code><!--[-->constructor<!--]--></code>, <code><!--[-->method<!--]--></code> or <code><!--[-->property<!--]--></code> like below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-31574c">[</span><span class="ct-466a38">Internal</span><span class="ct-31574c">]</span></div><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">InternalManager</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicData</span><span class="ct-31574c"> </span><span class="ct-25cc3a">ShouldNotBeRegisteredAsAService</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-199bf8">return</span><span class="ct-31574c"> </span><span class="ct-645ff1">new</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicData</span><span class="ct-31574c">(</span><span class="ct-023dd5">&quot;public internal&quot;</span><span class="ct-31574c">, </span><span class="ct-023dd5">&quot;public&quot;</span><span class="ct-31574c">);</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">}</span></div><div class="line"></div><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">class</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicManager</span></div><div class="line"><span class="ct-31574c">{</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">private</span><span class="ct-31574c"> </span><span class="ct-645ff1">readonly</span><span class="ct-31574c"> </span><span class="ct-466a38">InternalManager</span><span class="ct-31574c"> </span><span class="ct-7b1902">_internalManager</span><span class="ct-31574c">;</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-25cc3a">PublicManager</span><span class="ct-31574c">(</span><span class="ct-466a38">InternalManager</span><span class="ct-31574c"> </span><span class="ct-7b1902">internalManager</span><span class="ct-31574c">)</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-7b1902">_internalManager</span><span class="ct-31574c"> = </span><span class="ct-7b1902">internalManager</span><span class="ct-31574c">;</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicData</span><span class="ct-31574c"> </span><span class="ct-25cc3a">PublicService</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">        </span><span class="ct-199bf8">return</span><span class="ct-31574c"> </span><span class="ct-7b1902">_internalManager</span><span class="ct-31574c">.</span><span class="ct-25cc3a">ShouldNotBeRegisteredAsAService</span><span class="ct-31574c">();</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"></div><div class="line"><span class="ct-31574c">    [</span><span class="ct-466a38">Internal</span><span class="ct-31574c">]</span></div><div class="line"><span class="ct-31574c">    </span><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">void</span><span class="ct-31574c"> </span><span class="ct-25cc3a">InternalService</span><span class="ct-31574c">()</span></div><div class="line"><span class="ct-31574c">    {</span></div><div class="line"><span class="ct-31574c">    }</span></div><div class="line"><span class="ct-31574c">}</span></div><div class="line"></div><div class="line"><span class="ct-645ff1">public</span><span class="ct-31574c"> </span><span class="ct-645ff1">record</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicData</span><span class="ct-31574c">([property: </span><span class="ct-466a38">Internal</span><span class="ct-31574c">] </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-466a38">InternalProperty</span><span class="ct-31574c">, </span><span class="ct-645ff1">string</span><span class="ct-31574c"> </span><span class="ct-466a38">PublicProperty</span><span class="ct-31574c">);</span></div></code></pre><!--]--><p><!--[-->For the above example;<!--]--></p><ul><!--[--><li><!--[--><code><!--[-->InternalManager<!--]--></code> class and all of its members will be hidden in service
layer.<!--]--></li><li><!--[--><code><!--[-->PublicManager.InternalService<!--]--></code> method will be hidden in service layer.<!--]--></li><li><!--[-->For <code><!--[-->PublicData<!--]--></code> class;<ul><!--[--><li><!--[-->The constructor will be hidden,<!--]--></li><li><!--[--><code><!--[-->InternalProperty<!--]--></code> will be hidden,<!--]--></li><li><!--[-->But <code><!--[-->PublicProperty<!--]--></code> will be available in service layer<!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><p><!--[-->You can think of this attribute as an additional access modifier to <code><!--[-->public<!--]--></code>,
<code><!--[-->private<!--]--></code>, <code><!--[-->internal<!--]--></code>, <code><!--[-->protected<!--]--></code> and <code><!--[-->protected internal<!--]--></code> access modifier
which we sometimes refer as <code><!--[-->public internal<!--]--></code>.<!--]--></p><style>.ct-023dd5{color:#CE9178}
.ct-dfabb7{color:#6A9955}
.ct-7b1902{color:#9CDCFE}
.ct-199bf8{color:#C586C0}
.ct-25cc3a{color:#DCDCAA}
.ct-466a38{color:#4EC9B0}
.ct-31574c{color:#D4D4D4}
.ct-645ff1{color:#569CD6}</style></div></section><section id="data-persistence"><div><h1 id="data-persistence"><!--[-->Data Persistence<!--]--></h1><p><!--[-->Gazel configures <a href="https://nhibernate.info" rel="nofollow" target="_blank"><!--[-->NHibernate<!--]--> <i class="fa-solid fa-arrow-up-right-from-square"></i></a> with the help of <a href="https://github.com/nhibernate/fluent-nhibernate" rel="nofollow" target="_blank"><!--[-->Fluent NHibernate<!--]--> <i class="fa-solid fa-arrow-up-right-from-square"></i></a> to
provide a data persistence layer.<!--]--></p><h2 id="data-persistence-persistent-class-conventions"><!--[-->Persistent Class Conventions<!--]--></h2><p><!--[-->An object is <code><!--[-->Persistent<!--]--></code> if its class injects its own repository. This
convention ensures that there is only one class to deal with one table in the
database.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">private</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">readonly</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">IRepository</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed">&gt; </span><span class="ct-feb479">_repository</span><span class="ct-ade5ed">;</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">Company</span><span class="ct-ade5ed">() { }</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">Company</span><span class="ct-ade5ed">(</span><span class="ct-bcfb4c">IRepository</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed">&gt; </span><span class="ct-feb479">repository</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_repository</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">repository</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><p><!--[-->This injection tells Gazel to configure this class to be a persistent class
which means that there will be an ORM configuration for this class.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[--><code><!--[-->protected Task() { }<!--]--></code> constructor is there for NHibernate to be able to
create proxies on persistent classes for lazy loading.<!--]--></p><!--]--><!--]--></div></div><h3 id="data-persistence-query-classes"><!--[-->Query classes<!--]--></h3><p><!--[-->When you have a persistent class, this means that you will need to read
persistent objects from corresponding database table. That&#39;s why Gazel requires
you to create a query class for every persistent class.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div><div class="line"></div><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Companies</span><span class="ct-ade5ed"> : </span><span class="ct-bcfb4c">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed">&gt;</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->It&#39;s better to put persistent and query classes of a table into one source
file.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->In this document we will explain persistent classes rather than query classes.
You can find detailed explanation for queries in <a href="/features#queries" class=""><!--[-->this
page<!--]--> <!----></a>.<!--]--></p><h3 id="data-persistence-id-property"><!--[-->Id property<!--]--></h3><p><!--[-->Every persistent class should have an identifier property of type <code><!--[-->int<!--]--></code> and of
name <code><!--[-->Id<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">int</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Id</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><p><!--[-->This property will be used by NHibernate to be the primary key and first level
caching.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Id properties are automatically configured to be an identity column which
means that database is responsible for assigning Id values.<!--]--></p><!--]--><!--]--></div></div><h3 id="data-persistence-virtual-keyword"><!--[--><code><!--[-->virtual<!--]--></code> keyword<!--]--></h3><p><!--[-->Every member in persistent classes (methods and properties) should be <code><!--[-->virtual<!--]--></code>
in order NHibernate to be able to create proxies for lazy loading.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">int</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Id</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Name</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Address</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><div class="alert alert-danger row"><div class="alert-message col"><i class="fa-solid fa-circle-xmark"></i></div><div class="col"><!--[--><!--[--><p><!--[-->In persistent classes <code><!--[-->private<!--]--></code> access modifier causes null reference
exceptions. Use <code><!--[-->protected virtual<!--]--></code> instead of <code><!--[-->private<!--]--></code> to workaround this
problem.<!--]--></p><!--]--><!--]--></div></div><h3 id="data-persistence-protected-setters"><!--[--><code><!--[-->protected<!--]--></code> setters<!--]--></h3><p><!--[-->We encourage you to use protected setters so that you can make sure that no
other class than the class itself is able to modify the values of its
properties.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->It could be <code><!--[-->private<!--]--></code> setters but NHibernate wouldn&#39;t be able to create
proxies for lazy loading.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->For a more detailed explanation please have a look at <a href="/tutorial#database-transactions" class=""><!--[-->this tutorial
page<!--]--> <!----></a>.<!--]--></p><h2 id="data-persistence-inserting-a-new-record"><!--[-->Inserting a New Record<!--]--></h2><p><!--[-->There is an <code><!--[-->Insert<!--]--></code> method in <code><!--[-->IRepository&lt;T&gt;<!--]--></code> which does what it says. The
convention for insert operations is as follows;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">internal</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">With</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">name</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">address</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Name</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">name</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Address</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">address</span><span class="ct-ade5ed">;</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_repository</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Insert</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">this</span><span class="ct-ade5ed">);</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-da6d2e">return</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">this</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><p><!--[--><code><!--[-->With<!--]--></code> methods are part of the creation of a persistent object. We use builder
pattern for this operation. For a more detailed explanation about <code><!--[-->With<!--]--></code>
methods please have a look at <a href="/tutorial#persistent-classes" class=""><!--[-->this tutorial
page<!--]--> <!----></a>.<!--]--></p><p><!--[--><code><!--[-->With<!--]--></code> methods are;<!--]--></p><ul><!--[--><li><!--[--><code><!--[-->protected<!--]--></code> and <code><!--[-->virtual<!--]--></code> because of NHibernate&#39;s lazy loading requirements,<!--]--></li><li><!--[--><code><!--[-->internal<!--]--></code> to be able to use from other classes in its module.<!--]--></li><!--]--></ul><p><!--[-->Below you can see an example of an insert operation;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">CompanyManager</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">CreateCompany</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">name</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">address</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">New</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">With</span><span class="ct-ade5ed">(</span><span class="ct-feb479">name</span><span class="ct-ade5ed">, </span><span class="ct-feb479">address</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><h2 id="data-persistence-updating-a-record"><!--[-->Updating a Record<!--]--></h2><p><!--[-->When a persistent object is loaded, its state is managed by NHibernate. This
feature of NHibernate enables services to  automatically update a record upon
commit.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">Update</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">name</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">address</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Name</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">name</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Address</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">address</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><p><!--[-->Above method is enough for the <code><!--[-->Company<!--]--></code> object to update itself. At this point
object is marked as dirty by NHibernate. Whenever NHibernate session is
flushed, an update statement will be executed in the database. There are 3
reasons for NHibernate session to be flushed;<!--]--></p><ol><!--[--><li><!--[-->When current transaction is committed NHibernate flushes current session,
hence record gets updated.<!--]--></li><li><!--[-->When a select query is sent to <code><!--[-->Company<!--]--></code> table, either directly or via table
joins.<!--]--></li><li><!--[-->You make an explicit call to <code><!--[-->IRepository&lt;T&gt;.Flush()<!--]--></code> which calls
NHibernate&#39;s session flush directly.<!--]--></li><!--]--></ol><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[--><code><!--[-->IRepository&lt;T&gt;.Flush()<!--]--></code> causes all dirty objects to be flushed, not just the
persistent object it is called, nor instances of <code><!--[-->&lt;T&gt;<!--]--></code>. This is how
NHibernate implements session flush.<!--]--></p><!--]--><!--]--></div></div><h3 id="data-persistence-batch-updates"><!--[-->Batch Updates<!--]--></h3><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">bool</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Active</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">Deactivate</span><span class="ct-ade5ed">()</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Active</span><span class="ct-ade5ed"> = </span><span class="ct-2bb847">false</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">}</span></div><div class="line"></div><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">CompanyManager</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">DeactivateCompanies</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">name</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-da6d2e">foreach</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">var</span><span class="ct-ade5ed"> </span><span class="ct-feb479">company</span><span class="ct-ade5ed"> </span><span class="ct-da6d2e">in</span><span class="ct-ade5ed"> </span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Companies</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">ByName</span><span class="ct-ade5ed">(</span><span class="ct-feb479">name</span><span class="ct-ade5ed">))</span></div><div class="line"><span class="ct-ade5ed">        {</span></div><div class="line"><span class="ct-ade5ed">            </span><span class="ct-feb479">company</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Deactivate</span><span class="ct-ade5ed">();</span></div><div class="line"><span class="ct-ade5ed">        }</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><p><!--[--><code><!--[-->DeactivateCompanies<!--]--></code> method iterates through a list of <code><!--[-->Company<!--]--></code> objects.
Changing a property value does not cause an immediate update. Upon NHibernate
session flush, above updates will be executed as batch.<!--]--></p><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->If you execute a query to <code><!--[-->Company<!--]--></code> table inside <code><!--[-->Deactivate<!--]--></code> method, this
will cause NHibernate to flush on every iteration and cause an update
execution one by one. This can create a performance flaw in your code. If you
need to check something before such an update (e.g. checking if new username
exists before updating it), and if you want the operation to be a batch
update, then you need to optimize your query accordingly. For &quot;unique
username&quot; example, you might consider checking uniqueness at once.<!--]--></p><!--]--><!--]--></div></div><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">User</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">bool</span><span class="ct-ade5ed"> </span><span class="ct-feb479">Username</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">ChangeUsername</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">username</span><span class="ct-ade5ed">) { </span><span class="ct-0a2742">ChangeUsername</span><span class="ct-ade5ed">(</span><span class="ct-feb479">username</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">false</span><span class="ct-ade5ed">); }</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">internal</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">ChangeUsername</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">username</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">bool</span><span class="ct-ade5ed"> </span><span class="ct-feb479">batch</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-da6d2e">if</span><span class="ct-ade5ed">(!</span><span class="ct-feb479">batch</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">        {</span></div><div class="line"><span class="ct-ade5ed">            </span><span class="ct-da6d2e">if</span><span class="ct-ade5ed">(</span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Users</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">CountByUsername</span><span class="ct-ade5ed">(</span><span class="ct-feb479">username</span><span class="ct-ade5ed">) &gt; </span><span class="ct-31ba6f">0</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">            {</span></div><div class="line"><span class="ct-ade5ed">                </span><span class="ct-da6d2e">throw</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">new</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">ArgumentException</span><span class="ct-ade5ed">(</span><span class="ct-340a23">&quot;username&quot;</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">            }</span></div><div class="line"><span class="ct-ade5ed">        }</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">Username</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">username</span><span class="ct-ade5ed">;</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div><div class="line"></div><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">UserManager</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">ChangeUsernames</span><span class="ct-ade5ed">(</span><span class="ct-bcfb4c">List</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">UsernameChange</span><span class="ct-ade5ed">&gt; </span><span class="ct-feb479">changes</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-da6d2e">if</span><span class="ct-ade5ed">(</span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Users</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">CountByUsernames</span><span class="ct-ade5ed">(</span><span class="ct-feb479">changes</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Select</span><span class="ct-ade5ed">(</span><span class="ct-feb479">c</span><span class="ct-ade5ed"> =&gt; </span><span class="ct-feb479">c</span><span class="ct-ade5ed">.</span><span class="ct-feb479">To</span><span class="ct-ade5ed">)) &gt; </span><span class="ct-31ba6f">0</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">        {</span></div><div class="line"><span class="ct-ade5ed">            </span><span class="ct-da6d2e">throw</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">new</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">ArgumentException</span><span class="ct-ade5ed">(</span><span class="ct-340a23">&quot;changes&quot;</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">        }</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-2bb847">var</span><span class="ct-ade5ed"> </span><span class="ct-feb479">users</span><span class="ct-ade5ed"> = </span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Users</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">ByUsernames</span><span class="ct-ade5ed">(</span><span class="ct-feb479">changes</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Select</span><span class="ct-ade5ed">(</span><span class="ct-feb479">c</span><span class="ct-ade5ed"> =&gt; </span><span class="ct-feb479">c</span><span class="ct-ade5ed">.</span><span class="ct-feb479">From</span><span class="ct-ade5ed">));</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-da6d2e">foreach</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">var</span><span class="ct-ade5ed"> </span><span class="ct-feb479">user</span><span class="ct-ade5ed"> </span><span class="ct-da6d2e">in</span><span class="ct-ade5ed"> </span><span class="ct-feb479">users</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">        {</span></div><div class="line"><span class="ct-ade5ed">            </span><span class="ct-feb479">users</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">ChangeUsername</span><span class="ct-ade5ed">(</span><span class="ct-feb479">change</span><span class="ct-ade5ed">.</span><span class="ct-feb479">To</span><span class="ct-ade5ed">, </span><span class="ct-2bb847">true</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">        }</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><h3 id="data-persistence-force-update"><!--[-->Force Update<!--]--></h3><p><!--[-->If a persistent class implements <code><!--[-->IAuditable<!--]--></code>, this means that with every
update to objects of that class, Gazel will automatically update values of
<code><!--[-->AuditInfo<!--]--></code> properties. A force update is handy when you only want to update
<code><!--[-->AuditInfo<!--]--></code> properties (e.g. <code><!--[-->ModifyDate<!--]--></code>). You can force an object to be
updated using <code><!--[-->ForceUpdate<!--]--></code> method of <code><!--[-->IRepository&lt;T&gt;<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed"> : </span><span class="ct-bcfb4c">IAuditable</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">AuditInfo</span><span class="ct-ade5ed"> </span><span class="ct-feb479">AuditInfo</span><span class="ct-ade5ed"> { </span><span class="ct-2bb847">get</span><span class="ct-ade5ed">; </span><span class="ct-2bb847">protected</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">set</span><span class="ct-ade5ed">; }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">AddEmployee</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">string</span><span class="ct-ade5ed"> </span><span class="ct-feb479">name</span><span class="ct-ade5ed">)</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_context</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">New</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Employee</span><span class="ct-ade5ed">&gt;().</span><span class="ct-0a2742">With</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">this</span><span class="ct-ade5ed">, </span><span class="ct-feb479">name</span><span class="ct-ade5ed">);</span></div><div class="line"></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_repository</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">ForceUpdate</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">this</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div><div class="line"></div><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Companies</span><span class="ct-ade5ed"> : </span><span class="ct-bcfb4c">Query</span><span class="ct-ade5ed">&lt;</span><span class="ct-bcfb4c">Company</span><span class="ct-ade5ed">&gt; { ... }</span></div></code></pre><!--]--><p><!--[-->In the above example, we want a company record to be updated whenever an
employee is added to it. Since adding an employee does not cause an update to a
company record, we force company objects to be updated upon adding an employee.
This <code><!--[-->ForceUpdate<!--]--></code> call will cause a company object&#39;s <code><!--[-->AuditInfo.ModifyDate<!--]--></code>
column to be refreshed with <code><!--[-->AddEmployee<!--]--></code> operation.<!--]--></p><div class="alert alert-danger row"><div class="alert-message col"><i class="fa-solid fa-circle-xmark"></i></div><div class="col"><!--[--><!--[--><p><!--[-->If given persistent class does not implement <code><!--[-->IAuditable<!--]--></code> interface, an
<code><!--[-->InvalidOperationException<!--]--></code> will be thrown.<!--]--></p><!--]--><!--]--></div></div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->If a persistent object is already dirty and forced to be updated, there will
be only one <code><!--[-->UPDATE<!--]--></code> statement to update changes to database.<!--]--></p><!--]--><!--]--></div></div><h2 id="data-persistence-deleting-a-record"><!--[-->Deleting a Record<!--]--></h2><p><!--[-->Deleting is done by <code><!--[-->Delete<!--]--></code> method in <code><!--[-->IRepository&lt;T&gt;<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">class</span><span class="ct-ade5ed"> </span><span class="ct-bcfb4c">Company</span></div><div class="line"><span class="ct-ade5ed">{</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">    </span><span class="ct-2bb847">public</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">virtual</span><span class="ct-ade5ed"> </span><span class="ct-2bb847">void</span><span class="ct-ade5ed"> </span><span class="ct-0a2742">Delete</span><span class="ct-ade5ed">()</span></div><div class="line"><span class="ct-ade5ed">    {</span></div><div class="line"><span class="ct-ade5ed">        </span><span class="ct-feb479">_repository</span><span class="ct-ade5ed">.</span><span class="ct-0a2742">Delete</span><span class="ct-ade5ed">(</span><span class="ct-2bb847">this</span><span class="ct-ade5ed">);</span></div><div class="line"><span class="ct-ade5ed">    }</span></div><div class="line"><span class="ct-ade5ed">    ...</span></div><div class="line"><span class="ct-ade5ed">}</span></div></code></pre><!--]--><h3 id="data-persistence-batch-deletes"><!--[-->Batch Deletes<!--]--></h3><p><!--[-->Behaviour of delete operations are similar to update operations. If you do it
like above, delete statements will be executed when NHibernate session is
flushed. If you execute a query before deleting, this would prevent NHibernate
from performing a batch operation. For detailed explanation have a look at
<em><!--[-->Batch Updates<!--]--></em> section above in this document.<!--]--></p><style>.ct-340a23{color:#CE9178}
.ct-31ba6f{color:#B5CEA8}
.ct-da6d2e{color:#C586C0}
.ct-0a2742{color:#DCDCAA}
.ct-feb479{color:#9CDCFE}
.ct-bcfb4c{color:#4EC9B0}
.ct-ade5ed{color:#D4D4D4}
.ct-2bb847{color:#569CD6}</style></div></section><section id="relations"><div><h1 id="relations"><!--[-->Relations<!--]--></h1><p><!--[-->Gazel configures NHibernate so that you can define relations intiutively.<!--]--></p><h2 id="relations-many-to-one-relation"><!--[-->Many-to-One Relation<!--]--></h2><p><!--[-->This relation is the most used type among all and the simplest one.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Company</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">int</span><span class="ct-d87375"> </span><span class="ct-f247e4">Id</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">Name</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Employee</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">int</span><span class="ct-d87375"> </span><span class="ct-f247e4">Id</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-d004f2">Company</span><span class="ct-d87375"> </span><span class="ct-f247e4">Company</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">Name</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><p><!--[-->Above code is enough to set a many-to-one relation between <code><!--[-->Employee<!--]--></code> and
<code><!--[-->Company<!--]--></code> classes. In this example, <code><!--[-->Employee<!--]--></code> table will require a column
named <code><!--[-->CompanyId<!--]--></code> that is mapped to <code><!--[-->Company<!--]--></code> property as a many to one
relation.<!--]--></p><h2 id="relations-one-to-many-relations"><!--[-->One-to-Many Relations<!--]--></h2><p><!--[-->Creating <code><!--[-->List&lt;T&gt;<!--]--></code> properties on persistent classes will NOT cause a
one-to-many relation. To have this relation, simply create a method that
queries child records from the parent record;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Company</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-d004f2">List</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employee</span><span class="ct-d87375">&gt; </span><span class="ct-2d1cfc">GetEmployees</span><span class="ct-d87375">()</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">return</span><span class="ct-d87375"> </span><span class="ct-f247e4">_context</span><span class="ct-d87375">.</span><span class="ct-2d1cfc">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employees</span><span class="ct-d87375">&gt;().</span><span class="ct-2d1cfc">ByCompany</span><span class="ct-d87375">(</span><span class="ct-059950">this</span><span class="ct-d87375">);</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Employees</span><span class="ct-d87375"> : </span><span class="ct-d004f2">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employee</span><span class="ct-d87375">&gt;</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">internal</span><span class="ct-d87375"> </span><span class="ct-d004f2">List</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employee</span><span class="ct-d87375">&gt; </span><span class="ct-2d1cfc">ByCompany</span><span class="ct-d87375">(</span><span class="ct-d004f2">Company</span><span class="ct-d87375"> </span><span class="ct-f247e4">company</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">return</span><span class="ct-d87375"> </span><span class="ct-2d1cfc">By</span><span class="ct-d87375">(</span><span class="ct-f247e4">e</span><span class="ct-d87375"> =&gt; </span><span class="ct-f247e4">e</span><span class="ct-d87375">.</span><span class="ct-f247e4">Company</span><span class="ct-d87375"> == </span><span class="ct-f247e4">company</span><span class="ct-d87375">);</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><h2 id="relations-eager-fetching-and-lazy-loading"><!--[-->Eager-Fetching and Lazy-Loading<!--]--></h2><p><!--[-->Gazel configures NHibernate to eager fetch persistent object with one level.
This means that when you query a list of persistent objects, their parents will
be fetched eagerly using an inner join. But their grandparents will be
lazy-loaded.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Company</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">Name</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Department</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">Name</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-d004f2">Company</span><span class="ct-d87375"> </span><span class="ct-f247e4">Company</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Employee</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">Name</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-d004f2">Department</span><span class="ct-d87375"> </span><span class="ct-f247e4">Department</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><p><!--[-->When you query employees with something like
<code><!--[-->_context.Query&lt;Employees&gt;().ByName(&quot;mike&quot;)<!--]--></code>, the resulting <code><!--[-->Employee<!--]--></code> objects
will have <code><!--[-->Department<!--]--></code> objects eagerly fetched. However, when you try to access
a property of their <code><!--[-->Company<!--]--></code> object (other than Id property), a query will be
executed using that <code><!--[-->Company<!--]--></code> object&#39;s primary key.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">CompanyManager</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">void</span><span class="ct-d87375"> </span><span class="ct-2d1cfc">SomeEmployeeOperation</span><span class="ct-d87375">(</span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">name</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">employees</span><span class="ct-d87375"> = </span><span class="ct-f247e4">_context</span><span class="ct-d87375">.</span><span class="ct-2d1cfc">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employees</span><span class="ct-d87375">&gt;().</span><span class="ct-2d1cfc">ByName</span><span class="ct-d87375">(</span><span class="ct-f247e4">name</span><span class="ct-d87375">);</span></div><div class="line"></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">foreach</span><span class="ct-d87375">(</span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">employee</span><span class="ct-d87375"> </span><span class="ct-2668d9">in</span><span class="ct-d87375"> </span><span class="ct-f247e4">employees</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">        {</span></div><div class="line"><span class="ct-d87375">            </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">departmentName</span><span class="ct-d87375"> = </span><span class="ct-f247e4">employee</span><span class="ct-d87375">.</span><span class="ct-f247e4">Department</span><span class="ct-d87375">.</span><span class="ct-f247e4">Name</span><span class="ct-d87375">; </span><span class="ct-b7a77d">//No query is executed, department is already loaded</span></div><div class="line"><span class="ct-d87375">            </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">companyName</span><span class="ct-d87375"> = </span><span class="ct-f247e4">employee</span><span class="ct-d87375">.</span><span class="ct-f247e4">Department</span><span class="ct-d87375">.</span><span class="ct-f247e4">Company</span><span class="ct-d87375">.</span><span class="ct-f247e4">Name</span><span class="ct-d87375">; </span><span class="ct-b7a77d">//A query is executed to load company object from database</span></div><div class="line"><span class="ct-d87375">        }</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><h3 id="relations-about-n-1-select-problem"><!--[-->About N + 1 select problem<!--]--></h3><p><!--[-->Above code causes N+1 select problem, which can be a performance issue. If you
encounter this problem, you need to consider selecting all grandparents
(<code><!--[-->Company<!--]--></code>) of the children (<code><!--[-->Employee<!--]--></code>) with an additional query so that there
will be only 2 queries in total.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">CompanyManager</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">void</span><span class="ct-d87375"> </span><span class="ct-2d1cfc">SomeEmployeeOperation</span><span class="ct-d87375">(</span><span class="ct-059950">string</span><span class="ct-d87375"> </span><span class="ct-f247e4">name</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">employees</span><span class="ct-d87375"> = </span><span class="ct-f247e4">_context</span><span class="ct-d87375">.</span><span class="ct-2d1cfc">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Employees</span><span class="ct-d87375">&gt;().</span><span class="ct-2d1cfc">ByName</span><span class="ct-d87375">(</span><span class="ct-f247e4">name</span><span class="ct-d87375">);</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">companies</span><span class="ct-d87375"> = </span><span class="ct-f247e4">_context</span><span class="ct-d87375">.</span><span class="ct-2d1cfc">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Companies</span><span class="ct-d87375">&gt;().</span><span class="ct-2d1cfc">ByIds</span><span class="ct-d87375">(</span><span class="ct-f247e4">employees</span><span class="ct-d87375">.</span><span class="ct-2d1cfc">Select</span><span class="ct-d87375">(</span><span class="ct-f247e4">e</span><span class="ct-d87375"> =&gt; </span><span class="ct-f247e4">e</span><span class="ct-d87375">.</span><span class="ct-f247e4">Department</span><span class="ct-d87375">.</span><span class="ct-f247e4">Company</span><span class="ct-d87375">.</span><span class="ct-f247e4">Id</span><span class="ct-d87375">));</span></div><div class="line"></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">foreach</span><span class="ct-d87375">(</span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">employee</span><span class="ct-d87375"> </span><span class="ct-2668d9">in</span><span class="ct-d87375"> </span><span class="ct-f247e4">employees</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">        {</span></div><div class="line"><span class="ct-d87375">            </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">departmentName</span><span class="ct-d87375"> = </span><span class="ct-f247e4">employee</span><span class="ct-d87375">.</span><span class="ct-f247e4">Department</span><span class="ct-d87375">.</span><span class="ct-f247e4">Name</span><span class="ct-d87375">; </span><span class="ct-b7a77d">//No query is executed, department is already loaded</span></div><div class="line"><span class="ct-d87375">            </span><span class="ct-059950">var</span><span class="ct-d87375"> </span><span class="ct-f247e4">companyName</span><span class="ct-d87375"> = </span><span class="ct-f247e4">employee</span><span class="ct-d87375">.</span><span class="ct-f247e4">Department</span><span class="ct-d87375">.</span><span class="ct-f247e4">Company</span><span class="ct-d87375">.</span><span class="ct-f247e4">Name</span><span class="ct-d87375">; </span><span class="ct-b7a77d">//No query is executed, company is already loaded with the second query.</span></div><div class="line"><span class="ct-d87375">        }</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><h2 id="relations-one-to-any-relation"><!--[-->One-to-Any Relation<!--]--></h2><p><!--[-->This relation type enables you to map your properties to interfaces, which we
refer to as <em><!--[-->Interface Mapping<!--]--></em> or <em><!--[-->Polymorphic Mapping<!--]--></em>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Order</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">virtual</span><span class="ct-d87375"> </span><span class="ct-d004f2">ICustomer</span><span class="ct-d87375"> </span><span class="ct-f247e4">Customer</span><span class="ct-d87375"> { </span><span class="ct-059950">get</span><span class="ct-d87375">; </span><span class="ct-059950">protected</span><span class="ct-d87375"> </span><span class="ct-059950">set</span><span class="ct-d87375">; }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><p><!--[-->For NHibernate to map this property to a table it needs two columns;<!--]--></p><ol><!--[--><li><!--[--><code><!--[-->CustomerId<!--]--></code>: The id value of related record, like in a Many-to-One relation,<!--]--></li><li><!--[--><code><!--[-->CustomerType<!--]--></code>: Type of related record.<!--]--></li><!--]--></ol><p><!--[-->NHibernate uses type column to know which table to select. This type
information is retrieved from an enum that corresponds to <code><!--[-->IOrderProcessor<!--]--></code>
interface.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">interface</span><span class="ct-d87375"> </span><span class="ct-d004f2">ICustomer</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">enum</span><span class="ct-d87375"> </span><span class="ct-d004f2">CustomerType</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-f247e4">RealPerson</span><span class="ct-d87375"> = </span><span class="ct-cb78a0">1</span><span class="ct-d87375">,</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-f247e4">LegalEntity</span><span class="ct-d87375"> = </span><span class="ct-cb78a0">2</span></div><div class="line"><span class="ct-d87375">}</span></div><div class="line"></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">RealPerson</span><span class="ct-d87375"> : </span><span class="ct-d004f2">ICustomer</span><span class="ct-d87375"> { ... }</span></div><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">LegalEntity</span><span class="ct-d87375"> : </span><span class="ct-d004f2">ICustomer</span><span class="ct-d87375"> { ... }</span></div></code></pre><!--]--><p><!--[-->Conventions for one-to-any mapping are;<!--]--></p><ul><!--[--><li><!--[-->For an interface named <code><!--[-->I[Name]<!--]--></code> (e.g. <code><!--[-->ICustomer<!--]--></code>)<!--]--></li><li><!--[-->There should be an enum named <code><!--[-->[Name]Type<!--]--></code> (e.g. <code><!--[-->CustomerType<!--]--></code>)<!--]--></li><li><!--[-->Each enum member must be a persistent class and implement <code><!--[-->I[Name]<!--]--></code> interface
(e.g. <code><!--[-->RealPerson<!--]--></code> and <code><!--[-->LegalEntity<!--]--></code>).<!--]--></li><li><!--[-->When <code><!--[-->I[Name]<!--]--></code> is mapped to a persistent class with a property named
<code><!--[-->[Property]<!--]--></code>,<ul><!--[--><li><!--[--><code><!--[-->[Property]Id<!--]--></code> (<code><!--[-->CustomerId<!--]--></code>) column stores the id value of the related
record<!--]--></li><li><!--[--><code><!--[-->[Property]Type<!--]--></code> (<code><!--[-->CustomerType<!--]--></code>) column store enum member values (<code><!--[-->1<!--]--></code> or
<code><!--[-->2<!--]--></code>), not member names (<code><!--[-->RealPerson<!--]--></code> or <code><!--[-->LegalEntity<!--]--></code>)<!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><p><!--[-->In a query method, you can filter by object like this;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Orders</span><span class="ct-d87375"> : </span><span class="ct-d004f2">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Order</span><span class="ct-d87375">&gt;</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">internal</span><span class="ct-d87375"> </span><span class="ct-d004f2">List</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Order</span><span class="ct-d87375">&gt; </span><span class="ct-2d1cfc">ByCustomer</span><span class="ct-d87375">(</span><span class="ct-d004f2">ICustomer</span><span class="ct-d87375"> </span><span class="ct-f247e4">customer</span><span class="ct-d87375">)</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">return</span><span class="ct-d87375"> </span><span class="ct-2d1cfc">By</span><span class="ct-d87375">(</span><span class="ct-f247e4">wa</span><span class="ct-d87375"> =&gt; </span><span class="ct-f247e4">wa</span><span class="ct-d87375">.</span><span class="ct-f247e4">Customer</span><span class="ct-d87375"> == </span><span class="ct-f247e4">customer</span><span class="ct-d87375">); </span><span class="ct-b7a77d">//uses both CustomerId and CustomerType columns</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><p><!--[-->Or you can filter by type like this;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-059950">public</span><span class="ct-d87375"> </span><span class="ct-059950">class</span><span class="ct-d87375"> </span><span class="ct-d004f2">Orders</span><span class="ct-d87375"> : </span><span class="ct-d004f2">Query</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Order</span><span class="ct-d87375">&gt;</span></div><div class="line"><span class="ct-d87375">{</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">    </span><span class="ct-059950">internal</span><span class="ct-d87375"> </span><span class="ct-d004f2">List</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">Order</span><span class="ct-d87375">&gt; </span><span class="ct-2d1cfc">ByCustomerType</span><span class="ct-d87375">&lt;</span><span class="ct-d004f2">T</span><span class="ct-d87375">&gt;() </span><span class="ct-059950">where</span><span class="ct-d87375"> </span><span class="ct-d004f2">T</span><span class="ct-d87375"> : </span><span class="ct-d004f2">ICustomer</span></div><div class="line"><span class="ct-d87375">    {</span></div><div class="line"><span class="ct-d87375">        </span><span class="ct-2668d9">return</span><span class="ct-d87375"> </span><span class="ct-2d1cfc">By</span><span class="ct-d87375">(</span><span class="ct-f247e4">wa</span><span class="ct-d87375"> =&gt; </span><span class="ct-f247e4">wa</span><span class="ct-d87375">.</span><span class="ct-f247e4">Customer</span><span class="ct-d87375"> </span><span class="ct-059950">is</span><span class="ct-d87375"> </span><span class="ct-d004f2">T</span><span class="ct-d87375">); </span><span class="ct-b7a77d">//uses only Customer column</span></div><div class="line"><span class="ct-d87375">    }</span></div><div class="line"><span class="ct-d87375">    ...</span></div><div class="line"><span class="ct-d87375">}</span></div></code></pre><!--]--><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Unfortunately interface mappings cannot be fetched eagerly. So beware of N+1
select problems if you use this feature.<!--]--></p><!--]--><!--]--></div></div><style>.ct-cb78a0{color:#B5CEA8}
.ct-b7a77d{color:#6A9955}
.ct-2668d9{color:#C586C0}
.ct-2d1cfc{color:#DCDCAA}
.ct-f247e4{color:#9CDCFE}
.ct-d004f2{color:#4EC9B0}
.ct-d87375{color:#D4D4D4}
.ct-059950{color:#569CD6}</style></div></section><section id="queries"><div><h1 id="queries"><!--[-->Queries<!--]--></h1><p><!--[-->For persistence classes, there needs to be corresponding query class to read
records from database. This section focuses on how you can organize your
queries in your projects.<!--]--></p><h2 id="queries-query-class-conventions"><!--[-->Query Class Conventions<!--]--></h2><p><!--[-->The main purpose of query classes is to organize all of the queries of a table
together into one place. Query classes are named after their corresponding
persistent class. They are in plural form like below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You can access pluralization service through <code><!--[-->IModuleContext.Pluralizer<!--]--></code>
property.<!--]--></p><!--]--><!--]--></div></div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->If pluralization service does not provide what you want, you can make use of
<code><!--[-->[Name]s<!--]--></code> convention. For instance, there is a persistent class named <code><!--[-->Xyz<!--]--></code>,
when you name its query class as <code><!--[-->Xyzs<!--]--></code>, it will work as well.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->Query classes are singleton by convention and its usage is as follows;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">CompanyManager</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">virtual</span><span class="ct-57b066"> </span><span class="ct-596a8d">void</span><span class="ct-57b066"> </span><span class="ct-83d99f">DeactivateCompanies</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">    {</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-51f17c">foreach</span><span class="ct-57b066">(</span><span class="ct-596a8d">var</span><span class="ct-57b066"> </span><span class="ct-a7288a">company</span><span class="ct-57b066"> </span><span class="ct-51f17c">in</span><span class="ct-57b066"> </span><span class="ct-a7288a">_context</span><span class="ct-57b066">.</span><span class="ct-83d99f">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Companies</span><span class="ct-57b066">&gt;().</span><span class="ct-83d99f">ByName</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">))</span></div><div class="line"><span class="ct-57b066">        {</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">company</span><span class="ct-57b066">.</span><span class="ct-83d99f">Deactivate</span><span class="ct-57b066">();</span></div><div class="line"><span class="ct-57b066">        }</span></div><div class="line"><span class="ct-57b066">    }</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->Query classes are singleton by convention, so you can inject query classes as
well;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">CompanyManager</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">private</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> </span><span class="ct-a7288a">_companies</span><span class="ct-57b066">;</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-83d99f">CompanyManager</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> </span><span class="ct-a7288a">companies</span><span class="ct-57b066">) =&gt; </span><span class="ct-a7288a">_companies</span><span class="ct-57b066"> = </span><span class="ct-a7288a">companies</span><span class="ct-57b066">;</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">virtual</span><span class="ct-57b066"> </span><span class="ct-596a8d">void</span><span class="ct-57b066"> </span><span class="ct-83d99f">DeactivateCompanies</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">    {</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-51f17c">foreach</span><span class="ct-57b066">(</span><span class="ct-596a8d">var</span><span class="ct-57b066"> </span><span class="ct-a7288a">company</span><span class="ct-57b066"> </span><span class="ct-51f17c">in</span><span class="ct-57b066"> </span><span class="ct-a7288a">_companies</span><span class="ct-57b066">.</span><span class="ct-83d99f">ByName</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">))</span></div><div class="line"><span class="ct-57b066">        {</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">company</span><span class="ct-57b066">.</span><span class="ct-83d99f">Deactivate</span><span class="ct-57b066">();</span></div><div class="line"><span class="ct-57b066">        }</span></div><div class="line"><span class="ct-57b066">    }</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->Query classes should extend <code><!--[-->Query&lt;T&gt;<!--]--></code> which is an abstract class with helper
functionalities to make it simple to implement query methods. To provide these
functionalities it requires <code><!--[-->IModuleContext<!--]--></code> to be injected.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-83d99f">Companies</span><span class="ct-57b066">(</span><span class="ct-0b6cea">IModuleContext</span><span class="ct-57b066"> </span><span class="ct-a7288a">context</span><span class="ct-57b066">) : </span><span class="ct-596a8d">base</span><span class="ct-57b066">(</span><span class="ct-a7288a">context</span><span class="ct-57b066">) { }</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->If you want to inject other dependencies, you are free to do it like in any
other class.<!--]--></p><h2 id="queries-by-methods"><!--[-->By Methods<!--]--></h2><p><!--[-->By methods are type of queries that return list of persistent objects.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[--><code><!--[-->By<!--]--></code> method is declared in <code><!--[-->Query&lt;T&gt;<!--]--></code> base class to help you create query
methods quickly.<!--]--></p><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[--><code><!--[-->Query&lt;T&gt;.By<!--]--></code> method accepts an expression that is converted to <code><!--[-->SQL<!--]--></code>. This
expression never runs in your .NET application. Because of this reason you
are not supposed to call methods of persistent classes within these
expressions.  For example; <code><!--[-->By(c =&gt; c.GetEmployees().Count &gt; 0)<!--]--></code> will not
work.<!--]--></p><!--]--><!--]--></div></div><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Do not use <code><!--[-->Id<!--]--></code> properties for filtering;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066">.</span><span class="ct-a7288a">Id</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">.</span><span class="ct-a7288a">Id</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->This will cause a <code><!--[-->NullReferenceException<!--]--></code> when city is <code><!--[-->null<!--]--></code>. Prefer
<code><!--[-->c.City == city<!--]--></code> expression, which will handle both cases in one shot.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->A by method can also be implemented like below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">Lookup</span><span class="ct-57b066">.</span><span class="ct-83d99f">List</span><span class="ct-57b066">(</span><span class="ct-596a8d">true</span><span class="ct-57b066">).</span><span class="ct-83d99f">Where</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">).</span><span class="ct-83d99f">ToList</span><span class="ct-57b066">();</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[--><code><!--[-->Lookup<!--]--></code> property is declared in <code><!--[-->Query&lt;T&gt;<!--]--></code> base class and is of type
<code><!--[-->ILookup&lt;T&gt;<!--]--></code>. This interface acts as a gateway to NHibernate. <code><!--[-->ILookup&lt;T&gt;.List<!--]--></code>
method returns an <code><!--[-->IQueryable&lt;T&gt;<!--]--></code> instance. You may use this instance when <code><!--[-->By<!--]--></code>
method is not enough.<!--]--></p><h3 id="queries-single-parameter-convention"><!--[-->Single Parameter Convention<!--]--></h3><p><!--[-->When there is only one parameter in query methods, we suggest you to include
parameter name in method name like below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transactions</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByFrom</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Account</span><span class="ct-57b066"> </span><span class="ct-a7288a">from</span><span class="ct-57b066">) =&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">From</span><span class="ct-57b066"> == </span><span class="ct-a7288a">from</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->Consider you have two different queries on <code><!--[-->Transaction<!--]--></code> table, first one
filters using <code><!--[-->From<!--]--></code> column, second one filters using <code><!--[-->To<!--]--></code> column;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transactions</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Account</span><span class="ct-57b066"> </span><span class="ct-a7288a">from</span><span class="ct-57b066">) =&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">From</span><span class="ct-57b066"> == </span><span class="ct-a7288a">from</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Account</span><span class="ct-57b066"> </span><span class="ct-a7288a">to</span><span class="ct-57b066">) =&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">To</span><span class="ct-57b066"> == </span><span class="ct-a7288a">to</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->Above code will not compile because there are two methods with exactly the same
signature. To make it compile, you need to rename one of them. We prefer
renaming both to provide consistency in naming;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transactions</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByFrom</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Account</span><span class="ct-57b066"> </span><span class="ct-a7288a">from</span><span class="ct-57b066">) =&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">From</span><span class="ct-57b066"> == </span><span class="ct-a7288a">from</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByTo</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Account</span><span class="ct-57b066"> </span><span class="ct-a7288a">to</span><span class="ct-57b066">) =&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">To</span><span class="ct-57b066"> == </span><span class="ct-a7288a">to</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h3 id="queries-take-and-skip"><!--[-->Take and Skip<!--]--></h3><p><!--[-->You can use <code><!--[-->skip<!--]--></code> and <code><!--[-->take<!--]--></code> extensions methods. They are optional parameters.
<code><!--[-->take<!--]--></code> parameter extracts the first n elements from the beginning of the target
sequence. Here is how you can do it;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">take</span><span class="ct-57b066">: </span><span class="ct-a7288a">take</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">take</span><span class="ct-57b066">: </span><span class="ct-a7288a">take</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->The <code><!--[-->skip<!--]--></code> parameter moves pass the first n elements from the beginning of the
target sequence, returning the remainder;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">skip</span><span class="ct-57b066">: </span><span class="ct-a7288a">skip</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">skip</span><span class="ct-57b066">: </span><span class="ct-a7288a">skip</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->You can apply pagination by using <code><!--[-->skip<!--]--></code> and <code><!--[-->take<!--]--></code> optional parameters. Here
is how you can do it;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">skip</span><span class="ct-57b066">: </span><span class="ct-a7288a">skip</span><span class="ct-57b066">, </span><span class="ct-a7288a">take</span><span class="ct-57b066">:</span><span class="ct-a7288a">take</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">skip</span><span class="ct-57b066">: </span><span class="ct-a7288a">skip</span><span class="ct-57b066">, </span><span class="ct-a7288a">take</span><span class="ct-57b066">:</span><span class="ct-a7288a">take</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->Alternatively, you can also be implemented by using <code><!--[-->ILookup&lt;T&gt;.List<!--]--></code> as shown
below. It actually returns an <code><!--[-->IQueryable&lt;T&gt;<!--]--></code> instance.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">Lookup</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">List</span><span class="ct-57b066">(</span><span class="ct-596a8d">true</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Where</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Take</span><span class="ct-57b066">(</span><span class="ct-a7288a">take</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">ToList</span><span class="ct-57b066">();;</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">Lookup</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">List</span><span class="ct-57b066">(</span><span class="ct-596a8d">true</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Where</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Skip</span><span class="ct-57b066">(</span><span class="ct-a7288a">skip</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">ToList</span><span class="ct-57b066">();;</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">take</span><span class="ct-57b066">, </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">skip</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">Lookup</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">List</span><span class="ct-57b066">(</span><span class="ct-596a8d">true</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Where</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">Contains</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">) &amp;&amp; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">OrderByDescending</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Skip</span><span class="ct-57b066">(</span><span class="ct-a7288a">skip</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">Take</span><span class="ct-57b066">(</span><span class="ct-a7288a">take</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">            .</span><span class="ct-83d99f">ToList</span><span class="ct-57b066">();</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h3 id="queries-orderby-and-orderbydescending"><!--[-->OrderBy and OrderByDescending<!--]--></h3><p><!--[-->You can use <code><!--[-->orderBy<!--]--></code> and <code><!--[-->orderByDescending<!--]--></code> extensions methods. They are
optional parameters.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You can use <code><!--[-->orderBy<!--]--></code> and <code><!--[-->orderByDescending<!--]--></code> parameters in <code><!--[-->By<!--]--></code>, <code><!--[-->All<!--]--></code>,
<code><!--[-->FirstBy<!--]--></code>,  methods.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->The <code><!--[-->orderby<!--]--></code> parameter sorts the elements of a sequence in ascending order
according to a key.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByName</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">orderBy</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">All</span><span class="ct-57b066">() =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-a7288a">orderBy</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">FirstByName</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">FirstBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">orderBy</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->The <code><!--[-->orderByDescending<!--]--></code> parameter sorts the elements of a sequence in
descending order according to a key.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByName</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">orderByDescending</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">All</span><span class="ct-57b066">(</span><span class="ct-a7288a">orderByDescending</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">FirstByName</span><span class="ct-57b066">(</span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">FirstBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">), </span><span class="ct-a7288a">orderByDescending</span><span class="ct-57b066">: </span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h2 id="queries-firstby-and-singleby"><!--[-->FirstBy and SingleBy<!--]--></h2><p><!--[--><code><!--[-->FirstBy<!--]--></code> and <code><!--[-->SingleBy<!--]--></code> methods are like <code><!--[-->By<!--]--></code> methods but they return only one
record. <code><!--[-->FirstBy<!--]--></code> returns the first record matching the given conditions,
whereas <code><!--[-->SingleBy<!--]--></code> throws an exception when there are more than one records
matching the given conditions.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">User</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Users</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">User</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">User</span><span class="ct-57b066"> </span><span class="ct-83d99f">SingleByEmail</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Email</span><span class="ct-57b066"> </span><span class="ct-a7288a">email</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">SingleBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">Email</span><span class="ct-57b066"> == </span><span class="ct-a7288a">email</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">User</span><span class="ct-57b066"> </span><span class="ct-83d99f">FirstByRegistrationDate</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Date</span><span class="ct-57b066"> </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">FirstBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">RegistrationDate</span><span class="ct-57b066"> == </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Single Parameter Convention applies to all query methods. That&#39;s why above
methods are named as <code><!--[-->SingleByEmail<!--]--></code> and <code><!--[-->FirstByRegistrationDate<!--]--></code> instead of
<code><!--[-->SingleBy<!--]--></code> and <code><!--[-->FirstBy<!--]--></code>. When you have more than one parameter you may
exclude parameter name from method name (e.g. <code><!--[-->public User SingleBy(Email email, Password password)<!--]--></code>).<!--]--></p><!--]--><!--]--></div></div><p><!--[--><code><!--[-->SingleBy<!--]--></code> method will return <code><!--[-->null<!--]--></code> when there are no matching records. LINQ
extension methods uses a different convention. <code><!--[-->Single<!--]--></code> methods expects to
return one record, if there are none or more than one they will throw an
exception. <code><!--[-->SingleBy<!--]--></code> methods acts like <code><!--[-->SingleOrDefault<!--]--></code> method.<!--]--></p><h2 id="queries-countby"><!--[-->CountBy<!--]--></h2><p><!--[-->As the name implies, <code><!--[-->CountBy<!--]--></code> methods executes a <code><!--[-->count<!--]--></code> query and returns an
<code><!--[-->int<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">User</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Users</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">User</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-83d99f">CountByRegistrationDate</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Date</span><span class="ct-57b066"> </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">CountBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">RegistrationDate</span><span class="ct-57b066"> == </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-83d99f">CountBy</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Gender</span><span class="ct-57b066"> </span><span class="ct-a7288a">gender</span><span class="ct-57b066">, </span><span class="ct-0b6cea">Date</span><span class="ct-57b066"> </span><span class="ct-a7288a">birthDate</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">CountBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">Gender</span><span class="ct-57b066"> == </span><span class="ct-a7288a">gender</span><span class="ct-57b066"> &amp;&amp; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">BirthDate</span><span class="ct-57b066"> == </span><span class="ct-a7288a">birthDate</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h2 id="queries-anyby"><!--[-->AnyBy<!--]--></h2><p><!--[-->As the name implies, <code><!--[-->AnyBy<!--]--></code> method determines whether all elements of a
sequence satisfy a condition and returns a <code><!--[-->bool<!--]--></code>.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">User</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Users</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">User</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">bool</span><span class="ct-57b066"> </span><span class="ct-83d99f">AnyByRegistrationDate</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Date</span><span class="ct-57b066"> </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">AnyBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">RegistrationDate</span><span class="ct-57b066"> == </span><span class="ct-a7288a">registrationDate</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">bool</span><span class="ct-57b066"> </span><span class="ct-83d99f">AnyBy</span><span class="ct-57b066">(</span><span class="ct-0b6cea">Gender</span><span class="ct-57b066"> </span><span class="ct-a7288a">gender</span><span class="ct-57b066">, </span><span class="ct-0b6cea">Date</span><span class="ct-57b066"> </span><span class="ct-a7288a">birthDate</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">AnyBy</span><span class="ct-57b066">(</span><span class="ct-a7288a">u</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">Gender</span><span class="ct-57b066"> == </span><span class="ct-a7288a">gender</span><span class="ct-57b066"> &amp;&amp; </span><span class="ct-a7288a">u</span><span class="ct-57b066">.</span><span class="ct-a7288a">BirthDate</span><span class="ct-57b066"> == </span><span class="ct-a7288a">birthDate</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h2 id="queries-minby-and-maxby"><!--[-->MinBy and MaxBy<!--]--></h2><p><!--[-->These aggregate functions take two expressions.<!--]--></p><ol><!--[--><li><!--[-->An expression of the property on which aggregate function is applied<!--]--></li><li><!--[-->An expression for where clause<!--]--></li><!--]--></ol><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Transactions</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Transaction</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Money</span><span class="ct-57b066"> </span><span class="ct-83d99f">MinAmountBy</span><span class="ct-57b066">(</span><span class="ct-0b6cea">DateRange</span><span class="ct-57b066"> </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">, </span><span class="ct-0b6cea">CurrencyCode</span><span class="ct-57b066"> </span><span class="ct-a7288a">currency</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">MinBy</span><span class="ct-57b066">(</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-0bbbd1">//Property expression</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">Amount</span><span class="ct-57b066">.</span><span class="ct-a7288a">Value</span><span class="ct-57b066">,</span></div><div class="line"></div><div class="line"><span class="ct-57b066">            </span><span class="ct-0bbbd1">//Where clause expression</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">TransactionDate</span><span class="ct-57b066"> &gt;= </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">.</span><span class="ct-a7288a">Start</span><span class="ct-57b066"> &amp;&amp;</span></div><div class="line"><span class="ct-57b066">                 </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">TransactionDate</span><span class="ct-57b066"> &lt; </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">.</span><span class="ct-a7288a">End</span><span class="ct-57b066"> &amp;&amp;</span></div><div class="line"><span class="ct-57b066">                 </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">Amount</span><span class="ct-57b066">.</span><span class="ct-a7288a">Currency</span><span class="ct-57b066"> == </span><span class="ct-a7288a">currency</span></div><div class="line"><span class="ct-57b066">        ).</span><span class="ct-83d99f">ToMoney</span><span class="ct-57b066">(</span><span class="ct-a7288a">currency</span><span class="ct-57b066">);</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Money</span><span class="ct-57b066"> </span><span class="ct-83d99f">MaxAmountBy</span><span class="ct-57b066">(</span><span class="ct-0b6cea">DateRange</span><span class="ct-57b066"> </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">, </span><span class="ct-0b6cea">CurrencyCode</span><span class="ct-57b066"> </span><span class="ct-a7288a">currency</span><span class="ct-57b066">) =&gt;</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">MaxBy</span><span class="ct-57b066">(</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-0bbbd1">//Property expression</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">Amount</span><span class="ct-57b066">.</span><span class="ct-a7288a">Value</span><span class="ct-57b066">,</span></div><div class="line"></div><div class="line"><span class="ct-57b066">            </span><span class="ct-0bbbd1">//Where clause expression</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-a7288a">t</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">TransactionDate</span><span class="ct-57b066"> &gt;= </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">.</span><span class="ct-a7288a">Start</span><span class="ct-57b066"> &amp;&amp;</span></div><div class="line"><span class="ct-57b066">                 </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">TransactionDate</span><span class="ct-57b066"> &lt; </span><span class="ct-a7288a">transactionDateRange</span><span class="ct-57b066">.</span><span class="ct-a7288a">End</span><span class="ct-57b066"> &amp;&amp;</span></div><div class="line"><span class="ct-57b066">                 </span><span class="ct-a7288a">t</span><span class="ct-57b066">.</span><span class="ct-a7288a">Amount</span><span class="ct-57b066">.</span><span class="ct-a7288a">Currency</span><span class="ct-57b066"> == </span><span class="ct-a7288a">currency</span></div><div class="line"><span class="ct-57b066">        ).</span><span class="ct-83d99f">ToMoney</span><span class="ct-57b066">(</span><span class="ct-a7288a">currency</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><h2 id="queries-optional-where-clauses"><!--[-->Optional Where Clauses<!--]--></h2><p><!--[-->In a query class, if a condition needs to be included in a query depending on
the state of a given parameter, an optional where clause can be created as
shown below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066"> = </span><span class="ct-a7288a">default</span><span class="ct-57b066">, </span><span class="ct-0b6cea">Vkn</span><span class="ct-57b066"> </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066"> = </span><span class="ct-a7288a">default</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-51f17c">return</span><span class="ct-57b066"> </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">,</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">)),</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">TaxNo</span><span class="ct-57b066"> == </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">    );</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->This way you can create reusable query services/methods;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-a7288a">companies</span><span class="ct-57b066">.</span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">city</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-a7288a">companies</span><span class="ct-57b066">.</span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">: </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-a7288a">companies</span><span class="ct-57b066">.</span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-a7288a">name</span><span class="ct-57b066">: </span><span class="ct-a7288a">name</span><span class="ct-57b066">, </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">: </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">);</span></div></code></pre><!--]--><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You can use optional where clauses in <code><!--[-->By<!--]--></code>, <code><!--[-->FirstBy<!--]--></code>, <code><!--[-->SingleBy<!--]--></code>, <code><!--[-->MinBy<!--]--></code>,
<code><!--[-->MaxBy<!--]--></code>, <code><!--[-->CountBy<!--]--></code> methods.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->An optional where clause is built in 3 steps:<!--]--></p><ul><!--[--><li><!--[--><strong><!--[--><code><!--[-->When<!--]--></code><!--]--></strong>: In this step you specify the parameter on which you will check a
condition.<!--]--></li><li><!--[--><strong><!--[--><code><!--[-->Is/Not<!--]--></code><!--]--></strong>: <code><!--[-->Is<!--]--></code> method expects the given condition to be <code><!--[-->true<!--]--></code> while
<code><!--[-->IsNot<!--]--></code> method expects the given condition to be <code><!--[-->false<!--]--></code>.<!--]--></li><li><!--[--><strong><!--[--><code><!--[-->ThenAnd<!--]--></code><!--]--></strong>: This is the final step. In this step you provide the where
clause.<!--]--></li><!--]--></ul><!--[--><pre><code><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">))</span></div></code></pre><!--]--><p><!--[-->Together, in the above statement, you stated that there is an optional filter
which should be included when name is not <code><!--[-->default<!--]--></code>.<!--]--></p><p><!--[-->The alternative, you can also use as named optional parameters. They must be
the last ones in method arguments list.<!--]--></p><p><!--[-->There are available 2 different ways.<!--]--></p><ul><!--[--><li><!--[--><strong><!--[--><code><!--[-->optional<!--]--></code><!--]--></strong>: In this way, you specify the single condition.<!--]--></li><li><!--[--><strong><!--[--><code><!--[-->optionals<!--]--></code><!--]--></strong>: In this way, you specify the multiple conditions.<!--]--></li><!--]--></ul><p><!--[-->You can pass the parameter according to the name, as shown below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-57b066">...</span></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066"> = </span><span class="ct-a7288a">default</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-51f17c">return</span><span class="ct-57b066"> </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">,</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">optional</span><span class="ct-57b066">: </span><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">))</span></div><div class="line"><span class="ct-57b066">    );</span></div><div class="line"><span class="ct-57b066">}</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-0b6cea">City</span><span class="ct-57b066"> </span><span class="ct-a7288a">city</span><span class="ct-57b066">, </span><span class="ct-596a8d">string</span><span class="ct-57b066"> </span><span class="ct-a7288a">name</span><span class="ct-57b066"> = </span><span class="ct-a7288a">default</span><span class="ct-57b066">, </span><span class="ct-0b6cea">Vkn</span><span class="ct-57b066"> </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066"> = </span><span class="ct-a7288a">default</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-51f17c">return</span><span class="ct-57b066"> </span><span class="ct-83d99f">By</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">City</span><span class="ct-57b066"> == </span><span class="ct-a7288a">city</span><span class="ct-57b066">,</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-a7288a">optionals</span><span class="ct-57b066">: </span><span class="ct-596a8d">new</span><span class="ct-57b066">[] {</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">Name</span><span class="ct-57b066">.</span><span class="ct-83d99f">StartsWith</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">)),</span></div><div class="line"><span class="ct-57b066">            </span><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">default</span><span class="ct-57b066">).</span><span class="ct-83d99f">ThenAnd</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066">.</span><span class="ct-a7288a">TaxNo</span><span class="ct-57b066"> == </span><span class="ct-a7288a">taxNo</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">        }</span></div><div class="line"><span class="ct-57b066">    );</span></div><div class="line"><span class="ct-57b066">}</span></div><div class="line"><span class="ct-57b066">...</span></div></code></pre><!--]--><h3 id="queries-how-to-use-is"><!--[-->How to use <code><!--[-->Is<!--]--></code><!--]--></h3><!--[--><pre><code><div class="line"><span class="ct-0bbbd1">//if given name parameter object is expectedName</span></div><div class="line"><span class="ct-0bbbd1">//then the condition will be included in the query.</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">Is</span><span class="ct-57b066">(</span><span class="ct-a7288a">n</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">n</span><span class="ct-57b066"> == </span><span class="ct-a7288a">expectedName</span><span class="ct-57b066">)</span></div><div class="line"></div><div class="line"><span class="ct-0bbbd1">//you can pass an object instead of an expression</span></div><div class="line"><span class="ct-0bbbd1">//which will be equivalent to above code</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">Is</span><span class="ct-57b066">(</span><span class="ct-a7288a">expectedName</span><span class="ct-57b066">)</span></div><div class="line"></div><div class="line"><span class="ct-0bbbd1">//There is a shortcut method that does the same job</span></div><div class="line"><span class="ct-0bbbd1">//that When(name).Is(null) and When(name).Is(default) does</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsDefault</span><span class="ct-57b066">()</span></div></code></pre><!--]--><h3 id="queries-how-to-use-isnot"><!--[-->How to use <code><!--[-->IsNot<!--]--></code><!--]--></h3><!--[--><pre><code><div class="line"><span class="ct-0bbbd1">//if given name parameter object is not excludedName</span></div><div class="line"><span class="ct-0bbbd1">//then the condition will be included in the query.</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">c</span><span class="ct-57b066"> =&gt; </span><span class="ct-a7288a">c</span><span class="ct-57b066"> == </span><span class="ct-a7288a">excludedName</span><span class="ct-57b066">)</span></div><div class="line"></div><div class="line"><span class="ct-0bbbd1">//you can pass an object instead of an expression</span></div><div class="line"><span class="ct-0bbbd1">//which will be equivalent to above code</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNot</span><span class="ct-57b066">(</span><span class="ct-a7288a">excludedName</span><span class="ct-57b066">)</span></div><div class="line"></div><div class="line"><span class="ct-0bbbd1">//There is a shortcut method that does the same job</span></div><div class="line"><span class="ct-0bbbd1">//that When(name).IsNot(null) and When(name).IsNot(default) does</span></div><div class="line"><span class="ct-83d99f">When</span><span class="ct-57b066">(</span><span class="ct-a7288a">name</span><span class="ct-57b066">).</span><span class="ct-83d99f">IsNotDefault</span><span class="ct-57b066">()</span></div></code></pre><!--]--><h2 id="queries-query-base-class"><!--[-->Query Base Class<!--]--></h2><p><!--[--><code><!--[-->Query&lt;T&gt;<!--]--></code> is an abstract class with helper functionalities to make it simple
to create queries. All methods in this class are <code><!--[-->protected<!--]--></code>. If a method
declared in <code><!--[-->Query&lt;T&gt;<!--]--></code> class is to be exposed as a business service, you can
override its access modifiers with <code><!--[-->public new<!--]--></code> keyword.<!--]--></p><h3 id="queries-singlebyid-and-byids"><!--[-->SingleById and ByIds<!--]--></h3><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">abstract</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">T</span><span class="ct-57b066">&gt; : </span><span class="ct-0b6cea">IQuery</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">T</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">protected</span><span class="ct-57b066"> </span><span class="ct-596a8d">virtual</span><span class="ct-57b066"> </span><span class="ct-0b6cea">T</span><span class="ct-57b066"> </span><span class="ct-83d99f">SingleById</span><span class="ct-57b066">(</span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">id</span><span class="ct-57b066">) { ... }</span></div><div class="line"></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">protected</span><span class="ct-57b066"> </span><span class="ct-596a8d">virtual</span><span class="ct-57b066"> </span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">T</span><span class="ct-57b066">&gt; </span><span class="ct-83d99f">ByIds</span><span class="ct-57b066">(</span><span class="ct-0b6cea">List</span><span class="ct-57b066">&lt;</span><span class="ct-596a8d">int</span><span class="ct-57b066">&gt; </span><span class="ct-a7288a">ids</span><span class="ct-57b066">) { ... }</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><p><!--[-->These methods are protected helper methods and are used by Gazel to find a
record by an id or ids. If you want these methods to be available for internal
use, then you can simply do the following;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">internal</span><span class="ct-57b066"> </span><span class="ct-596a8d">new</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> </span><span class="ct-83d99f">SingleById</span><span class="ct-57b066">(</span><span class="ct-596a8d">int</span><span class="ct-57b066"> </span><span class="ct-a7288a">id</span><span class="ct-57b066">)</span></div><div class="line"><span class="ct-57b066">    {</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-51f17c">return</span><span class="ct-57b066"> </span><span class="ct-596a8d">base</span><span class="ct-57b066">.</span><span class="ct-83d99f">SingleById</span><span class="ct-57b066">(</span><span class="ct-a7288a">id</span><span class="ct-57b066">);</span></div><div class="line"><span class="ct-57b066">    }</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[--><code><!--[-->SingleById<!--]--></code> caches the result in request scope, that is, when you make
subsequent calls to <code><!--[-->SingleById<!--]--></code>, only first call will hit database.<!--]--></p><!--]--><!--]--></div></div><h3 id="queries-queryall"><!--[-->Query.All<!--]--></h3><p><!--[-->This method lists all records in corresponding table. This method is
<code><!--[-->protected<!--]--></code> in <code><!--[-->Query&lt;T&gt;<!--]--></code> base class. If you want a persistent class to have an
<code><!--[-->All<!--]--></code> query as a business service do the following;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> { ... }</span></div><div class="line"></div><div class="line"><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">class</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Companies</span><span class="ct-57b066"> : </span><span class="ct-0b6cea">Query</span><span class="ct-57b066">&lt;</span><span class="ct-0b6cea">Company</span><span class="ct-57b066">&gt;</span></div><div class="line"><span class="ct-57b066">{</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">    </span><span class="ct-596a8d">public</span><span class="ct-57b066"> </span><span class="ct-596a8d">new</span><span class="ct-57b066"> </span><span class="ct-0b6cea">Company</span><span class="ct-57b066"> </span><span class="ct-83d99f">All</span><span class="ct-57b066">()</span></div><div class="line"><span class="ct-57b066">    {</span></div><div class="line"><span class="ct-57b066">        </span><span class="ct-51f17c">return</span><span class="ct-57b066"> </span><span class="ct-596a8d">base</span><span class="ct-57b066">.</span><span class="ct-83d99f">All</span><span class="ct-57b066">();</span></div><div class="line"><span class="ct-57b066">    }</span></div><div class="line"><span class="ct-57b066">    ...</span></div><div class="line"><span class="ct-57b066">}</span></div></code></pre><!--]--><style>.ct-0bbbd1{color:#6A9955}
.ct-51f17c{color:#C586C0}
.ct-a7288a{color:#9CDCFE}
.ct-83d99f{color:#DCDCAA}
.ct-0b6cea{color:#4EC9B0}
.ct-57b066{color:#D4D4D4}
.ct-596a8d{color:#569CD6}</style></div></section><section id="transaction-management"><div><h1 id="transaction-management"><!--[-->Transaction Management<!--]--></h1><p><!--[-->Business services always runs in a transaction context. Its either main
transaction or manually created transactions. In this section you can learn how
we deal with database transactions.<!--]--></p><h2 id="transaction-management-using-main-transaction"><!--[-->Using Main Transaction<!--]--></h2><p><!--[-->Before every service call, Gazel creates a database connection and begins a
transaction. If there occurs an exception the transaction is automatically
rolled back. If there are no exceptions than transaction is committed.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">Employee</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">);</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-512d2b">throw</span><span class="ct-dbb55e"> </span><span class="ct-777d02">new</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Exception</span><span class="ct-dbb55e">(); </span><span class="ct-3c3ed8">//Above insert will be rolled back</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><h3 id="transaction-management-how-to-disable-main-transaction"><!--[-->How to Disable Main Transaction<!--]--></h3><p><!--[-->If you want to disable this main transaction behaviour, simply put
<code><!--[-->[ManualTransaction]<!--]--></code> attribute to the service method. This will prevent a
transaction to be opened.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    [</span><span class="ct-a6ae40">ManualTransaction</span><span class="ct-dbb55e">]</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        ...</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->When you use <code><!--[-->[ManualTransaction]<!--]--></code> you are not allowed to use a persistent
object as a parameter because there will be no transaction or connection to
fetch that persistent object.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->Disabling main transaction can help when you need to make an external or
internal API call before you make any database operation. Normally, when you
make an API call, you left a connection and a transaction open and waiting in
an idle state. If your service requires an external call, we suggest you to
disable main transaction and make your external calls without blocking a
connection.<!--]--></p><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Be careful if you implement <code><!--[-->ISession<!--]--></code> and <code><!--[-->IAccount<!--]--></code> interfaces on
persistent classes. You need to check if there is a transaction before
accessing the database. You may use
<code><!--[-->_context.TransactionalFactory.TransactionExists<!--]--></code> or <code><!--[-->_context.WithTransaction<!--]--></code>
when implementing <code><!--[-->ISession.GetSession<!--]--></code>, <code><!--[-->ISession.Validate<!--]--></code> and
<code><!--[-->IAccount.HasAccess<!--]--></code> methods.<!--]--></p><!--]--><!--]--></div></div><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Price</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    [</span><span class="ct-a6ae40">ManualTransaction</span><span class="ct-dbb55e">]</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">async</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">Calculate</span><span class="ct-dbb55e">(</span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-3c3ed8">// no connection is used until unit converter service responds</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-777d02">var</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">result</span><span class="ct-dbb55e"> = </span><span class="ct-777d02">await</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">unitConverterService</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">Convert</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">, </span><span class="ct-29460e">&#39;USD&#39;</span><span class="ct-dbb55e">);</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-3c3ed8">// new transaction is used to log conversion into db</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-777d02">await</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">DoAsync</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">PriceLog</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">result</span><span class="ct-dbb55e">);</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-3c3ed8">// connection is released again</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-512d2b">return</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">result</span><span class="ct-dbb55e">;</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[-->Here we used the <code><!--[-->WithNewTransaction<!--]--></code> method to obtain a new connection and a
transaction within a service. This feature is explained in detail in the
following section.<!--]--></p><h2 id="transaction-management-creating-new-transactions"><!--[-->Creating New Transactions<!--]--></h2><p><!--[-->Most of the time one transaction will be enough for business services. However
there are cases when you will need a record to be updated or inserted and
committed to database.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">Employee</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">);</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-512d2b">throw</span><span class="ct-dbb55e"> </span><span class="ct-777d02">new</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Exception</span><span class="ct-dbb55e">(); </span><span class="ct-3c3ed8">//Above insert will not be rolled back</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[-->In above example <code><!--[-->_context.WithNewTransaction().Do(() =&gt; { ... })<!--]--></code> creates a new
database connection and begins a transaction on this new connection to provide
you with a new transaction context.<!--]--></p><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[-->When an exception occurs in a transaction scope, Gazel catches the exception,
rollbacks the transcation, closes the connection and rethrows the exception.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">Employee</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">);</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-512d2b">throw</span><span class="ct-dbb55e"> </span><span class="ct-777d02">new</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Exception</span><span class="ct-dbb55e">(); </span><span class="ct-3c3ed8">//Above insert will be rolled back</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="transaction-management-using-persistent-objects"><!--[-->Using Persistent Objects<!--]--></h3><p><!--[-->In previous example we used a variable (<code><!--[-->name<!--]--></code>) from outer scope. This is not a
problem when variables are non-persistent objects such as <code><!--[-->string<!--]--></code>, <code><!--[-->int<!--]--></code>, a
manager object or any <code><!--[-->class<!--]--></code> or <code><!--[-->record<!--]--></code> in your modules.<!--]--></p><p><!--[-->Consider you need to pass a persistent object to <code><!--[-->AddEmployee<!--]--></code> method.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">, </span><span class="ct-a6ae40">Branch</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">employeeBranch</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-3c3ed8">//employeeBranch object will cause trouble</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">Employee</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">employeeBranch</span><span class="ct-dbb55e">);</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[-->When you pass a persistent object directly to a new transaction context, this
means that a <code><!--[-->Branch<!--]--></code> instance from outer scope will be assigned to an
<code><!--[-->Employee<!--]--></code> instance from inner scope. This causes an unexpected state for
NHibernate. To assign a persistent object to another persistent object, they
need to be loaded from the same transaction scope and <code><!--[-->ISession<!--]--></code> instance. To
achieve this you need to pass <code><!--[-->Branch<!--]--></code> object with a different way.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Company</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">AddEmployee</span><span class="ct-dbb55e">(</span><span class="ct-777d02">string</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">, </span><span class="ct-a6ae40">Branch</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">employeeBranch</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">employeeBranch</span><span class="ct-dbb55e">).</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">((</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">eb</span><span class="ct-dbb55e">) =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-3c3ed8">//correct way to pass a persistent object to new transaction</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">New</span><span class="ct-dbb55e">&lt;</span><span class="ct-a6ae40">Employee</span><span class="ct-dbb55e">&gt;().</span><span class="ct-c7669f">With</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">name</span><span class="ct-dbb55e">, </span><span class="ct-35cfe4">eb</span><span class="ct-dbb55e">);</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[--><code><!--[-->employeeBranch<!--]--></code> is passed to new transaction scope using
<code><!--[-->_context.WithNewTransaction(employeeBranch).Do(eb =&gt; { ... })<!--]--></code>. When you do
this, Gazel gets the id of given <code><!--[-->employeeBranch<!--]--></code>, loads it in new transaction
scope and passes it as a parameter (<code><!--[-->eb<!--]--></code>).<!--]--></p><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You can pass up to <strong><!--[-->15<!--]--></strong> parameters to <code><!--[-->WithNewTransaction<!--]--></code> method.<!--]--></p><!--]--><!--]--></div></div><h2 id="transaction-management-nested-transactions"><!--[-->Nested Transactions<!--]--></h2><p><!--[-->You can create as many nested transactions as you want like below;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-3c3ed8">//this level uses main transaction</span></div><div class="line"></div><div class="line"><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-3c3ed8">//this level uses first transaction</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-3c3ed8">//this level uses second transaction</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">().</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(() =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-3c3ed8">//this level uses third transaction</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    });</span></div><div class="line"><span class="ct-dbb55e">});</span></div></code></pre><!--]--><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->When you create nested transactions, beware that you are using more than one
database connections at a time.<!--]--></p><!--]--><!--]--></div></div><h2 id="transaction-management-example-update-balance-of-an-account"><!--[-->Example: Update Balance of an Account<!--]--></h2><p><!--[-->Below is an example to demonstrate an update to a balance in an account.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Account</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">Withdraw</span><span class="ct-dbb55e">(</span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">).</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e"> =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">.</span><span class="ct-35cfe4">Balance</span><span class="ct-dbb55e"> -= </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">;</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[-->If you want to lock a record, you can make use of <code><!--[-->IRepository&lt;T&gt;.Lock<!--]--></code> method.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Account</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">Withdraw</span><span class="ct-dbb55e">(</span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">).</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e"> =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-3c3ed8">//use repository of @this object.</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-3c3ed8">//&quot;this._repository&quot; uses outer scope whereas &quot;@this._repository&quot; uses inner scope.</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">.</span><span class="ct-35cfe4">_repository</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">Lock</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">);</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">.</span><span class="ct-35cfe4">Balance</span><span class="ct-dbb55e"> -= </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">;</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><p><!--[-->To make it more readable, lets extract balance operation to another method.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">class</span><span class="ct-dbb55e"> </span><span class="ct-a6ae40">Account</span></div><div class="line"><span class="ct-dbb55e">{</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">public</span><span class="ct-dbb55e"> </span><span class="ct-777d02">virtual</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">Withdraw</span><span class="ct-dbb55e">(</span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_context</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">WithNewTransaction</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">).</span><span class="ct-c7669f">Do</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e"> =&gt; {</span></div><div class="line"><span class="ct-dbb55e">            </span><span class="ct-35cfe4">@this</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">LockAndChangeBalance</span><span class="ct-dbb55e">(</span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">);</span></div><div class="line"><span class="ct-dbb55e">        });</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">    </span><span class="ct-777d02">private</span><span class="ct-dbb55e"> </span><span class="ct-777d02">void</span><span class="ct-dbb55e"> </span><span class="ct-c7669f">LockAndChangeBalance</span><span class="ct-dbb55e">(</span><span class="ct-a6ae40">Money</span><span class="ct-dbb55e"> </span><span class="ct-35cfe4">amount</span><span class="ct-dbb55e">)</span></div><div class="line"><span class="ct-dbb55e">    {</span></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">_repository</span><span class="ct-dbb55e">.</span><span class="ct-c7669f">Lock</span><span class="ct-dbb55e">(</span><span class="ct-777d02">this</span><span class="ct-dbb55e">);</span></div><div class="line"></div><div class="line"><span class="ct-dbb55e">        </span><span class="ct-35cfe4">Balance</span><span class="ct-dbb55e"> -= </span><span class="ct-35cfe4">amount</span></div><div class="line"><span class="ct-dbb55e">    }</span></div><div class="line"><span class="ct-dbb55e">    ...</span></div><div class="line"><span class="ct-dbb55e">}</span></div></code></pre><!--]--><style>.ct-29460e{color:#CE9178}
.ct-3c3ed8{color:#6A9955}
.ct-512d2b{color:#C586C0}
.ct-35cfe4{color:#9CDCFE}
.ct-c7669f{color:#DCDCAA}
.ct-a6ae40{color:#4EC9B0}
.ct-dbb55e{color:#D4D4D4}
.ct-777d02{color:#569CD6}</style></div></section><section id="exception-handling"><div><h1 id="exception-handling"><!--[-->Exception Handling<!--]--></h1><p><!--[-->Gazel uses .NET exceptions to handle errors in your business code. For every
error message there should be a corresponding exception class.<!--]--></p><h2 id="exception-handling-writing-an-exception"><!--[-->Writing an Exception<!--]--></h2><p><!--[-->Create a parent static class for each group of your exceptions and define all
related exceptions under this class as a nested class.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-69ed79">using</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">static</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">MyProduct</span><span class="ct-c70f15">.</span><span class="ct-e1f4b5">ResultCodes</span><span class="ct-c70f15">;</span></div><div class="line"></div><div class="line"><span class="ct-e45d6c">namespace</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">MyProduct</span><span class="ct-c70f15">;</span></div><div class="line"></div><div class="line"><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">static</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">CommonExceptions</span></div><div class="line"><span class="ct-c70f15">{</span></div><div class="line"><span class="ct-c70f15">    </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">NameShouldBeUnique</span><span class="ct-c70f15"> : </span><span class="ct-e1f4b5">ServiceException</span></div><div class="line"><span class="ct-c70f15">    {</span></div><div class="line"><span class="ct-c70f15">        </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-0be438">NameShouldBeUnique</span><span class="ct-c70f15">() : </span><span class="ct-e45d6c">base</span><span class="ct-c70f15">(</span><span class="ct-118c25">Common</span><span class="ct-c70f15">.</span><span class="ct-0be438">Err</span><span class="ct-c70f15">(</span><span class="ct-13f55c">0</span><span class="ct-c70f15">)) { }</span></div><div class="line"><span class="ct-c70f15">    }</span></div><div class="line"></div><div class="line"><span class="ct-c70f15">    </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">ValueIsRequired</span><span class="ct-c70f15"> : </span><span class="ct-e1f4b5">ServiceException</span></div><div class="line"><span class="ct-c70f15">    {</span></div><div class="line"><span class="ct-c70f15">        </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-0be438">ValueIsRequired</span><span class="ct-c70f15">() : </span><span class="ct-e45d6c">base</span><span class="ct-c70f15">(</span><span class="ct-118c25">Common</span><span class="ct-c70f15">.</span><span class="ct-0be438">Err</span><span class="ct-c70f15">(</span><span class="ct-13f55c">1</span><span class="ct-c70f15">)) { }</span></div><div class="line"><span class="ct-c70f15">    }</span></div><div class="line"><span class="ct-c70f15">}</span></div></code></pre><!--]--><div class="alert alert-warning row"><div class="alert-message col"><i class="fa-solid fa-warning"></i></div><div class="col"><!--[--><!--[--><p><!--[-->Exceptions should inherit from <code><!--[-->ServiceException<!--]--></code> to be treated as handled
errors. Handled errors are HTTP status <code><!--[-->4XX<!--]--></code> in REST API and they are logged
in <code><!--[-->WARN<!--]--></code> level.<!--]--></p><p><!--[-->All other exceptions are treated as unhandled errors with code <code><!--[-->99999<!--]--></code>,
logged in <code><!--[-->ERROR<!--]--></code> level and HTTP status is always <code><!--[-->500<!--]--></code> in REST API.<!--]--></p><!--]--><!--]--></div></div><div class="alert alert-info row"><div class="alert-message col"><i class="fa-solid fa-circle-info"></i></div><div class="col"><!--[--><!--[--><p><!--[--><code><!--[-->ResultCodes<!--]--></code> is a class that generates error codes, but we will mention this
later in this section. You can find a detailed description in <a href="/features#exception-handling" class=""><!--[-->Features /
Exception Handling<!--]--> <!----></a><!--]--></p><!--]--><!--]--></div></div><h2 id="exception-handling-throwing-an-exception"><!--[-->Throwing an Exception<!--]--></h2><p><!--[-->To throw an exception you can use <code><!--[-->using static<!--]--></code> directive to include
exceptions class, <code><!--[-->MyProduct.CommonExceptions<!--]--></code> in this case;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-69ed79">using</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">static</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">MyProduct</span><span class="ct-c70f15">.</span><span class="ct-e1f4b5">CommonExceptions</span><span class="ct-c70f15">;</span></div></code></pre><!--]--><p><!--[-->And then just throw the exception like any other .NET exception;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-c70f15">...</span></div><div class="line"><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">Company</span></div><div class="line"><span class="ct-c70f15">{</span></div><div class="line"><span class="ct-c70f15">    ...</span></div><div class="line"><span class="ct-c70f15">    </span><span class="ct-e45d6c">protected</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">internal</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">Company</span><span class="ct-c70f15"> </span><span class="ct-0be438">With</span><span class="ct-c70f15">(</span><span class="ct-e45d6c">string</span><span class="ct-c70f15"> </span><span class="ct-118c25">name</span><span class="ct-c70f15">)</span></div><div class="line"><span class="ct-c70f15">    {</span></div><div class="line"><span class="ct-c70f15">        </span><span class="ct-69ed79">if</span><span class="ct-c70f15">(</span><span class="ct-118c25">_context</span><span class="ct-c70f15">.</span><span class="ct-0be438">Query</span><span class="ct-c70f15">&lt;</span><span class="ct-e1f4b5">Companies</span><span class="ct-c70f15">&gt;().</span><span class="ct-0be438">AnyByName</span><span class="ct-c70f15">(</span><span class="ct-118c25">name</span><span class="ct-c70f15">))</span></div><div class="line"><span class="ct-c70f15">        {</span></div><div class="line"><span class="ct-c70f15">            </span><span class="ct-69ed79">throw</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">new</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">NameShouldBeUnique</span><span class="ct-c70f15">();</span></div><div class="line"><span class="ct-c70f15">        }</span></div><div class="line"></div><div class="line"><span class="ct-c70f15">        ...</span></div><div class="line"><span class="ct-c70f15">    }</span></div><div class="line"><span class="ct-c70f15">    ...</span></div><div class="line"><span class="ct-c70f15">}</span></div><div class="line"><span class="ct-c70f15">...</span></div></code></pre><!--]--><h2 id="exception-handling-result-codes"><!--[-->Result Codes<!--]--></h2><p><!--[-->Above mentioned <code><!--[-->ResultCodes<!--]--></code> is a class where you organize your <code><!--[-->error<!--]--></code>,
<code><!--[-->warning<!--]--></code> and <code><!--[-->info<!--]--></code> codes as named code blocks;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-c70f15">...</span></div><div class="line"><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">ResultCodes</span><span class="ct-c70f15"> : </span><span class="ct-e1f4b5">ResultCodeBlocks</span></div><div class="line"><span class="ct-c70f15">{</span></div><div class="line"><span class="ct-c70f15">    </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">static</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">readonly</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">ResultCodeBlock</span><span class="ct-c70f15"> </span><span class="ct-118c25">Common</span><span class="ct-c70f15"> = </span><span class="ct-0be438">CreateBlock</span><span class="ct-c70f15">(</span><span class="ct-13f55c">1</span><span class="ct-c70f15">, </span><span class="ct-f36435">&quot;Common&quot;</span><span class="ct-c70f15">);</span></div><div class="line"><span class="ct-c70f15">}</span></div><div class="line"><span class="ct-c70f15">...</span></div></code></pre><!--]--><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You will use this class potentially from every business module, so it&#39;s
better for this to be included in the most base business module.<!--]--></p><!--]--><!--]--></div></div><p><!--[-->Every code block reserves <code><!--[-->700<!--]--></code> error codes, <code><!--[-->100<!--]--></code> warning codes and <code><!--[-->100<!--]--></code> info
codes. In the previous example we&#39;ve seen <code><!--[-->Common.Err(0)<!--]--></code>, this means that
<code><!--[-->NameShouldBeUnique<!--]--></code> error should have the first error code in <code><!--[-->Common<!--]--></code> code
block.<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-c70f15">...</span></div><div class="line"><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-0be438">NameShouldBeUnique</span><span class="ct-c70f15">() : </span><span class="ct-e45d6c">base</span><span class="ct-c70f15">(</span><span class="ct-118c25">Common</span><span class="ct-c70f15">.</span><span class="ct-0be438">Err</span><span class="ct-c70f15">(</span><span class="ct-13f55c">0</span><span class="ct-c70f15">)) { } </span><span class="ct-2de47f">// First error of &#39;Common&#39; code block</span></div><div class="line"><span class="ct-c70f15">...</span></div></code></pre><!--]--><p><!--[-->Here, we&#39;ve started with <code><!--[-->Common.Err(0)<!--]--></code> and can go up to <code><!--[-->Common.Err(699)<!--]--></code>
using <code><!--[-->Common<!--]--></code> code block.<!--]--></p><div class="alert alert-success row"><div class="alert-message col"><i class="fa-solid fa-lightbulb"></i></div><div class="col"><!--[--><!--[--><p><!--[-->You may create a code block for every business module, so that error codes
are grouped according to their business domain.<!--]--></p><!--]--><!--]--></div></div><h2 id="exception-handling-parameterized-exceptions"><!--[-->Parameterized Exceptions<!--]--></h2><p><!--[-->You can accept parameters in your exception classes;<!--]--></p><!--[--><pre><code><div class="line"><span class="ct-c70f15">...</span></div><div class="line"><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-e45d6c">class</span><span class="ct-c70f15"> </span><span class="ct-e1f4b5">NameShouldBeUnique</span><span class="ct-c70f15"> : </span><span class="ct-e1f4b5">ServiceException</span></div><div class="line"><span class="ct-c70f15">{</span></div><div class="line"><span class="ct-c70f15">    </span><span class="ct-e45d6c">public</span><span class="ct-c70f15"> </span><span class="ct-0be438">NameShouldBeUnique</span><span class="ct-c70f15">(</span><span class="ct-e45d6c">string</span><span class="ct-c70f15"> </span><span class="ct-118c25">name</span><span class="ct-c70f15">) : </span><span class="ct-e45d6c">base</span><span class="ct-c70f15">(</span><span class="ct-118c25">Common</span><span class="ct-c70f15">.</span><span class="ct-0be438">Err</span><span class="ct-c70f15">(</span><span class="ct-13f55c">0</span><span class="ct-c70f15">), </span><span class="ct-118c25">name</span><span class="ct-c70f15">) { }</span></div><div class="line"><span class="ct-c70f15">}</span></div></code></pre><!--]--><p><!--[-->Last parameter of base constructor accepts <code><!--[-->params object[] parameters<!--]--></code> so that
you can add as many parameters as you want. This parameters are used in
building the exception message that is included in the response.<!--]--></p><h3 id="exception-handling-localizing-messages"><!--[-->Localizing Messages<!--]--></h3><p><!--[-->Error messages will be asked to localization with a key that is unique to each
result code. For example, <code><!--[-->NameShouldBeUnique<!--]--></code> exception will have <code><!--[-->ERR-20701<!--]--></code>
error code.<!--]--></p><p><!--[-->To include parameters in messages, you can use a format string as your message
such as <code><!--[-->&#39;{0}&#39; already exists, name should be unique<!--]--></code>. First parameter will
replace <code><!--[-->{0}<!--]--></code>, second parameter will replace <code><!--[-->{1}<!--]--></code>, and so on.<!--]--></p><style>.ct-2de47f{color:#6A9955}
.ct-f36435{color:#CE9178}
.ct-13f55c{color:#B5CEA8}
.ct-118c25{color:#9CDCFE}
.ct-0be438{color:#DCDCAA}
.ct-e1f4b5{color:#4EC9B0}
.ct-e45d6c{color:#569CD6}
.ct-c70f15{color:#D4D4D4}
.ct-69ed79{color:#C586C0}</style></div></section><!--]--></div><!--]--><!--]--></div></div></div></div></div><!--]--></div><script type="module">import p from "/conventions/_payload.js";window.__NUXT__={...p,...((function(a,b,c,d){return {state:{$ssidebarActive:a},_errors:{},serverRendered:true,config:{public:{content:{locales:[],defaultLocale:b,integrity:1692343585021,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"dark-plus",preload:["diff","ts","js","css","java","markdown","sql","xml","json","csharp","md","bash"]},wsUrl:b,documentDriven:a,host:b,trailingSlash:a,anchorLinks:{depth:0,exclude:[1]}},baseUrl:c,components:{alert:{types:{none:{alertClass:"alert-secondary"},bulb:{alertClass:d,icon:"fa-lightbulb"},x:{alertClass:"alert-danger",icon:"fa-circle-xmark"},warning:{alertClass:"alert-warning",icon:"fa-warning"},white_check_mark:{alertClass:d,icon:"fa-circle-check"},information_source:{alertClass:"alert-info",icon:"fa-circle-info"}}}}},app:{baseURL:c,buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1692343601835}}(false,"","\u002F","alert-success")))}</script><script type="module" src="/_nuxt/entry.ef08e1a7.js" crossorigin></script></body>
</html>